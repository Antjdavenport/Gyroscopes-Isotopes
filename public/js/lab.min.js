/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/*!
 * jQuery JavaScript Library v2.0.2
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-30T21:25Z
 */

/*!
 * Sizzle CSS Selector Engine v1.9.4-pre
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-27
 */

/**
 * Copyright (C) 2012 by Justin Windle
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/*! Socket.IO.js build:0.9.11, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */

/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

/**
   * Parses an URI
   *
   * @author Steven Levithan <stevenlevithan.com> (MIT license)
   * @api public
   */

/*! Built with IMPACT - impactjs.com */

var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t!="string"?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function v(e){var t,n;for(t=0;e[t];t+=1){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===1&&(e[2]===".."||e[0]===".."))break;t>0&&(e.splice(t-1,2),t-=2)}}}function m(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,m=t&&t.split("/"),g=m,y=o.map,b=y&&y["*"];e&&e.charAt(0)==="."&&(t?(getOwn(o.pkgs,t)?g=m=[t]:g=m.slice(0,m.length-1),e=g.concat(e.split("/")),v(e),i=getOwn(o.pkgs,r=e[0]),e=e.join("/"),i&&e===r+"/"+i.main&&(e=r)):e.indexOf("./")===0&&(e=e.substring(2)));if(n&&y&&(m||b)){u=e.split("/");for(a=u.length;a>0;a-=1){l=u.slice(0,a).join("/");if(m)for(f=m.length;f>0;f-=1){s=getOwn(y,m.slice(0,f).join("/"));if(s){s=getOwn(s,l);if(s){c=s,h=a;break}}}if(c)break;!p&&b&&getOwn(b,l)&&(p=getOwn(b,l),d=a)}!c&&p&&(c=p,h=d),c&&(u.splice(0,h,c),e=u.join("/"))}return e}function g(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function y(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return g(e),t.shift(),r.require.undef(e),r.require([e]),!0}function b(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function w(e,t,n,i){var s,o,u,a,f=null,l=t?t.name:null,h=e,v=!0,g="";return e||(v=!1,e="_@r"+(p+=1)),a=b(e),f=a[0],e=a[1],f&&(f=m(f,l,i),o=getOwn(c,f)),e&&(f?o&&o.normalize?g=o.normalize(e,function(e){return m(e,l,i)}):g=m(e,l,i):(g=m(e,l,i),a=b(g),f=a[0],g=a[1],n=!0,s=r.nameToUrl(g))),u=f&&!o&&!n?"_unnormalized"+(d+=1):"",{prefix:f,name:g,parentMap:t,unnormalized:!!u,url:s,originalName:h,isDefine:v,id:(f?f+"!"+g:g)+u}}function E(e){var t=e.id,n=getOwn(u,t);return n||(n=u[t]=new r.Module(e)),n}function S(e,t,n){var r=e.id,i=getOwn(u,r);hasProp(c,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(c[r]):(i=E(e),i.error&&t==="error"?n(i.error):i.on(t,n))}function x(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(u,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function T(){globalDefQueue.length&&(apsp.apply(l,[l.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function N(e){delete u[e],delete a[e]}function C(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var s=r.id,o=getOwn(u,s);o&&!e.depMatched[i]&&!n[s]&&(getOwn(t,s)?(e.defineDep(i,c[s]),e.check()):C(o,t,n))}),n[r]=!0)}function k(){var e,n,i,u,f=o.waitSeconds*1e3,l=f&&r.startTime+f<(new Date).getTime(),c=[],h=[],p=!1,d=!0;if(t)return;t=!0,eachProp(a,function(t){e=t.map,n=e.id;if(!t.enabled)return;e.isDefine||h.push(t);if(!t.error)if(!t.inited&&l)y(n)?(u=!0,p=!0):(c.push(n),g(n));else if(!t.inited&&t.fetched&&e.isDefine){p=!0;if(!e.prefix)return d=!1}});if(l&&c.length)return i=makeError("timeout","Load timeout for modules: "+c,null,c),i.contextName=r.contextName,x(i);d&&each(h,function(e){C(e,{},{})}),(!l||u)&&p&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,k()},50)),t=!1}function L(e){hasProp(c,e[0])||E(w(e[0],null,!0)).init(e[1],e[2])}function A(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function O(e){var t=e.currentTarget||e.srcElement;return A(t,r.onScriptLoad,"load","onreadystatechange"),A(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function M(){var e;T();while(l.length){e=l.shift();if(e[0]===null)return x(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));L(e)}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},u={},a={},f={},l=[],c={},h={},p=1,d=1;return i={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?e.exports:e.exports=c[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){var t,n=getOwn(o.pkgs,e.map.id);return t=n?getOwn(o.config,e.map.id+"/"+n.main):getOwn(o.config,e.map.id),t||{}},exports:c[e.map.id]}}},n=function(e){this.events=getOwn(f,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;h[e]||(h[e]=!0,r.load(this.map.id,e))},check:function(){if(!this.enabled||this.enabling)return;var e,t,n=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{s=r.execCb(n,o,i,s)}catch(u){e=u}else s=r.execCb(n,o,i,s);this.map.isDefine&&(t=this.module,t&&t.exports!==undefined&&t.exports!==this.exports?s=t.exports:s===undefined&&this.usingExports&&(s=this.exports));if(e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",x(this.error=e)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(c[n]=s,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),N(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=w(e.prefix);this.depMaps.push(n),S(n,"defined",bind(this,function(n){var i,s,a,f=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,c=r.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){n.normalize&&(f=n.normalize(f,function(e){return m(e,l,!0)})||""),s=w(e.prefix+"!"+f,this.map.parentMap),S(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=getOwn(u,s.id),a&&(this.depMaps.push(s),this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&N(e.map.id)}),x(e)}),i.fromText=bind(this,function(n,s){var u=e.name,a=w(u),f=useInteractive;s&&(n=s),f&&(useInteractive=!1),E(a),hasProp(o.config,t)&&(o.config[u]=o.config[t]);try{req.exec(n)}catch(l){return x(makeError("fromtexteval","fromText eval for "+t+" failed: "+l,l,[t]))}f&&(useInteractive=!0),this.depMaps.push(a),r.completeLoad(u),c([u],i)}),n.load(e.name,c,i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){a[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=w(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(i,e.id);if(o){this.depExports[t]=o(this);return}this.depCount+=1,S(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&S(e,"error",bind(this,this.errback))}n=e.id,s=u[n],!hasProp(i,n)&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(u,e.id);t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:c,urlFetched:h,defQueue:l,Module:n,makeModuleMap:w,nextTick:req.nextTick,onError:x,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.pkgs,n=o.shim,i={paths:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?t==="map"?(o.map||(o.map={}),mixin(o[t],e,!0,!0)):mixin(o[t],e,!0):o[t]=e}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=r.makeShimExports(e)),n[t]=e}),o.shim=n),e.packages&&(each(e.packages,function(e){var n;e=typeof e=="string"?{name:e}:e,n=e.location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),o.pkgs=t),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=w(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,n){function s(o,a,f){var l,h,p;return n.enableBuildCallback&&a&&isFunction(a)&&(a.__requireJsBuild=!0),typeof o=="string"?isFunction(a)?x(makeError("requireargs","Invalid require call"),f):t&&hasProp(i,o)?i[o](u[t.id]):req.get?req.get(r,o,t,s):(h=w(o,t,!1,!0),l=h.id,hasProp(c,l)?c[l]:x(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(M(),r.nextTick(function(){M(),p=E(w(null,t)),p.skipMap=n.skipMap,p.init(o,a,f,{enabled:!0}),k()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,i=e.lastIndexOf("."),s=e.split("/")[0],o=s==="."||s==="..";return i!==-1&&(!o||i>1)&&(n=e.substring(i,e.length),e=e.substring(0,i)),r.nameToUrl(m(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(c,w(e,t,!1,!0).id)},specified:function(e){return e=w(e,t,!1,!0).id,hasProp(c,e)||hasProp(u,e)}}),t||(s.undef=function(e){T();var n=w(e,t,!0),r=getOwn(u,e);delete c[e],delete h[n.url],delete f[e],r&&(r.events.defined&&(f[e]=r.events),N(e))}),s},enable:function(e){var t=getOwn(u,e.id);t&&E(e).enable()},completeLoad:function(e){var t,n,r,i=getOwn(o.shim,e)||{},s=i.exports;T();while(l.length){n=l.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);L(n)}r=getOwn(u,e);if(!t&&!hasProp(c,e)&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(y(e))return;return x(makeError("nodefine","No define call for "+e,null,[e]))}L([e,i.deps||[],i.exportsFn])}k()},nameToUrl:function(e,t,n){var r,i,s,u,a,f,l,c,h;if(req.jsExtRegExp.test(e))c=e+(t||"");else{r=o.paths,i=o.pkgs,a=e.split("/");for(f=a.length;f>0;f-=1){l=a.slice(0,f).join("/"),s=getOwn(i,l),h=getOwn(r,l);if(h){isArray(h)&&(h=h[0]),a.splice(0,f,h);break}if(s){e===s.name?u=s.location+"/"+s.main:u=s.location,a.splice(0,f,u);break}}c=a.join("/"),c+=t||(/\?/.test(c)||n?"":".js"),c=(c.charAt(0)==="/"||c.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+c}return o.urlArgs?c+((c.indexOf("?")===-1?"?":"&")+o.urlArgs):c},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=O(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=O(e);if(!y(t.id))return x(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}},r.require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.6",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!window.document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=getOwn(contexts,o),i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=typeof setTimeout!="undefined"?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(s){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,s,[t]))}},isBrowser&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("components/requirejs/require.js",function(){}),function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&isHidden(e),p=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(c.display="inline-block")),n.overflow&&(c.overflow="hidden",f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(h?"hide":"show")){if(i!=="show"||!p||p[r]===undefined)continue;h=!0}l[r]=p&&p[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=data_priv.access(e,"fxshow",{}),s&&(p.hidden=!h),h?jQuery(e).show():f.done(function(){jQuery(e).hide()}),f.done(function(){var t;data_priv.remove(e,"fxshow");for(t in l)jQuery.style(e,t,l[t])});for(r in l)o=createTween(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function st(e,t,n,i){var s,o,u,a,f,l,p,m,g,E;(t?t.ownerDocument||t:w)!==h&&c(t),t=t||h,n=n||[];if(!e||typeof e!="string")return n;if((a=t.nodeType)!==1&&a!==9)return[];if(d&&!i){if(s=Y.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return P.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){m=p=b,g=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){l=yt(e),(p=t.getAttribute("id"))?m=p.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+bt(l[f]);g=V.test(e)&&t.parentNode||t,E=l.join(",")}if(E)try{return P.apply(n,g.querySelectorAll(E)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,n,i)}function ot(e){return G.test(e+"")}function ut(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function at(e){return e[b]=!0,e}function ft(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t,n){e=e.split("|");var r,i=e.length,o=n?null:t;while(i--)if(!(r=s.attrHandle[e[i]])||r===t)s.attrHandle[e[i]]=o}function ct(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:e[t]===!0?t.toLowerCase():null}function ht(e,t){return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}function pt(e){if(e.nodeName.toLowerCase()==="input")return e.defaultValue}function dt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function vt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function mt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function gt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function yt(e,t){var n,r,i,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(i=[]);n=!1;if(r=X.exec(u))n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in s.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):T(e,a).slice(0)}function bt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function wt(e,t,n){var r=t.dir,s=n&&r==="parentNode",o=S++;return t.first?function(t,n,i){while(t=t[r])if(t.nodeType===1||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[r])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[r])if(t.nodeType===1||s){l=t[b]||(t[b]={});if((f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else{f=l[r]=[c],f[1]=e(t,n,u)||i;if(f[1]===!0)return!0}}}}function Et(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function St(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function xt(e,t,n,r,i,s){return r&&!r[b]&&(r=xt(r)),i&&!i[b]&&(i=xt(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Ct(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?St(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=St(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=St(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function Tt(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=wt(function(e){return e===t},u,!0),c=wt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<i;a++)if(n=s.relative[e[a].type])h=[wt(Et(h),n)];else{n=s.filter[e[a].type].apply(null,e[a].matches);if(n[b]){r=++a;for(;r<i;r++)if(s.relative[e[r].type])break;return xt(a>1&&Et(h),a>1&&bt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<r&&Tt(e.slice(a,r)),r<i&&Tt(e=e.slice(r)),r<i&&bt(e))}h.push(n)}return Et(h)}function Nt(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=E+=x==null?1:Math.random()||.1;S&&(f=a!==h&&a,i=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}S&&(E=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(c));g=St(g)}P.apply(c,g),S&&!u&&g.length>0&&y+t.length>1&&st.uniqueSort(c)}return S&&(E=N,f=x),w};return r?at(u):u}function Ct(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function kt(e,t,n,i){var o,u,f,l,c,h=yt(e);if(!i&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&r.getById&&t.nodeType===9&&d&&s.relative[u[1].type]){t=(s.find.ID(f.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(u.shift().value.length)}o=Q.needsContext.test(e)?0:u.length;while(o--){f=u[o];if(s.relative[l=f.type])break;if(c=s.find[l])if(i=c(f.matches[0].replace(nt,rt),V.test(u[0].type)&&t.parentNode||t)){u.splice(o,1),e=i.length&&bt(u);if(!e)return P.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,V.test(e)),n}function Lt(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),w=e.document,E=0,S=0,x=ut(),T=ut(),N=ut(),C=!1,k=function(){return 0},L=typeof t,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(w.childNodes),w.childNodes),M[w.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},r=st.support={},c=st.setDocument=function(e){var t=e?e.ownerDocument||e:w,n=t.parentWindow;if(t===h||t.nodeType!==9||!t.documentElement)return h;h=t,p=t.documentElement,d=!u(t),n&&n.frameElement&&n.attachEvent("onbeforeunload",function(){c()}),r.attributes=ft(function(e){return e.innerHTML="<a href='#'></a>",lt("type|href|height|width",ht,e.firstChild.getAttribute("href")==="#"),lt(j,ct,e.getAttribute("disabled")==null),e.className="i",!e.getAttribute("className")}),r.input=ft(function(e){return e.innerHTML="<input>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}),lt("value",pt,r.attributes&&r.input),r.getElementsByTagName=ft(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ft(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),r.getById=ft(function(e){return p.appendChild(e).id=b,!t.getElementsByName||!t.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==L&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&d)return t.getElementsByClassName(e)},m=[],v=[];if(r.qsa=ot(t.querySelectorAll))ft(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),ft(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")});return(r.matchesSelector=ot(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ft(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",U)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),y=ot(p.contains)||p.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},r.sortDetached=ft(function(e){return e.compareDocumentPosition(t.createElement("div"))&1}),k=p.compareDocumentPosition?function(e,n){if(e===n)return C=!0,0;var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);if(i)return i&1||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||y(w,e)?-1:n===t||y(w,n)?1:l?B.call(l,e)-B.call(l,n):0:i&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,u=[e],a=[n];if(e===n)return C=!0,0;if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:l?B.call(l,e)-B.call(l,n):0;if(s===o)return dt(e,n);r=e;while(r=r.parentNode)u.unshift(r);r=n;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?dt(u[i],a[i]):u[i]===w?-1:a[i]===w?1:0},t},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==h&&c(e),t=t.replace($,"='$1']");if(r.matchesSelector&&d&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(i){}return st(t,h,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},st.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&O.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],i=0,s=0;C=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=o(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(i===3||i===4)return e.nodeValue;return n},s=st.selectors={cacheLength:50,createPseudo:at,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=yt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[b]||(c[b]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[b]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:at(function(e){return function(t){return st(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return K.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:gt(function(){return[0]}),last:gt(function(e,t){return[t-1]}),eq:gt(function(e,t,n){return[n<0?n+t:n]}),even:gt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:gt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:gt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:gt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=vt(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=mt(n);a=st.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=yt(e)),n=t.length;while(n--)s=Tt(t[n]),s[b]?r.push(s):i.push(s);s=N(e,Nt(i,r))}return s},s.pseudos.nth=s.pseudos.eq,Lt.prototype=s.filters=s.pseudos,s.setFilters=new Lt,r.sortStable=b.split("").sort(k).join("")===b,c(),[0,0].sort(k),r.detectDuplicates=C,jQuery.find=st,jQuery.expr=st.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=st.uniqueSort,jQuery.text=st.getText,jQuery.isXMLDoc=st.isXML,jQuery.contains=st.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],u&&(!n||a)&&(r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){return t===undefined||t&&typeof t=="string"&&n===undefined?this.get(e,t):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(core_rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=jQuery(this),u=t,a=e.match(core_rnotwhite)||[];while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<i;t++)if(jQuery.contains(r[t],this))return!0}));for(t=0;t<i;t++)jQuery.find(e,r[t],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(r&&r.parentNode!==s&&(r=this.nextSibling),jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.firstChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(Data.accepts(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length)for(o=0;(i=r[o])!==undefined;o++)u[i]?jQuery.event.remove(n,i):jQuery.removeEvent(n,i,t.handle);data_priv.cache[s]&&delete data_priv.cache[s]}}delete data_user.cache[n[data_user.expando]]}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:isHidden(this))?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)}(window);var Sketch=function(){function d(r){r=m(r||{},f);var s="sketch-"+e++,o=r.hasOwnProperty("canvas"),u=o?r.canvas:document.createElement("canvas");switch(r.type){case n:try{i=u.getContext("webgl",r)}catch(h){}try{i=i||u.getContext("experimental-webgl",r)}catch(h){}if(!i)throw"WebGL not supported";break;case t:try{i=u.getContext("2d",r)}catch(h){}if(!i)throw"Canvas not supported";break;default:u=i=document.createElement("div")}return i.canvas=u,u.className="sketch",o?r.autoresize=!1:(r.container.appendChild(u),r.hasOwnProperty("autoresize")||(r.autoresize=f.autoresize),u.id=s),m(self,l),m(i,r),m(i,c),b(),r.autoresize&&E(),a.push(i),i.autostart&&setTimeout(i.start,0),i}function v(){var e={width:400,height:400};$("#"+i.canvas.id).attr(e).css(e),console.log(i),i.canvas.width=e.width,i.canvas.height=e.height,i.scale(1,1)}function m(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function g(e){function n(e,t){return function(){e.call(t,arguments)}}var t={};for(var r in e)typeof e[r]=="function"?t[r]=n(e[r],e):t[r]=e[r];return t}function y(e,t){e.length=0;for(var n=0,r=t.length;n<r;n++)e[n]=t[n];return e}function b(){function n(t){return e[t]||String.fromCharCode(t)}function r(e){i.mouse.ox=i.mouse.x,i.mouse.oy=i.mouse.y,i.mouse.x=e.x,i.mouse.y=e.y,i.mouse.dx=i.mouse.x-i.mouse.ox,i.mouse.dy=i.mouse.y-i.mouse.oy}function o(e){var t,n=g(e);n.original=e;for(var r=i.canvas,o=0,u=0;r;r=r.offsetParent)o+=r.offsetLeft,u+=r.offsetTop;if(n.touches&&!!n.touches.length)for(var a=n.touches.length-1,f;a>=0;a--)f=n.touches[a],f.x=f.pageX-o,f.y=f.pageY-u,t=s[a]||f,f.dx=f.x-t.x,f.dy=f.y-t.x,f.ox=t.x,f.oy=t.y,s[a]=g(f);else n.x=n.pageX-o,n.y=n.pageY-u,t=s.mouse||n,n.dx=n.x-t.x,n.dy=n.y-t.y,n.ox=t.x,n.oy=t.y,s.mouse=n;return n}function u(e){e.preventDefault(),e=o(e),y(i.touches,e.touches),r(i.touches[0]),i.touchstart&&i.touchstart(e),i.mousedown&&i.mousedown(e)}function a(e){e=o(e),y(i.touches,e.touches),r(i.touches[0]),i.touchmove&&i.touchmove(e),i.mousemove&&i.mousemove(e)}function f(e){e=o(e);if(!e.touches.length)s={};else for(var t in s)e.touches[t]||delete s[t];i.touchend&&i.touchend(e),i.mouseup&&i.mouseup(e)}function l(e){e=o(e),i.mouseover&&i.mouseover(e)}function d(e){e=o(e),i.dragging||(p(i.canvas,"mousemove",v),p(i.canvas,"mouseup",b),h(document,"mousemove",v),h(document,"mouseup",b),i.dragging=!0),y(i.touches,[e]),i.touchstart&&i.touchstart(e),i.mousedown&&i.mousedown(e)}function v(e){e=o(e),r(e),y(i.touches,[e]),i.touchmove&&i.touchmove(e),i.mousemove&&i.mousemove(e)}function m(e){e=o(e),i.mouseout&&i.mouseout(e)}function b(e){e=o(e),i.dragging&&(p(document,"mousemove",v),p(document,"mouseup",b),h(i.canvas,"mousemove",v),h(i.canvas,"mouseup",b),i.dragging=!1),delete s.mouse,i.touchend&&i.touchend(e),i.mouseup&&i.mouseup(e)}function w(e){e=o(e),i.click&&i.click(e)}function S(e){i.keys[n(e.keyCode)]=!0,i.keys[e.keyCode]=!0,i.keydown&&i.keydown(e)}function x(e){i.keys[n(e.keyCode)]=!1,i.keys[e.keyCode]=!1,i.keyup&&i.keyup(e)}var e={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};for(var t in e)c.keys[e[t]]=!1;var s={};h(i.canvas,"touchstart",u),h(i.canvas,"touchmove",a),h(i.canvas,"touchend",f),h(i.canvas,"mouseover",l),h(i.canvas,"mousedown",d),h(i.canvas,"mousemove",v),h(i.canvas,"mouseout",m),h(i.canvas,"mouseup",b),h(i.canvas,"click",w),h(document,"keydown",S),h(document,"keyup",x),h(window,"resize",E)}function w(){if(!s){var e=Date.now();i.dt=e-i.now,i.millis+=i.dt,i.now=e,i.update&&i.update(i.dt),i.autoclear&&i.clear(),i.draw&&i.draw(i)}s=++s%i.interval,o=requestAnimationFrame(w)}function E(e){if(!i.autoresize)return;var n,s,o,u=i.type===r?i.style:i.canvas;i.fullscreen?(s=$(window).width()*$(document).height(),i.max_pixels&&s>i.max_pixels?(n=$(window).width()/$(document).height(),o=Math.sqrt(i.max_pixels/n),i.height=u.height=o,i.width=u.width=o*n,u.style.height=$(document).height()+"px",u.style.width=$(window).width()+"px"):(i.height=u.height=$(document).height(),i.width=u.width=$(window).width())):(u.height=i.height,u.width=i.width);if(i.retina&&i.type===t&&window.devicePixelRatio){var a=u.height,f=u.width;i.canvas.height=a*window.devicePixelRatio,i.canvas.width=f*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio),i.canvas.style.cssText="height: "+a+"px; width: "+f+"px;"}i.resize&&i.resize()}var e=0,t="canvas",n="web-gl",r="dom",i,s=0,o=-1,u={},a=[],f={fullscreen:!0,autostart:!0,autoclear:!0,autopause:!0,autoresize:!0,container:document.body,interval:1,type:t,retina:!1},l={PI:Math.PI,TWO_PI:Math.PI*2,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,atan:Math.atan,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,random:function(e,t){return e&&typeof e.length=="number"&&!!e.length?e[Math.floor(Math.random()*e.length)]:(typeof t!="number"&&(t=e||1,e=0),e+Math.random()*(t-e))}},c={millis:0,now:NaN,dt:NaN,keys:{},mouse:{x:0,y:0,ox:0,oy:0,dx:0,dy:0},touches:[],initialized:!1,dragging:!1,running:!1,start:function(){if(i.running)return;i.setup&&!i.initialized&&(i.autopause&&(h(window,"focus",i.start),h(window,"blur",i.stop)),i.setup()),i.initialized=!0,i.running=!0,i.now=Date.now(),w()},stop:function(){cancelAnimationFrame(o),i.running=!1},toggle:function(){(i.running?i.stop:i.start)()},clear:function(){i.canvas&&(i.canvas.width=i.canvas.width,i.retina&&window.devicePixelRatio&&i.scale(window.devicePixelRatio,window.devicePixelRatio))},destroy:function(){var e,t,n,r,s,o;a.splice(a.indexOf(i),1),i.stop();for(t in u){n=u[t];for(s=0,o=n.length;s<o;s++)e=n[s],p(e.el,t,e.fn);delete u[t]}i.container.removeChild(i.canvas);for(r in i)i.hasOwnProperty(r)&&delete i[r]}},h=function(){function e(e,t,n){u[t]||(u[t]=[]),u[t].push({el:e,fn:n})}return window.addEventListener?function(t,n,r){t.addEventListener(n,r,!1),e(t,n,r)}:window.attachEvent?function(t,n,r){t.attachEvent("on"+n,r),e(t,n,r)}:function(t,n,r){t["on"+n]=r,e(t,n,r)}}(),p=function(){function e(e,t,n){if(u[t]){var r;for(var i=u[t].length-1;i>=0;i--)r=u[t][i],r.el===e&&r.fn===n&&u[t].splice(i,1)}}if(window.removeEventListener)return function(t,n,r){t.removeEventListener(n,r,!1),e(t,n,r)};if(window.detachEvent)return function(t,n,r){t.detachEvent("on"+n,r),e(t,n,r)};el["on"+ev]=null,e(el,ev,fn)}();return{CANVAS:t,WEB_GL:n,DOM:r,instances:a,create:d}}();Date.now||(Date.now=function(){return+(new Date)}),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),define("sketch",["jquery"],function(e){return function(){var t,n;return t||e.Sketch}}(this)),define("modules/particle",["jquery"],function(e){var t={radius:1,init:function(e){this.ctx=e,this.alpha=random(),this.pos={x:random(this.ctx.width),y:random(this.ctx.height)}},draw:function(){this.ctx.beginPath(),this.ctx.arc(this.pos.x,this.pos.y,this.radius,0,TWO_PI),this.ctx.fillStyle="rgba(255, 255, 255, "+this.alpha+")",this.ctx.fill(),this.ctx.closePath(),this[this.method]()},move:function(){this.pos={x:random(this.ctx.width),y:random(this.ctx.height)}},wobble:function(){this.pos.x+=Math.round(random(-1,1)),this.pos.y+=Math.round(random(-1,1))}};return t}),define("modules/dust",["jquery","sketch","modules/particle"],function(e,t,n){var r={$el:e("#particles"),count:500,particles:[],method:"wobble",init:function(r){var i;this.Events=r,this.ctx=t.create({container:this.$el[0],retina:!0,draw:this.draw,resize:this.resize});for(i=0;i<this.count;i++)this.particles.push(e.extend({method:this.method},n)),this.particles[i].init(this.ctx);this.initialised=!0},draw:function(){var e;this.beginPath(),this.rect(0,0,this.width,this.height),this.fillStyle="#222",this.fill(),this.closePath();for(e=0;e<r.count;e++)r.particles[e].draw()},resize:function(){if(r.initialised===!0)for(i=0;i<r.count;i++)r.particles[i].move()}};return r}),define("plugins/jquery.retinafy",["jquery"],function(e){e.fn.retinafy=function(){var t={checkRetinaSrc:function(e,t){var n=new XMLHttpRequest;n.open("HEAD",e),n.onreadystatechange=function(){if(n.readyState!==4)return n.status>=200&&n.status<=399?t(!0):t(!1)},n.send()}};return this.each(function(){if(window.devicePixelRatio>1){var n=e(this),r=n.find("img");r.each(function(){var n=e(this),r=n.attr("src"),i=r.replace(/\.\w+$/,function(e){return"@2x"+e});t.checkRetinaSrc(i,function(e){e&&n.attr("src",i)})})}})}}),define("modules/retinafy",["plugins/jquery.retinafy"],function(){var e={init:function(){$("body").retinafy()}};return e}),define("modules/analytics",["ga"],function(e){var t={init:function(){return config.debug===!1?(e.push(["_setAccount","UA-39184165-1"]),e.push(["_trackPageview"]),e.push(["_trackPageLoadTime"]),e):(console.log("Debug mode: %s.","no analytics"),this)}};return t});var io="undefined"==typeof module?{}:module.exports;(function(){(function(e,t){var n=e;n.version="0.9.11",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var i=n.util.parseUri(e),s,o;t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s])o=new n.Socket(u);return!u["force new connection"]&&o&&(n.sockets[s]=o),o=o||n.sockets[s],o.of(i.path.length>1?i.path:"")}})("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--)n[i[s]]=t[s]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(r=r||"localhost",!i&&n=="https"&&(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&i.push(s+"="+r[s]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r)s=n[r].split("="),s[0]&&(t[s[0]]=s[1]);return t};var s=!1;n.load=function(e){if("document"in t&&document.readyState==="complete"||s)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){s=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(t,r,i,s){var o=s||[],u=typeof i=="undefined"?2:i,a;for(a in r)r.hasOwnProperty(a)&&n.indexOf(o,a)<0&&(typeof t[a]!="object"||!u?(t[a]=r[a],o.push(r[a])):n.merge(t[a],r[a],u-1,o));return t},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++)~n.indexOf(i,s[o])&&r.push(s[o]);return r},n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return e.withCredentials!=undefined}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function r(){n.removeListener(e,r),t.apply(this,arguments)}var n=this;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++)if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return e===undefined?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;var i=n.slice();for(var s=0,o=i.length;s<o;s++)i[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a instanceof Date&&(a=date(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,typeof JSON!="undefined"?JSON:undefined),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],s=n.advice=["reconnect"],o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":e.data!==""&&(l=e.data);break;case"event":var p={name:e.name};e.args&&e.args.length&&(p.args=e.args),l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"")}var d=[t,n+(f=="data"?"+":""),a];return l!==null&&l!==undefined&&d.push(l),d.join(":")},n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};n&&(u.id=n,t[3]?u.ack="data":u.ack=!0);switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"",u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name,u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1],u.args=[];if(t[3])try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}break;case"disconnect":case"heartbeat":}return u},n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++)e.charAt(r)=="�"?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),e.type=="heartbeat"?this.onHeartbeat():(e.type=="connect"&&e.endpoint==""&&this.onConnect(),e.type=="error"&&e.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){var e=this;this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),e!==""&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function s(t){t instanceof Error?(n.connecting=!1,n.onError(t.message)):e.apply(null,t.split(":"))}var n=this,r=this.options,o=["http"+(r.secure?"s":"")+":/",r.host+":"+r.port,r.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length,u.parentNode.insertBefore(a,u),t.j.push(function(e){s(e),a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,!0),this.isXDomain()&&(f.withCredentials=!0),f.onreadystatechange=function(){f.readyState==4&&(f.onreadystatechange=i,f.status==200?s(f.responseText):f.status==403?n.onError(f.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(f.responseText)))},f.send(null)}},r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++)if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this)))return new t.Transport[s](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(r,i,s,o){function u(e){n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=!1;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name);e.length?u(e):n.publish("connect_failed")}}},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=s*1e3,n.heartbeatTimeout=i*1e3,n.transports||(n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),u(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&typeof e=="function"&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&e.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1;if(t||n)this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},r.prototype.reconnect=function(){function i(){if(e.connected){for(var t in e.namespaces)e.namespaces.hasOwnProperty(t)&&""!==t&&e.namespaces[t].packet({type:"connect"});e.publish("reconnect",e.transport.name,e.reconnectionAttempts)}clearTimeout(e.reconnectionTimer),e.removeListener("connect_failed",s),e.removeListener("connect",s),e.reconnecting=!1,delete e.reconnectionAttempts,delete e.reconnectionDelay,delete e.reconnectionTimer,delete e.redoTransports,e.options["try multiple transports"]=n}function s(){if(!e.reconnecting)return;if(e.connected)return i();if(e.connecting&&e.reconnecting)return e.reconnectionTimer=setTimeout(s,1e3);e.reconnectionAttempts++>=t?e.redoTransports?(e.publish("reconnect_failed"),i()):(e.on("connect_failed",s),e.options["try multiple transports"]=!0,e.transports=e.origTransports,e.transport=e.getTransport(),e.redoTransports=!0,e.connect()):(e.reconnectionDelay<r&&(e.reconnectionDelay*=2),e.connect(),e.publish("reconnecting",e.reconnectionDelay,e.reconnectionAttempts),e.reconnectionTimer=setTimeout(s,e.reconnectionDelay))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var e=this,t=this.options["max reconnection attempts"],n=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(s,this.reconnectionDelay),this.on("connect",s)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function r(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];e.ack=="data"?i.push(r):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);e.ack=="data"&&i.push(r),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):e.reason=="unauthorized"?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;return i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+e),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},t.util.ua.iDevice?r.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments),this.sendBuffer=[]}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function r(){this.readyState==4&&(this.onreadystatechange=i,t.posting=!1,this.status==200?t.socket.setBuffer(!1):t.onClose())}function s(){this.onload=i,t.socket.setBuffer(!1)}var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=s:this.sendXHR.onreadystatechange=r,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,!0);if(e=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=n.location&&o!=n.location.protocol;if(i&&(!s||!u))return!0}catch(a){}return!1},r.xdomainCheck=function(e){return r.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function t(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(e.onData(this.responseText),e.get()):e.onClose())}function r(){this.onload=i,this.onerror=i,e.retryCounter=1,e.onData(this.responseText),e.get()}function s(){e.retryCounter++,!e.retryCounter||e.retryCounter>3?e.onClose():e.get()}if(!this.isOpen)return;var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=r,this.xhr.onerror=s):this.xhr.onreadystatechange=t,this.xhr.send(null)},r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function a(){f(),n.socket.setBuffer(!1)}function f(){n.iframe&&n.form.removeChild(n.iframe);try{u=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){u=document.createElement("iframe"),u.name=n.iframeId}u.id=n.iframeId,n.form.appendChild(u),n.iframe=u}var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var i=document.createElement("form"),s=document.createElement("textarea"),o=this.iframeId="socketio_iframe_"+this.index,u;i.className="socketio",i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.display="none",i.target=o,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}this.form.action=this.prepareUrl()+r,f(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}this.iframe.attachEvent?u.onreadystatechange=function(){n.iframe.readyState=="complete"&&a()}:this.iframe.onload=a,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},i.prototype.ready=function(e,n){var i=this;if(!r)return n.call(this);t.util.load(function(){n.call(i)})},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),typeof define=="function"&&define.amd&&define("io",[],function(){return io})})(),function(e){Number.prototype.map=function(e,t,n,r){return n+(r-n)*((this-e)/(t-e))},Number.prototype.limit=function(e,t){return Math.min(t,Math.max(e,this))},Number.prototype.round=function(e){return e=Math.pow(10,e||0),Math.round(this*e)/e},Number.prototype.floor=function(){return Math.floor(this)},Number.prototype.ceil=function(){return Math.ceil(this)},Number.prototype.toInt=function(){return this|0},Number.prototype.toRad=function(){return this/180*Math.PI},Number.prototype.toDeg=function(){return this*180/Math.PI},Array.prototype.erase=function(e){for(var t=this.length;t--;)this[t]===e&&this.splice(t,1);return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Function.prototype.bind=Function.prototype.bind||function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i},e.ig={game:null,debug:null,version:"1.21",global:e,modules:{},resources:[],ready:!1,baked:!1,nocache:"",ua:{},prefix:e.ImpactPrefix||"",lib:"lib/",_current:null,_loadQueue:[],_waitForOnload:0,$:function(e){return e.charAt(0)=="#"?document.getElementById(e.substr(1)):document.getElementsByTagName(e)},$new:function(e){return document.createElement(e)},copy:function(e){if(!e||typeof e!="object"||e instanceof HTMLElement||e instanceof ig.Class)return e;if(e instanceof Array){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=ig.copy(e[n]);return t}var t={};for(var n in e)t[n]=ig.copy(e[n]);return t},merge:function(e,t){for(var n in t){var r=t[n];if(typeof r!="object"||r instanceof HTMLElement||r instanceof ig.Class)e[n]=r;else{if(!e[n]||typeof e[n]!="object")e[n]=r instanceof Array?[]:{};ig.merge(e[n],r)}}return e},ksort:function(e){if(!e||typeof e!="object")return[];var t=[],n=[];for(var r in e)t.push(r);t.sort();for(var r=0;r<t.length;r++)n.push(e[t[r]]);return n},setVendorAttribute:function(e,t,n){var r=t.charAt(0).toUpperCase()+t.substr(1);e[t]=e["ms"+r]=e["moz"+r]=e["webkit"+r]=e["o"+r]=n},getVendorAttribute:function(e,t){var n=t.charAt(0).toUpperCase()+t.substr(1);return e[t]||e["ms"+n]||e["moz"+n]||e["webkit"+n]||e["o"+n]},normalizeVendorAttribute:function(e,t){var n=ig.getVendorAttribute(e,t);!e[t]&&n&&(e[t]=n)},getImagePixels:function(e,t,n,r,i){var s=ig.$new("canvas");s.width=e.width,s.height=e.height;var o=s.getContext("2d"),u=ig.getVendorAttribute(o,"backingStorePixelRatio")||1;ig.normalizeVendorAttribute(o,"getImageDataHD");var a=e.width/u,f=e.height/u;return s.width=Math.ceil(a),s.height=Math.ceil(f),o.drawImage(e,0,0,a,f),u===1?o.getImageData(t,n,r,i):o.getImageDataHD(t,n,r,i)},module:function(e){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[e]&&ig.modules[e].body)throw"Module '"+e+"' is already defined";return ig._current={name:e,requires:[],loaded:!1,body:null},ig.modules[e]=ig._current,ig._loadQueue.push(ig._current),ig},requires:function(){return ig._current.requires=Array.prototype.slice.call(arguments),ig},defines:function(e){ig._current.body=e,ig._current=null,ig._initDOMReady()},addResource:function(e){ig.resources.push(e)},setNocache:function(e){ig.nocache=e?"?"+Date.now():""},log:function(){},assert:function(e,t){},show:function(e,t){},mark:function(e,t){},_loadScript:function(e,t){ig.modules[e]={name:e,requires:[],loaded:!1,body:null},ig._waitForOnload++;var n=ig.prefix+ig.lib+e.replace(/\./g,"/")+".js"+ig.nocache,r=ig.$new("script");r.type="text/javascript",r.src=n,r.onload=function(){ig._waitForOnload--,ig._execModules()},r.onerror=function(){throw"Failed to load module "+e+" at "+n+" "+"required from "+t},ig.$("head")[0].appendChild(r)},_execModules:function(){var e=!1;for(var t=0;t<ig._loadQueue.length;t++){var n=ig._loadQueue[t],r=!0;for(var i=0;i<n.requires.length;i++){var s=n.requires[i];ig.modules[s]?ig.modules[s].loaded||(r=!1):(r=!1,ig._loadScript(s,n.name))}r&&n.body&&(ig._loadQueue.splice(t,1),n.loaded=!0,n.body(),e=!0,t--)}if(e)ig._execModules();else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var o=[];for(var t=0;t<ig._loadQueue.length;t++){var u=[],a=ig._loadQueue[t].requires;for(var i=0;i<a.length;i++){var n=ig.modules[a[i]];(!n||!n.loaded)&&u.push(a[i])}o.push(ig._loadQueue[t].name+" (requires: "+u.join(", ")+")")}throw"Unresolved (circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules:\n"+o.join("\n")}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,13);ig.modules["dom.ready"].loaded=!0,ig._waitForOnload--,ig._execModules()}return 0},_boot:function(){document.location.href.match(/\?nocache/)&&ig.setNocache(!0),ig.ua.pixelRatio=e.devicePixelRatio||1,ig.ua.viewport={width:e.innerWidth,height:e.innerHeight},ig.ua.screen={width:e.screen.availWidth*ig.ua.pixelRatio,height:e.screen.availHeight*ig.ua.pixelRatio},ig.ua.iPhone=/iPhone/i.test(navigator.userAgent),ig.ua.iPhone4=ig.ua.iPhone&&ig.ua.pixelRatio==2,ig.ua.iPad=/iPad/i.test(navigator.userAgent),ig.ua.android=/android/i.test(navigator.userAgent),ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad,ig.ua.mobile=ig.ua.iOS||ig.ua.android},_initDOMReady:function(){if(ig.modules["dom.ready"]){ig._execModules();return}ig._boot(),ig.modules["dom.ready"]={requires:[],loaded:!1,body:null},ig._waitForOnload++,document.readyState==="complete"?ig._DOMReady():(document.addEventListener("DOMContentLoaded",ig._DOMReady,!1),e.addEventListener("load",ig._DOMReady,!1))}},ig.normalizeVendorAttribute(e,"requestAnimationFrame");if(e.requestAnimationFrame){var t=1,n={};e.ig.setAnimation=function(r,i){var s=t++;n[s]=!0;var o=function(){if(!n[s])return;e.requestAnimationFrame(o,i),r()};return e.requestAnimationFrame(o,i),s},e.ig.clearAnimation=function(e){delete n[e]}}else e.ig.setAnimation=function(t,n){return e.setInterval(t,1e3/60)},e.ig.clearAnimation=function(t){e.clearInterval(t)};var r=!1,i=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;e.ig.Class=function(){};var s=function(e){var t=this.prototype,n={};for(var r in e)typeof e[r]=="function"&&typeof t[r]=="function"&&i.test(e[r])?(n[r]=t[r],t[r]=function(e,t){return function(){var r=this.parent;this.parent=n[e];var i=t.apply(this,arguments);return this.parent=r,i}}(r,e[r])):t[r]=e[r]};e.ig.Class.extend=function(t){function a(){if(!r){if(this.staticInstantiate){var e=this.staticInstantiate.apply(this,arguments);if(e)return e}for(var t in this)typeof this[t]=="object"&&(this[t]=ig.copy(this[t]));this.init&&this.init.apply(this,arguments)}return this}var n=this.prototype;r=!0;var o=new this;r=!1;for(var u in t)typeof t[u]=="function"&&typeof n[u]=="function"&&i.test(t[u])?o[u]=function(e,t){return function(){var r=this.parent;this.parent=n[e];var i=t.apply(this,arguments);return this.parent=r,i}}(u,t[u]):o[u]=t[u];return a.prototype=o,a.prototype.constructor=a,a.extend=e.ig.Class.extend,a.inject=s,a}}(window),ig.baked=!0,ig.module("impact.image").defines(function(){ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:!1,failed:!1,loadCallback:null,path:"",staticInstantiate:function(e){return ig.Image.cache[e]||null},init:function(e){this.path=e,this.load()},load:function(e){if(this.loaded){e&&e(this.path,!0);return}!this.loaded&&ig.ready?(this.loadCallback=e||null,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.onerror=this.onerror.bind(this),this.data.src=ig.prefix+this.path+ig.nocache):ig.addResource(this),ig.Image.cache[this.path]=this},reload:function(){this.loaded=!1,this.data=new Image,this.data.onload=this.onload.bind(this),this.data.src=this.path+"?"+Date.now()},onload:function(e){this.width=this.data.width,this.height=this.data.height,this.loaded=!0,ig.system.scale!=1&&this.resize(ig.system.scale),this.loadCallback&&this.loadCallback(this.path,!0)},onerror:function(e){this.failed=!0,this.loadCallback&&this.loadCallback(this.path,!1)},resize:function(e){var t=ig.getImagePixels(this.data,0,0,this.width,this.height),n=this.width*e,r=this.height*e,i=ig.$new("canvas");i.width=n,i.height=r;var s=i.getContext("2d"),o=s.getImageData(0,0,n,r);for(var u=0;u<r;u++)for(var a=0;a<n;a++){var f=(Math.floor(u/e)*this.width+Math.floor(a/e))*4,l=(u*n+a)*4;o.data[l]=t.data[f],o.data[l+1]=t.data[f+1],o.data[l+2]=t.data[f+2],o.data[l+3]=t.data[f+3]}s.putImageData(o,0,0),this.data=i},draw:function(e,t,n,r,i,s){if(!this.loaded)return;var o=ig.system.scale;n=n?n*o:0,r=r?r*o:0,i=(i?i:this.width)*o,s=(s?s:this.height)*o,ig.system.context.drawImage(this.data,n,r,i,s,ig.system.getDrawPos(e),ig.system.getDrawPos(t),i,s),ig.Image.drawCount++},drawTile:function(e,t,n,r,i,s,o){i=i?i:r;if(!this.loaded||r>this.width||i>this.height)return;var u=ig.system.scale,a=Math.floor(r*u),f=Math.floor(i*u),l=s?-1:1,c=o?-1:1;if(s||o)ig.system.context.save(),ig.system.context.scale(l,c);ig.system.context.drawImage(this.data,Math.floor(n*r)%this.width*u,Math.floor(n*r/this.width)*i*u,a,f,ig.system.getDrawPos(e)*l-(s?a:0),ig.system.getDrawPos(t)*c-(o?f:0),a,f),(s||o)&&ig.system.context.restore(),ig.Image.drawCount++}}),ig.Image.drawCount=0,ig.Image.cache={},ig.Image.reloadCache=function(){for(var e in ig.Image.cache)ig.Image.cache[e].reload()}}),ig.baked=!0,ig.module("impact.font").requires("impact.image").defines(function(){ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(e){this._loadMetrics(this.data),this.parent(e)},widthForString:function(e){if(e.indexOf("\n")!==-1){var t=e.split("\n"),n=0;for(var r=0;r<t.length;r++)n=Math.max(n,this._widthForLine(t[r]));return n}return this._widthForLine(e)},_widthForLine:function(e){var t=0;for(var n=0;n<e.length;n++)t+=this.widthMap[e.charCodeAt(n)-this.firstChar]+this.letterSpacing;return t},heightForString:function(e){return e.split("\n").length*(this.height+this.lineSpacing)},draw:function(e,t,n,r){typeof e!="string"&&(e=e.toString());if(e.indexOf("\n")!==-1){var i=e.split("\n"),s=this.height+this.lineSpacing;for(var o=0;o<i.length;o++)this.draw(i[o],t,n+o*s,r);return}if(r==ig.Font.ALIGN.RIGHT||r==ig.Font.ALIGN.CENTER){var u=this._widthForLine(e);t-=r==ig.Font.ALIGN.CENTER?u/2:u}this.alpha!==1&&(ig.system.context.globalAlpha=this.alpha);for(var o=0;o<e.length;o++){var a=e.charCodeAt(o);t+=this._drawChar(a-this.firstChar,t,n)}this.alpha!==1&&(ig.system.context.globalAlpha=1),ig.Image.drawCount+=e.length},_drawChar:function(e,t,n){if(!this.loaded||e<0||e>=this.indices.length)return 0;var r=ig.system.scale,i=this.indices[e]*r,s=0,o=this.widthMap[e]*r,u=(this.height-2)*r;return ig.system.context.drawImage(this.data,i,s,o,u,ig.system.getDrawPos(t),ig.system.getDrawPos(n),o,u),this.widthMap[e]+this.letterSpacing},_loadMetrics:function(e){this.height=e.height-1,this.widthMap=[],this.indices=[];var t=ig.getImagePixels(e,0,e.height-1,e.width,1),n=0,r=0;for(var i=0;i<e.width;i++){var s=i*4+3;t.data[s]>127?r++:t.data[s]==0&&r&&(this.widthMap.push(r),this.indices.push(i-r),n++,r=0)}this.widthMap.push(r),this.indices.push(i-r)}}),ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2}}),ig.baked=!0,ig.module("impact.sound").defines(function(){ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=!1;return}var e=new Audio;for(var t=0;t<ig.Sound.use.length;t++){var n=ig.Sound.use[t];if(e.canPlayType(n.mime)){this.format=n;break}}this.format||(ig.Sound.enabled=!1)},load:function(e,t,n){var r=ig.prefix+e.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[e]){if(t&&this.clips[e].length<ig.Sound.channels)for(var i=this.clips[e].length;i<ig.Sound.channels;i++){var s=new Audio(r);s.load(),this.clips[e].push(s)}return this.clips[e][0]}var o=new Audio(r);n&&(o.addEventListener("canplaythrough",function u(t){o.removeEventListener("canplaythrough",u,!1),n(e,!0,t)},!1),o.addEventListener("error",function(t){n(e,!1,t)},!1)),o.preload="auto",o.load(),this.clips[e]=[o];if(t)for(var i=1;i<ig.Sound.channels;i++){var s=new Audio(r);s.load(),this.clips[e].push(s)}return o},get:function(e){var t=this.clips[e];for(var n=0,r;r=t[n++];)if(r.paused||r.ended)return r.ended&&(r.currentTime=0),r;return t[0].pause(),t[0].currentTime=0,t[0]}}),ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:!1,_volume:1,_loop:!1,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this),Object.defineProperty?(Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)})):this.__defineGetter__&&(this.__defineGetter__("volume",this.getVolume.bind(this)),this.__defineSetter__("volume",this.setVolume.bind(this)),this.__defineGetter__("loop",this.getLooping.bind(this)),this.__defineSetter__("loop",this.setLooping.bind(this)))},add:function(e,t){if(!ig.Sound.enabled)return;var n=e instanceof ig.Sound?e.path:e,r=ig.soundManager.load(n,!1);r.loop=this._loop,r.volume=this._volume,r.addEventListener("ended",this._endedCallbackBound,!1),this.tracks.push(r),t&&(this.namedTracks[t]=r),this.currentTrack||(this.currentTrack=r)},next:function(){if(!this.tracks.length)return;this.stop(),this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length,this.currentTrack=this.tracks[this.currentIndex],this.play()},pause:function(){if(!this.currentTrack)return;this.currentTrack.pause()},stop:function(){if(!this.currentTrack)return;this.currentTrack.pause(),this.currentTrack.currentTime=0},play:function(e){if(e&&this.namedTracks[e]){var t=this.namedTracks[e];t!=this.currentTrack&&(this.stop(),this.currentTrack=t)}else if(!this.currentTrack)return;this.currentTrack.play()},getLooping:function(){return this._loop},setLooping:function(e){this._loop=e;for(var t in this.tracks)this.tracks[t].loop=e},getVolume:function(){return this._volume},setVolume:function(e){this._volume=e.limit(0,1);for(var t in this.tracks)this.tracks[t].volume=this._volume},fadeOut:function(e){if(!this.currentTrack)return;clearInterval(this._fadeInterval),this.fadeTimer=new ig.Timer(e),this._fadeInterval=setInterval(this._fadeStep.bind(this),50)},_fadeStep:function(){var e=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;e<=.01?(this.stop(),this.currentTrack.volume=this._volume,clearInterval(this._fadeInterval)):this.currentTrack.volume=e},_endedCallback:function(){this._loop?this.play():this.next()}}),ig.Sound=ig.Class.extend({path:"",volume:1,currentClip:null,multiChannel:!0,init:function(e,t){this.path=e,this.multiChannel=t!==!1,this.load()},load:function(e){if(!ig.Sound.enabled){e&&e(this.path,!0);return}ig.ready?ig.soundManager.load(this.path,this.multiChannel,e):ig.addResource(this)},play:function(){if(!ig.Sound.enabled)return;this.currentClip=ig.soundManager.get(this.path),this.currentClip.volume=ig.soundManager.volume*this.volume,this.currentClip.play()},stop:function(){this.currentClip&&(this.currentClip.pause(),this.currentClip.currentTime=0)}}),ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}},ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3],ig.Sound.channels=4,ig.Sound.enabled=!0}),ig.baked=!0,ig.module("impact.loader").requires("impact.image","impact.font","impact.sound").defines(function(){ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:!1,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(e,t){this.gameClass=e,this.resources=t,this._loadCallbackBound=this._loadCallback.bind(this);for(var n=0;n<this.resources.length;n++)this._unloaded.push(this.resources[n].path)},load:function(){ig.system.clear("#000");if(!this.resources.length){this.end();return}for(var e=0;e<this.resources.length;e++)this.loadResource(this.resources[e]);this._intervalId=setInterval(this.draw.bind(this),16)},loadResource:function(e){e.load(this._loadCallbackBound)},end:function(){if(this.done)return;this.done=!0,clearInterval(this._intervalId),ig.system.setGame(this.gameClass)},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var e=ig.system.scale,t=ig.system.width*.6,n=ig.system.height*.1,r=ig.system.width*.5-t/2,i=ig.system.height*.5-n/2;ig.system.context.fillStyle="#000",ig.system.context.fillRect(0,0,480,320),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(r*e,i*e,t*e,n*e),ig.system.context.fillStyle="#000",ig.system.context.fillRect(r*e+e,i*e+e,t*e-e-e,n*e-e-e),ig.system.context.fillStyle="#fff",ig.system.context.fillRect(r*e,i*e,t*e*this._drawStatus,n*e)},_loadCallback:function(e,t){if(!t)throw"Failed to load resource: "+e;this._unloaded.erase(e),this.status=1-this._unloaded.length/this.resources.length,this._unloaded.length==0&&setTimeout(this.end.bind(this),250)}})}),ig.baked=!0,ig.module("impact.timer").defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(e){this.base=ig.Timer.time,this.last=ig.Timer.time,this.target=e||0},set:function(e){this.target=e||0,this.base=ig.Timer.time,this.pausedAt=0},reset:function(){this.base=ig.Timer.time,this.pausedAt=0},tick:function(){var e=ig.Timer.time-this.last;return this.last=ig.Timer.time,this.pausedAt?0:e},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target},pause:function(){this.pausedAt||(this.pausedAt=ig.Timer.time)},unpause:function(){this.pausedAt&&(this.base+=ig.Timer.time-this.pausedAt,this.pausedAt=0)}}),ig.Timer._last=0,ig.Timer.time=Number.MIN_VALUE,ig.Timer.timeScale=1,ig.Timer.maxStep=.05,ig.Timer.step=function(){var e=Date.now(),t=(e-ig.Timer._last)/1e3;ig.Timer.time+=Math.min(t,ig.Timer.maxStep)*ig.Timer.timeScale,ig.Timer._last=e}}),ig.baked=!0,ig.module("impact.system").requires("impact.timer","impact.image").defines(function(){ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:!1,delegate:null,clock:null,canvas:null,context:null,init:function(e,t,n,r,i){this.fps=t,this.clock=new ig.Timer,this.canvas=ig.$(e),this.resize(n,r,i),this.context=this.canvas.getContext("2d"),this.getDrawPos=ig.System.drawMode,this.scale!=1&&(ig.System.scaleMode=ig.System.SCALE.CRISP),ig.System.scaleMode(this.canvas,this.context)},resize:function(e,t,n){this.width=e,this.height=t,this.scale=n||this.scale,this.realWidth=this.width*this.scale,this.realHeight=this.height*this.scale,this.canvas.width=this.realWidth,this.canvas.height=this.realHeight},setGame:function(e){this.running?this.newGameClass=e:this.setGameNow(e)},setGameNow:function(e){ig.game=new e,ig.system.setDelegate(ig.game)},setDelegate:function(e){if(typeof e.run!="function")throw"System.setDelegate: No run() function in object";this.delegate=e,this.startRunLoop()},stopRunLoop:function(){ig.clearAnimation(this.animationId),this.running=!1},startRunLoop:function(){this.stopRunLoop(),this.animationId=ig.setAnimation(this.run.bind(this),this.canvas),this.running=!0},clear:function(e){this.context.fillStyle=e,this.context.fillRect(0,0,this.realWidth,this.realHeight)},run:function(){ig.Timer.step(),this.tick=this.clock.tick(),this.delegate.run(),ig.input.clearPressed(),this.newGameClass&&(this.setGameNow(this.newGameClass),this.newGameClass=null)},getDrawPos:null}),ig.System.DRAW={AUTHENTIC:function(e){return Math.round(e)*this.scale},SMOOTH:function(e){return Math.round(e*this.scale)},SUBPIXEL:function(e){return e*this.scale}},ig.System.drawMode=ig.System.DRAW.SMOOTH,ig.System.SCALE={CRISP:function(e,t){ig.setVendorAttribute(t,"imageSmoothingEnabled",!1),e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="crisp-edges",e.style.msInterpolationMode="nearest-neighbor"},SMOOTH:function(e,t){ig.setVendorAttribute(t,"imageSmoothingEnabled",!0),e.style.imageRendering="",e.style.msInterpolationMode=""}},ig.System.scaleMode=ig.System.SCALE.SMOOTH}),ig.baked=!0,ig.module("impact.input").defines(function(){ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:!1,isUsingKeyboard:!1,isUsingAccelerometer:!1,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse)return;this.isUsingMouse=!0;var e=this.mousewheel.bind(this);ig.system.canvas.addEventListener("mousewheel",e,!1),ig.system.canvas.addEventListener("DOMMouseScroll",e,!1),ig.system.canvas.addEventListener("contextmenu",this.contextmenu.bind(this),!1),ig.system.canvas.addEventListener("mousedown",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("mouseup",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("mousemove",this.mousemove.bind(this),!1),ig.system.canvas.addEventListener("touchstart",this.keydown.bind(this),!1),ig.system.canvas.addEventListener("touchend",this.keyup.bind(this),!1),ig.system.canvas.addEventListener("touchmove",this.mousemove.bind(this),!1)},initKeyboard:function(){if(this.isUsingKeyboard)return;this.isUsingKeyboard=!0,window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1)},initAccelerometer:function(){if(this.isUsingAccelerometer)return;window.addEventListener("devicemotion",this.devicemotion.bind(this),!1)},mousewheel:function(e){var t=e.wheelDelta?e.wheelDelta:e.detail*-1,n=t>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN,r=this.bindings[n];r&&(this.actions[r]=!0,this.presses[r]=!0,this.delayedKeyup[r]=!0,e.stopPropagation(),e.preventDefault())},mousemove:function(e){var t=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth,n=ig.system.scale*(t/ig.system.realWidth),r={left:0,top:0};ig.system.canvas.getBoundingClientRect&&(r=ig.system.canvas.getBoundingClientRect());var i=e.touches?e.touches[0]:e;this.mouse.x=(i.clientX-r.left)/n,this.mouse.y=(i.clientY-r.top)/n},contextmenu:function(e){this.bindings[ig.KEY.MOUSE2]&&(e.stopPropagation(),e.preventDefault())},keydown:function(e){var t=e.target.tagName;if(t=="INPUT"||t=="TEXTAREA")return;var n=e.type=="keydown"?e.keyCode:e.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1;(e.type=="touchstart"||e.type=="mousedown")&&this.mousemove(e);var r=this.bindings[n];r&&(this.actions[r]=!0,this.locks[r]||(this.presses[r]=!0,this.locks[r]=!0),e.stopPropagation(),e.preventDefault())},keyup:function(e){var t=e.target.tagName;if(t=="INPUT"||t=="TEXTAREA")return;var n=e.type=="keyup"?e.keyCode:e.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1,r=this.bindings[n];r&&(this.delayedKeyup[r]=!0,e.stopPropagation(),e.preventDefault())},devicemotion:function(e){this.accel=e.accelerationIncludingGravity},bind:function(e,t){e<0?this.initMouse():e>0&&this.initKeyboard(),this.bindings[e]=t},bindTouch:function(e,t){var n=ig.$(e),r=this;n.addEventListener("touchstart",function(e){r.touchStart(e,t)},!1),n.addEventListener("touchend",function(e){r.touchEnd(e,t)},!1)},unbind:function(e){var t=this.bindings[e];this.delayedKeyup[t]=!0,this.bindings[e]=null},unbindAll:function(){this.bindings={},this.actions={},this.presses={},this.locks={},this.delayedKeyup={}},state:function(e){return this.actions[e]},pressed:function(e){return this.presses[e]},released:function(e){return this.delayedKeyup[e]},clearPressed:function(){for(var e in this.delayedKeyup)this.actions[e]=!1,this.locks[e]=!1;this.delayedKeyup={},this.presses={}},touchStart:function(e,t){return this.actions[t]=!0,this.presses[t]=!0,e.stopPropagation(),e.preventDefault(),!1},touchEnd:function(e,t){return this.delayedKeyup[t]=!0,e.stopPropagation(),e.preventDefault(),!1}})}),ig.baked=!0,ig.module("impact.impact").requires("dom.ready","impact.loader","impact.system","impact.input","impact.sound").defines(function(){ig.main=function(e,t,n,r,i,s,o){ig.system=new ig.System(e,n,r,i,s||1),ig.input=new ig.Input,ig.soundManager=new ig.SoundManager,ig.music=new ig.Music,ig.ready=!0;var u=new(o||ig.Loader)(t,ig.resources);u.load()}}),ig.baked=!0,ig.module("impact.animation").requires("impact.timer","impact.image").defines(function(){ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(e,t,n){this.width=t,this.height=n,this.image=new ig.Image(e)}}),ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:!1,y:!1},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(e,t,n,r){this.sheet=e,this.pivot={x:e.width/2,y:e.height/2},this.timer=new ig.Timer,this.frameTime=t,this.sequence=n,this.stop=!!r,this.tile=this.sequence[0]},rewind:function(){return this.timer.set(),this.loopCount=0,this.tile=this.sequence[0],this},gotoFrame:function(e){this.timer.set(this.frameTime*-e),this.update()},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var e=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(e/this.sequence.length),this.stop&&this.loopCount>0?this.frame=this.sequence.length-1:this.frame=e%this.sequence.length,this.tile=this.sequence[this.frame]},draw:function(e,t){var n=Math.max(this.sheet.width,this.sheet.height);if(e>ig.system.width||t>ig.system.height||e+n<0||t+n<0)return;this.alpha!=1&&(ig.system.context.globalAlpha=this.alpha),this.angle==0?this.sheet.image.drawTile(e,t,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y):(ig.system.context.save(),ig.system.context.translate(ig.system.getDrawPos(e+this.pivot.x),ig.system.getDrawPos(t+this.pivot.y)),ig.system.context.rotate(this.angle),this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y),ig.system.context.restore()),this.alpha!=1&&(ig.system.context.globalAlpha=1)}})}),ig.baked=!0,ig.module("impact.entity").requires("impact.animation","impact.impact").defines(function(){ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:!1,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:!1,slopeStanding:{min:44..toRad(),max:136..toRad()},init:function(e,t,n){this.id=++ig.Entity._lastId,this.pos.x=e,this.pos.y=t,ig.merge(this,n)},addAnim:function(e,t,n,r){if(!this.animSheet)throw"No animSheet to add the animation "+e+" to.";var i=new ig.Animation(this.animSheet,t,n,r);return this.anims[e]=i,this.currentAnim||(this.currentAnim=i),i},update:function(){this.last.x=this.pos.x,this.last.y=this.pos.y,this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor,this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x),this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var e=this.vel.x*ig.system.tick,t=this.vel.y*ig.system.tick,n=ig.game.collisionMap.trace(this.pos.x,this.pos.y,e,t,this.size.x,this.size.y);this.handleMovementTrace(n),this.currentAnim&&this.currentAnim.update()},getNewVelocity:function(e,t,n,r){if(t)return(e+t*ig.system.tick).limit(-r,r);if(n){var i=n*ig.system.tick;return e-i>0?e-i:e+i<0?e+i:0}return e.limit(-r,r)},handleMovementTrace:function(e){this.standing=!1,e.collision.y&&(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity?this.vel.y*=-this.bounciness:(this.vel.y>0&&(this.standing=!0),this.vel.y=0)),e.collision.x&&(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity?this.vel.x*=-this.bounciness:this.vel.x=0);if(e.collision.slope){var t=e.collision.slope;if(this.bounciness>0){var n=this.vel.x*t.nx+this.vel.y*t.ny;this.vel.x=(this.vel.x-t.nx*n*2)*this.bounciness,this.vel.y=(this.vel.y-t.ny*n*2)*this.bounciness}else{var r=t.x*t.x+t.y*t.y,i=(this.vel.x*t.x+this.vel.y*t.y)/r;this.vel.x=t.x*i,this.vel.y=t.y*i;var s=Math.atan2(t.x,t.y);s>this.slopeStanding.min&&s<this.slopeStanding.max&&(this.standing=!0)}}this.pos=e.pos},draw:function(){this.currentAnim&&this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y)},kill:function(){ig.game.removeEntity(this)},receiveDamage:function(e,t){this.health-=e,this.health<=0&&this.kill()},touches:function(e){return!(this.pos.x>=e.pos.x+e.size.x||this.pos.x+this.size.x<=e.pos.x||this.pos.y>=e.pos.y+e.size.y||this.pos.y+this.size.y<=e.pos.y)},distanceTo:function(e){var t=this.pos.x+this.size.x/2-(e.pos.x+e.size.x/2),n=this.pos.y+this.size.y/2-(e.pos.y+e.size.y/2);return Math.sqrt(t*t+n*n)},angleTo:function(e){return Math.atan2(e.pos.y+e.size.y/2-(this.pos.y+this.size.y/2),e.pos.x+e.size.x/2-(this.pos.x+this.size.x/2))},check:function(e){},collideWith:function(e,t){},ready:function(){}}),ig.Entity._lastId=0,ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8},ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3},ig.Entity.checkPair=function(e,t){e.checkAgainst&t.type&&e.check(t),t.checkAgainst&e.type&&t.check(e),e.collides&&t.collides&&e.collides+t.collides>ig.Entity.COLLIDES.ACTIVE&&ig.Entity.solveCollision(e,t)},ig.Entity.solveCollision=function(e,t){var n=null;if(e.collides==ig.Entity.COLLIDES.LITE||t.collides==ig.Entity.COLLIDES.FIXED)n=e;else if(t.collides==ig.Entity.COLLIDES.LITE||e.collides==ig.Entity.COLLIDES.FIXED)n=t;e.last.x+e.size.x>t.last.x&&e.last.x<t.last.x+t.size.x?(e.last.y<t.last.y?ig.Entity.seperateOnYAxis(e,t,n):ig.Entity.seperateOnYAxis(t,e,n),e.collideWith(t,"y"),t.collideWith(e,"y")):e.last.y+e.size.y>t.last.y&&e.last.y<t.last.y+t.size.y&&(e.last.x<t.last.x?ig.Entity.seperateOnXAxis(e,t,n):ig.Entity.seperateOnXAxis(t,e,n),e.collideWith(t,"x"),t.collideWith(e,"x"))},ig.Entity.seperateOnXAxis=function(e,t,n){var r=e.pos.x+e.size.x-t.pos.x;if(n){var i=e===n?t:e;n.vel.x=-n.vel.x*n.bounciness+i.vel.x;var s=ig.game.collisionMap.trace(n.pos.x,n.pos.y,n==e?-r:r,0,n.size.x,n.size.y);n.pos.x=s.pos.x}else{var o=(e.vel.x-t.vel.x)/2;e.vel.x=-o,t.vel.x=o;var u=ig.game.collisionMap.trace(e.pos.x,e.pos.y,-r/2,0,e.size.x,e.size.y);e.pos.x=Math.floor(u.pos.x);var a=ig.game.collisionMap.trace(t.pos.x,t.pos.y,r/2,0,t.size.x,t.size.y);t.pos.x=Math.ceil(a.pos.x)}},ig.Entity.seperateOnYAxis=function(e,t,n){var r=e.pos.y+e.size.y-t.pos.y;if(n){var i=e===n?t:e;n.vel.y=-n.vel.y*n.bounciness+i.vel.y;var s=0;n==e&&Math.abs(n.vel.y-i.vel.y)<n.minBounceVelocity&&(n.standing=!0,s=i.vel.x*ig.system.tick);var o=ig.game.collisionMap.trace(n.pos.x,n.pos.y,s,n==e?-r:r,n.size.x,n.size.y);n.pos.y=o.pos.y,n.pos.x=o.pos.x}else if(ig.game.gravity&&(t.standing||e.vel.y>0)){var u=ig.game.collisionMap.trace(e.pos.x,e.pos.y,0,-(e.pos.y+e.size.y-t.pos.y),e.size.x,e.size.y);e.pos.y=u.pos.y,e.bounciness>0&&e.vel.y>e.minBounceVelocity?e.vel.y*=-e.bounciness:(e.standing=!0,e.vel.y=0)}else{var a=(e.vel.y-t.vel.y)/2;e.vel.y=-a,t.vel.y=a;var s=t.vel.x*ig.system.tick,u=ig.game.collisionMap.trace(e.pos.x,e.pos.y,s,-r/2,e.size.x,e.size.y);e.pos.y=u.pos.y;var f=ig.game.collisionMap.trace(t.pos.x,t.pos.y,0,r/2,t.size.x,t.size.y);t.pos.y=f.pos.y}}}),ig.baked=!0,ig.module("impact.map").defines(function(){ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(e,t){this.tilesize=e,this.data=t,this.height=t.length,this.width=t[0].length},getTile:function(e,t){var n=Math.floor(e/this.tilesize),r=Math.floor(t/this.tilesize);return n>=0&&n<this.width&&r>=0&&r<this.height?this.data[r][n]:0},setTile:function(e,t,n){var r=Math.floor(e/this.tilesize),i=Math.floor(t/this.tilesize);r>=0&&r<this.width&&i>=0&&i<this.height&&(this.data[i][r]=n)}})}),ig.baked=!0,ig.module("impact.collision-map").requires("impact.map").defines(function(){ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(e,t,n){this.parent(e,t),this.tiledef=n||ig.CollisionMap.defaultTileDef;for(var r in this.tiledef)r|0>this.lastSlope&&(this.lastSlope=r|0)},trace:function(e,t,n,r,i,s){var o={collision:{x:!1,y:!1,slope:!1},pos:{x:e,y:t},tile:{x:0,y:0}},u=Math.ceil(Math.max(Math.abs(n),Math.abs(r))/this.tilesize);if(u>1){var a=n/u,f=r/u;for(var l=0;l<u&&(a||f);l++){this._traceStep(o,e,t,a,f,i,s,n,r,l),e=o.pos.x,t=o.pos.y,o.collision.x&&(a=0,n=0),o.collision.y&&(f=0,r=0);if(o.collision.slope)break}}else this._traceStep(o,e,t,n,r,i,s,n,r,0);return o},_traceStep:function(e,t,n,r,i,s,o,u,a,f){e.pos.x+=r,e.pos.y+=i;var l=0;if(r){var c=r>0?s:0,h=r<0?this.tilesize:0,p=Math.max(Math.floor(n/this.tilesize),0),d=Math.min(Math.ceil((n+o)/this.tilesize),this.height),v=Math.floor((e.pos.x+c)/this.tilesize),m=Math.floor((t+c)/this.tilesize);if(f>0||v==m||m<0||m>=this.width)m=-1;if(v>=0&&v<this.width)for(var g=p;g<d;g++){if(m!=-1){l=this.data[g][m];if(l>1&&l<=this.lastSlope&&this._checkTileDef(e,l,t,n,u,a,s,o,m,g))break}l=this.data[g][v];if(l==1||l>this.lastSlope||l>1&&this._checkTileDef(e,l,t,n,u,a,s,o,v,g)){if(l>1&&l<=this.lastSlope&&e.collision.slope)break;e.collision.x=!0,e.tile.x=l,t=e.pos.x=v*this.tilesize-c+h,u=0;break}}}if(i){var y=i>0?o:0,b=i<0?this.tilesize:0,w=Math.max(Math.floor(e.pos.x/this.tilesize),0),E=Math.min(Math.ceil((e.pos.x+s)/this.tilesize),this.width),g=Math.floor((e.pos.y+y)/this.tilesize),S=Math.floor((n+y)/this.tilesize);if(f>0||g==S||S<0||S>=this.height)S=-1;if(g>=0&&g<this.height)for(var v=w;v<E;v++){if(S!=-1){l=this.data[S][v];if(l>1&&l<=this.lastSlope&&this._checkTileDef(e,l,t,n,u,a,s,o,v,S))break}l=this.data[g][v];if(l==1||l>this.lastSlope||l>1&&this._checkTileDef(e,l,t,n,u,a,s,o,v,g)){if(l>1&&l<=this.lastSlope&&e.collision.slope)break;e.collision.y=!0,e.tile.y=l,e.pos.y=g*this.tilesize-y+b;break}}}},_checkTileDef:function(e,t,n,r,i,s,o,u,a,f){var l=this.tiledef[t];if(!l)return!1;var c=(a+l[0])*this.tilesize,h=(f+l[1])*this.tilesize,p=(l[2]-l[0])*this.tilesize,d=(l[3]-l[1])*this.tilesize,v=l[4],m=n+i+(d<0?o:0)-c,g=r+s+(p>0?u:0)-h;if(p*g-d*m>0){if(i*-d+s*p<0)return v;var y=Math.sqrt(p*p+d*d),b=d/y,w=-p/y,E=m*b+g*w,S=b*E,x=w*E;return S*S+x*x>=i*i+s*s?v||p*(g-s)-d*(m-i)<.5:(e.pos.x=n+i-S,e.pos.y=r+s-x,e.collision.slope={x:p,y:d,nx:b,ny:w},!0)}return!1}});var e=.5,t=1/3,n=2/3,r=!0,i=!1;ig.CollisionMap.defaultTileDef={5:[0,1,1,n,r],6:[0,n,1,t,r],7:[0,t,1,0,r],3:[0,1,1,e,r],4:[0,e,1,0,r],2:[0,1,1,0,r],10:[e,1,1,0,r],21:[0,1,e,0,r],32:[n,1,1,0,r],43:[t,1,n,0,r],54:[0,1,t,0,r],27:[0,0,1,t,r],28:[0,t,1,n,r],29:[0,n,1,1,r],25:[0,0,1,e,r],26:[0,e,1,1,r],24:[0,0,1,1,r],11:[0,0,e,1,r],22:[e,0,1,1,r],33:[0,0,t,1,r],44:[t,0,n,1,r],55:[n,0,1,1,r],16:[1,t,0,0,r],17:[1,n,0,t,r],18:[1,1,0,n,r],14:[1,e,0,0,r],15:[1,1,0,e,r],13:[1,1,0,0,r],8:[e,1,0,0,r],19:[1,1,e,0,r],30:[t,1,0,0,r],41:[n,1,t,0,r],52:[1,1,n,0,r],38:[1,n,0,1,r],39:[1,t,0,n,r],40:[1,0,0,t,r],36:[1,e,0,1,r],37:[1,0,0,e,r],35:[1,0,0,1,r],9:[1,0,e,1,r],20:[e,0,0,1,r],31:[1,0,n,1,r],42:[n,0,t,1,r],53:[t,0,0,1,r],12:[0,0,1,0,i],23:[1,1,0,1,i],34:[1,0,1,1,i],45:[0,1,0,0,i]},ig.CollisionMap.staticNoCollision={trace:function(e,t,n,r){return{collision:{x:!1,y:!1,slope:!1},pos:{x:e+n,y:t+r},tile:{x:0,y:0}}}}}),ig.baked=!0,ig.module("impact.background-map").requires("impact.map","impact.image").defines(function(){ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:!1,tilesetName:"",foreground:!1,enabled:!0,preRender:!1,preRenderedChunks:null,chunkSize:512,debugChunks:!1,anims:{},init:function(e,t,n){this.parent(e,t),this.setTileset(n)},setTileset:function(e){this.tilesetName=e instanceof ig.Image?e.path:e,this.tiles=new ig.Image(this.tilesetName),this.preRenderedChunks=null},setScreenPos:function(e,t){this.scroll.x=e/this.distance,this.scroll.y=t/this.distance},preRenderMapToChunks:function(){var e=this.width*this.tilesize*ig.system.scale,t=this.height*this.tilesize*ig.system.scale,n=Math.ceil(e/this.chunkSize),r=Math.ceil(t/this.chunkSize);this.preRenderedChunks=[];for(var i=0;i<r;i++){this.preRenderedChunks[i]=[];for(var s=0;s<n;s++){var o=s==n-1?e-s*this.chunkSize:this.chunkSize,u=i==r-1?t-i*this.chunkSize:this.chunkSize;this.preRenderedChunks[i][s]=this.preRenderChunk(s,i,o,u)}}},preRenderChunk:function(e,t,n,r){var i=n/this.tilesize/ig.system.scale+1,s=r/this.tilesize/ig.system.scale+1,o=e*this.chunkSize/ig.system.scale%this.tilesize,u=t*this.chunkSize/ig.system.scale%this.tilesize,a=Math.floor(e*this.chunkSize/this.tilesize/ig.system.scale),f=Math.floor(t*this.chunkSize/this.tilesize/ig.system.scale),l=ig.$new("canvas");l.width=n,l.height=r;var c=ig.system.context;ig.system.context=l.getContext("2d");for(var h=0;h<i;h++)for(var p=0;p<s;p++)if(h+a<this.width&&p+f<this.height){var d=this.data[p+f][h+a];d&&this.tiles.drawTile(h*this.tilesize-o,p*this.tilesize-u,d-1,this.tilesize)}return ig.system.context=c,l},draw:function(){if(!this.tiles.loaded||!this.enabled)return;this.preRender?this.drawPreRendered():this.drawTiled()},drawPreRendered:function(){this.preRenderedChunks||this.preRenderMapToChunks();var e=ig.system.getDrawPos(this.scroll.x),t=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var n=this.width*this.tilesize*ig.system.scale;e=(e%n+n)%n;var r=this.height*this.tilesize*ig.system.scale;t=(t%r+r)%r}var i=Math.max(Math.floor(e/this.chunkSize),0),s=Math.max(Math.floor(t/this.chunkSize),0),o=Math.ceil((e+ig.system.realWidth)/this.chunkSize),u=Math.ceil((t+ig.system.realHeight)/this.chunkSize),a=this.preRenderedChunks[0].length,f=this.preRenderedChunks.length;this.repeat||(o=Math.min(o,a),u=Math.min(u,f));var l=0;for(var c=s;c<u;c++){var h=0;for(var p=i;p<o;p++){var d=this.preRenderedChunks[c%f][p%a],v=-e+p*this.chunkSize-h,m=-t+c*this.chunkSize-l;ig.system.context.drawImage(d,v,m),ig.Image.drawCount++,this.debugChunks&&(ig.system.context.strokeStyle="#f0f",ig.system.context.strokeRect(v,m,this.chunkSize,this.chunkSize)),this.repeat&&d.width<this.chunkSize&&v+d.width<ig.system.realWidth&&(h=this.chunkSize-d.width,o++)}this.repeat&&d.height<this.chunkSize&&m+d.height<ig.system.realHeight&&(l=this.chunkSize-d.height,u++)}},drawTiled:function(){var e=0,t=null,n=(this.scroll.x/this.tilesize).toInt(),r=(this.scroll.y/this.tilesize).toInt(),i=this.scroll.x%this.tilesize,s=this.scroll.y%this.tilesize,o=-i-this.tilesize,u=-s-this.tilesize,a=ig.system.width+this.tilesize-i,f=ig.system.height+this.tilesize-s;for(var l=-1,c=u;c<f;l++,c+=this.tilesize){var h=l+r;if(h>=this.height||h<0){if(!this.repeat)continue;h=(h%this.height+this.height)%this.height}for(var p=-1,d=o;d<a;p++,d+=this.tilesize){var v=p+n;if(v>=this.width||v<0){if(!this.repeat)continue;v=(v%this.width+this.width)%this.width}if(e=this.data[h][v])(t=this.anims[e-1])?t.draw(d,c):this.tiles.drawTile(d,c,e-1,this.tilesize)}}}})}),ig.baked=!0,ig.module("impact.game").requires("impact.impact","impact.entity","impact.collision-map","impact.background-map").defines(function(){ig.Game=ig.Class.extend({clearColor:"#000000",gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:!1,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:!1,staticInstantiate:function(){return this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX,ig.game=this,null},loadLevel:function(e){this.screen={x:0,y:0},this.entities=[],this.namedEntities={};for(var t=0;t<e.entities.length;t++){var n=e.entities[t];this.spawnEntity(n.type,n.x,n.y,n.settings)}this.sortEntities(),this.collisionMap=ig.CollisionMap.staticNoCollision,this.backgroundMaps=[];for(var t=0;t<e.layer.length;t++){var r=e.layer[t];if(r.name=="collision")this.collisionMap=new ig.CollisionMap(r.tilesize,r.data);else{var i=new ig.BackgroundMap(r.tilesize,r.data,r.tilesetName);i.anims=this.backgroundAnims[r.tilesetName]||{},i.repeat=r.repeat,i.distance=r.distance,i.foreground=!!r.foreground,i.preRender=!!r.preRender,i.name=r.name,this.backgroundMaps.push(i)}}for(var t=0;t<this.entities.length;t++)this.entities[t].ready()},loadLevelDeferred:function(e){this._levelToLoad=e},getMapByName:function(e){if(e=="collision")return this.collisionMap;for(var t=0;t<this.backgroundMaps.length;t++)if(this.backgroundMaps[t].name==e)return this.backgroundMaps[t];return null},getEntityByName:function(e){return this.namedEntities[e]},getEntitiesByType:function(e){var t=typeof e=="string"?ig.global[e]:e,n=[];for(var r=0;r<this.entities.length;r++){var i=this.entities[r];i instanceof t&&!i._killed&&n.push(i)}return n},spawnEntity:function(e,t,n,r){var i=typeof e=="string"?ig.global[e]:e;if(!i)throw"Can't spawn entity of type "+e;var s=new i(t,n,r||{});return this.entities.push(s),s.name&&(this.namedEntities[s.name]=s),s},sortEntities:function(){this.entities.sort(this.sortBy)},sortEntitiesDeferred:function(){this._doSortEntities=!0},removeEntity:function(e){e.name&&delete this.namedEntities[e.name],e._killed=!0,e.type=ig.Entity.TYPE.NONE,e.checkAgainst=ig.Entity.TYPE.NONE,e.collides=ig.Entity.COLLIDES.NEVER,this._deferredKill.push(e)},run:function(){this.update(),this.draw()},update:function(){this._levelToLoad&&(this.loadLevel(this._levelToLoad),this._levelToLoad=null);if(this._doSortEntities||this.autoSort)this.sortEntities(),this._doSortEntities=!1;this.updateEntities(),this.checkEntities();for(var e=0;e<this._deferredKill.length;e++)this.entities.erase(this._deferredKill[e]);this._deferredKill=[];for(var t in this.backgroundAnims){var n=this.backgroundAnims[t];for(var r in n)n[r].update()}},updateEntities:function(){for(var e=0;e<this.entities.length;e++){var t=this.entities[e];t._killed||t.update()}},draw:function(){this.clearColor&&ig.system.clear(this.clearColor),this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale,this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var e;for(e=0;e<this.backgroundMaps.length;e++){var t=this.backgroundMaps[e];if(t.foreground)break;t.setScreenPos(this.screen.x,this.screen.y),t.draw()}this.drawEntities();for(e;e<this.backgroundMaps.length;e++){var t=this.backgroundMaps[e];t.setScreenPos(this.screen.x,this.screen.y),t.draw()}},drawEntities:function(){for(var e=0;e<this.entities.length;e++)this.entities[e].draw()},checkEntities:function(){var e={};for(var t=0;t<this.entities.length;t++){var n=this.entities[t];if(n.type==ig.Entity.TYPE.NONE&&n.checkAgainst==ig.Entity.TYPE.NONE&&n.collides==ig.Entity.COLLIDES.NEVER)continue;var r={},i=Math.floor(n.pos.x/this.cellSize),s=Math.floor(n.pos.y/this.cellSize),o=Math.floor((n.pos.x+n.size.x)/this.cellSize)+1,u=Math.floor((n.pos.y+n.size.y)/this.cellSize)+1;for(var a=i;a<o;a++)for(var f=s;f<u;f++)if(!e[a])e[a]={},e[a][f]=[n];else if(!e[a][f])e[a][f]=[n];else{var l=e[a][f];for(var c=0;c<l.length;c++)n.touches(l[c])&&!r[l[c].id]&&(r[l[c].id]=!0,ig.Entity.checkPair(n,l[c]));l.push(n)}}}}),ig.Game.SORT={Z_INDEX:function(e,t){return e.zIndex-t.zIndex},POS_X:function(e,t){return e.pos.x+e.size.x-(t.pos.x+t.size.x)},POS_Y:function(e,t){return e.pos.y+e.size.y-(t.pos.y+t.size.y)}}}),ig.baked=!0,ig.module("plugins.box2d.lib").defines(function(){function n(e,t){for(var n in t)e[n]=t[n]}var e={SCALE:.1},t;e.Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Settings.prototype.__constructor=function(){},e.Settings.prototype.__varz=function(){},e.Settings.USHRT_MAX=65535,e.Settings.pi=Math.PI,e.Settings.maxManifoldPoints=2,e.Settings.maxPolygonVertices=8,e.Settings.maxProxies=512,e.Settings.maxPairs=8*e.Settings.maxProxies,e.Settings.linearSlop=.005,e.Settings.angularSlop=2/180*e.Settings.pi,e.Settings.toiSlop=8*e.Settings.linearSlop,e.Settings.maxTOIContactsPerIsland=32,e.Settings.velocityThreshold=1,e.Settings.maxLinearCorrection=.2,e.Settings.maxAngularCorrection=8/180*e.Settings.pi,e.Settings.maxLinearVelocity=200,e.Settings.maxLinearVelocitySquared=e.Settings.maxLinearVelocity*e.Settings.maxLinearVelocity,e.Settings.maxAngularVelocity=250,e.Settings.maxAngularVelocitySquared=e.Settings.maxAngularVelocity*e.Settings.maxAngularVelocity,e.Settings.contactBaumgarte=.2,e.Settings.timeToSleep=.5,e.Settings.linearSleepTolerance=.01,e.Settings.angularSleepTolerance=2/180,e.Settings.Assert=function(e){e||(void 0).x++},e.Vec2=function(e,t){arguments.length==2&&(this.x=e,this.y=t)},e.Vec2.Make=function(t,n){return new e.Vec2(t,n)},t=e.Vec2.prototype,t.x=0,t.y=0,t.SetZero=function(){this.y=this.x=0},t.Set=function(e,t){this.x=e,this.y=t},t.SetV=function(e){this.x=e.x,this.y=e.y},t.Negative=function(){return new e.Vec2(-this.x,-this.y)},t.Copy=function(){return new e.Vec2(this.x,this.y)},t.Add=function(e){this.x+=e.x,this.y+=e.y},t.Subtract=function(e){this.x-=e.x,this.y-=e.y},t.Multiply=function(e){this.x*=e,this.y*=e},t.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},t.MulTM=function(t){var n=e.Math.Dot(this,t.col1);this.y=e.Math.Dot(this,t.col2),this.x=n},t.CrossVF=function(e){var t=this.x;this.x=e*this.y,this.y=-e*t},t.CrossFV=function(e){var t=this.x;this.x=-e*this.y,this.y=e*t},t.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},t.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},t.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},t.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.LengthSquared=function(){return this.x*this.x+this.y*this.y},t.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},t.IsValid=function(){return e.Math.IsValid(this.x)&&e.Math.IsValid(this.y)},e.BufferedPair=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.BufferedPair.prototype.__constructor=function(){},e.BufferedPair.prototype.__varz=function(){},e.BufferedPair.prototype.proxyId1=0,e.BufferedPair.prototype.proxyId2=0,e.AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.AABB.prototype,t.__constructor=function(){},t.__varz=function(){this.lowerBound=new e.Vec2,this.upperBound=new e.Vec2},t.lowerBound=new e.Vec2,t.upperBound=new e.Vec2,t.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},e.Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Pair.prototype.__constructor=function(){},e.Pair.prototype.__varz=function(){},e.Pair.nullPair=e.Settings.USHRT_MAX,e.Pair.nullProxy=e.Settings.USHRT_MAX,e.Pair.tableCapacity=e.Settings.maxPairs,e.Pair.tableMask=e.Pair.tableCapacity-1,e.Pair.e_pairBuffered=1,e.Pair.e_pairRemoved=2,e.Pair.e_pairFinal=4,t=e.Pair.prototype,t.userData=null,t.proxyId1=0,t.proxyId2=0,t.next=0,t.status=0,t.SetBuffered=function(){this.status|=e.Pair.e_pairBuffered},t.ClearBuffered=function(){this.status&=~e.Pair.e_pairBuffered},t.IsBuffered=function(){return(this.status&e.Pair.e_pairBuffered)==e.Pair.e_pairBuffered},t.SetRemoved=function(){this.status|=e.Pair.e_pairRemoved},t.ClearRemoved=function(){this.status&=~e.Pair.e_pairRemoved},t.IsRemoved=function(){return(this.status&e.Pair.e_pairRemoved)==e.Pair.e_pairRemoved},t.SetFinal=function(){this.status|=e.Pair.e_pairFinal},t.IsFinal=function(){return(this.status&e.Pair.e_pairFinal)==e.Pair.e_pairFinal},e.TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.TimeStep.prototype,t.__constructor=function(){},t.__varz=function(){},t.dt=null,t.inv_dt=null,t.dtRatio=null,t.maxIterations=0,t.warmStarting=null,t.positionCorrection=null,e.Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Manifold.prototype,t.__constructor=function(){this.points=new Array(e.Settings.maxManifoldPoints);for(var t=0;t<e.Settings.maxManifoldPoints;t++)this.points[t]=new e.ManifoldPoint;this.normal=new e.Vec2},t.__varz=function(){},t.points=null,t.normal=null,t.pointCount=0,t.Reset=function(){for(var t=0;t<e.Settings.maxManifoldPoints;t++)this.points[t].Reset();this.normal.SetZero(),this.pointCount=0},t.Set=function(t){this.pointCount=t.pointCount;for(var n=0;n<e.Settings.maxManifoldPoints;n++)this.points[n].Set(t.points[n]);this.normal.SetV(t.normal)},e.Point=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Point.prototype,t.__constructor=function(){},t.__varz=function(){this.p=new e.Vec2},t.p=new e.Vec2,t.Support=function(){return this.p},t.GetFirstVertex=function(){return this.p},e.Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Bound.prototype,t.__constructor=function(){},t.__varz=function(){},t.value=0,t.proxyId=0,t.stabbingCount=0,t.IsLower=function(){return(this.value&1)==0},t.IsUpper=function(){return(this.value&1)==1},t.Swap=function(e){var t=this.value,n=this.proxyId,r=this.stabbingCount;this.value=e.value,this.proxyId=e.proxyId,this.stabbingCount=e.stabbingCount,e.value=t,e.proxyId=n,e.stabbingCount=r},e.Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Mat22.prototype,t.__constructor=function(e,t,n){t!=null&&n!=null?(this.col1.SetV(t),this.col2.SetV(n)):(t=Math.cos(e),e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t)},t.__varz=function(){this.col1=new e.Vec2,this.col2=new e.Vec2},t.col1=new e.Vec2,t.col2=new e.Vec2,t.Set=function(e){var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},t.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},t.Copy=function(){return new e.Mat22(0,this.col1,this.col2)},t.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},t.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},t.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.Invert=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s=1/s,e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},t.Solve=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u=1/u,e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},t.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.BoundaryListener=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.BoundaryListener.prototype.__constructor=function(){},e.BoundaryListener.prototype.__varz=function(){},e.BoundaryListener.prototype.Violation=function(){},e.MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.MassData.prototype,t.__constructor=function(){},t.__varz=function(){this.center=new e.Vec2(0,0)},t.mass=0,t.center=new e.Vec2(0,0),t.I=0,e.JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.JointEdge.prototype,t.__constructor=function(){},t.__varz=function(){},t.other=null,t.joint=null,t.prev=null,t.next=null,e.Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Collision.prototype.__constructor=function(){},e.Collision.prototype.__varz=function(){},e.Collision.nullFeature=255,e.Collision.CollidePolyTempVec=new e.Vec2,e.Collision.ClipSegmentToLine=function(t,n,r,i){var s,o=0;s=n[0];var u=s.v;s=n[1];var a=s.v,f=e.Math.Dot(r,u)-i;return s=e.Math.Dot(r,a)-i,f<=0&&(t[o++]=n[0]),s<=0&&(t[o++]=n[1]),f*s<0&&(r=f/(f-s),s=t[o],s=s.v,s.x=u.x+r*(a.x-u.x),s.y=u.y+r*(a.y-u.y),s=t[o],s.id=(f>0?n[0]:n[1]).id,++o),o},e.Collision.EdgeSeparation=function(e,t,n,r,i){var s=e.m_vertices;e=e.m_normals;var o=r.m_vertexCount,u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},e.Collision.FindMaxSeparation=function(t,n,r,i,s){var o=n.m_vertexCount,u=n.m_normals,a,f;f=s.R,a=i.m_centroid;var l=s.position.x+(f.col1.x*a.x+f.col2.x*a.y),c=s.position.y+(f.col1.y*a.x+f.col2.y*a.y);f=r.R,a=n.m_centroid,l-=r.position.x+(f.col1.x*a.x+f.col2.x*a.y),c-=r.position.y+(f.col1.y*a.x+f.col2.y*a.y),f=l*r.R.col1.x+c*r.R.col1.y,c=l*r.R.col2.x+c*r.R.col2.y,l=0;for(var h=-Number.MAX_VALUE,p=0;p<o;++p)a=u[p],a=a.x*f+a.y*c,a>h&&(h=a,l=p);u=e.Collision.EdgeSeparation(n,r,l,i,s);if(u>0)return u;c=l-1>=0?l-1:o-1,h=e.Collision.EdgeSeparation(n,r,c,i,s);if(h>0)return h;p=l+1<o?l+1:0;var d=e.Collision.EdgeSeparation(n,r,p,i,s);if(d>0)return d;f=a=0;if(h>u&&h>d)f=-1,a=c,c=h;else{if(!(d>u))return t[0]=l,u;f=1,a=p,c=d}for(;;){l=f==-1?a-1>=0?a-1:o-1:a+1<o?a+1:0,u=e.Collision.EdgeSeparation(n,r,l,i,s);if(u>0)return u;if(!(u>c))break;a=l,c=u}return t[0]=a,c},e.Collision.FindIncidentEdge=function(e,t,n,r,i,s){var o=t.m_normals,u=i.m_vertexCount;t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=a,o=i+1<u?i+1:0,u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},e.Collision.CollidePolygons=function(t,n,r,s,o){var u=t.pointCount=0,a=[u],f=e.Collision.FindMaxSeparation(a,n,r,s,o);u=a[0];if(!(f>0)){var l=0;a=[l];var c=e.Collision.FindMaxSeparation(a,s,o,n,r);l=a[0];if(!(c>0)){var h=new e.XForm,p=new e.XForm,d=0;a=0,c>.98*f+.001?(f=s,s=n,h.Set(o),p.Set(r),d=l,a=1):(f=n,s=s,h.Set(r),p.Set(o),d=u,a=0),n=[new i,new i],e.Collision.FindIncidentEdge(n,f,h,d,s,p),u=f.m_vertexCount,p=f.m_vertices,f=p[d],s=f.Copy(),d+1<u?(f=p[parseInt(d+1)],f=f.Copy()):(f=p[0],f=f.Copy()),e.Math.SubtractVV(f,s),u=e.Math.MulMV(h.R,e.Math.SubtractVV(f,s)),u.Normalize(),d=e.Math.CrossVF(u,1),s=e.Math.MulX(h,s),f=e.Math.MulX(h,f),h=e.Math.Dot(d,s),p=-e.Math.Dot(u,s),f=e.Math.Dot(u,f),l=[new i,new i],s=[new i,new i],c=0,c=e.Collision.ClipSegmentToLine(l,n,u.Negative(),p);if(!(c<2)){c=e.Collision.ClipSegmentToLine(s,l,u,f);if(!(c<2)){t.normal=a?d.Negative():d.Copy();for(p=u=0;p<e.Settings.maxManifoldPoints;++p)n=s[p],f=e.Math.Dot(d,n.v)-h,f<=0&&(l=t.points[u],l.separation=f,l.localPoint1=e.Math.MulXT(r,n.v),l.localPoint2=e.Math.MulXT(o,n.v),l.id.key=n.id._key,l.id.features.flip=a,++u);t.pointCount=u}}}}},e.Collision.CollideCircles=function(e,t,n,r,i){e.pointCount=0;var s,o;s=n.R,o=t.m_localPosition;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y),a=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R,o=r.m_localPosition;var f=i.position.x+(s.col1.x*o.x+s.col2.x*o.y);s=i.position.y+(s.col1.y*o.x+s.col2.y*o.y),o=f-u;var l=s-a,c=o*o+l*l;t=t.m_radius,r=r.m_radius;var h=t+r;if(!(c>h*h)){if(c<Number.MIN_VALUE)c=-h,e.normal.Set(0,1);else{var p=Math.sqrt(c);c=p-h,h=1/p,e.normal.x=h*o,e.normal.y=h*l}e.pointCount=1,o=e.points[0],o.id.key=0,o.separation=c,u+=t*e.normal.x,a+=t*e.normal.y,f-=r*e.normal.x,s-=r*e.normal.y,e=.5*(u+f),a=.5*(a+s),u=e-n.position.x,f=a-n.position.y,o.localPoint1.x=u*n.R.col1.x+f*n.R.col1.y,o.localPoint1.y=u*n.R.col2.x+f*n.R.col2.y,u=e-i.position.x,f=a-i.position.y,o.localPoint2.x=u*i.R.col1.x+f*i.R.col1.y,o.localPoint2.y=u*i.R.col2.x+f*i.R.col2.y}},e.Collision.CollidePolygonAndCircle=function(t,n,r,i,s){t.pointCount=0;var o,u,a,f,l,c;c=s.R,l=i.m_localPosition,f=s.position.x+(c.col1.x*l.x+c.col2.x*l.y);var h=s.position.y+(c.col1.y*l.x+c.col2.y*l.y);u=f-r.position.x,a=h-r.position.y,c=r.R;var p=u*c.col1.x+a*c.col1.y;c=u*c.col2.x+a*c.col2.y;var d=0,v=-Number.MAX_VALUE;i=i.m_radius;var m=n.m_vertexCount;o=n.m_vertices,n=n.m_normals;for(var g=0;g<m;++g){l=o[g],u=p-l.x,a=c-l.y,l=n[g],u=l.x*u+l.y*a;if(u>i)return;u>v&&(v=u,d=g)}if(v<Number.MIN_VALUE)t.pointCount=1,l=n[d],c=r.R,t.normal.x=c.col1.x*l.x+c.col2.x*l.y,t.normal.y=c.col1.y*l.x+c.col2.y*l.y,o=t.points[0],o.id.features.incidentEdge=d,o.id.features.incidentVertex=e.Collision.nullFeature,o.id.features.referenceEdge=0,o.id.features.flip=0,f-=i*t.normal.x,t=h-i*t.normal.y,u=f-r.position.x,a=t-r.position.y,c=r.R,o.localPoint1.x=u*c.col1.x+a*c.col1.y,o.localPoint1.y=u*c.col2.x+a*c.col2.y,u=f-s.position.x,a=t-s.position.y,c=s.R,o.localPoint2.x=u*c.col1.x+a*c.col1.y,o.localPoint2.y=u*c.col2.x+a*c.col2.y,o.separation=v-i;else{v=d,m=v+1<m?v+1:0,l=o[v],n=o[m];var y=n.x-l.x;g=n.y-l.y;var b=Math.sqrt(y*y+g*g);y/=b,g/=b,u=p-l.x,a=c-l.y,u=u*y+a*g,o=t.points[0],u<=0?(a=l.x,l=l.y,o.id.features.incidentEdge=e.Collision.nullFeature,o.id.features.incidentVertex=v):u>=b?(a=n.x,l=n.y,o.id.features.incidentEdge=e.Collision.nullFeature,o.id.features.incidentVertex=m):(a=y*u+l.x,l=g*u+l.y,o.id.features.incidentEdge=d,o.id.features.incidentVertex=0),u=p-a,a=c-l,p=Math.sqrt(u*u+a*a),u/=p,a/=p,p>i||(t.pointCount=1,c=r.R,t.normal.x=c.col1.x*u+c.col2.x*a,t.normal.y=c.col1.y*u+c.col2.y*a,f-=i*t.normal.x,t=h-i*t.normal.y,u=f-r.position.x,a=t-r.position.y,c=r.R,o.localPoint1.x=u*c.col1.x+a*c.col1.y,o.localPoint1.y=u*c.col2.x+a*c.col2.y,u=f-s.position.x,a=t-s.position.y,c=s.R,o.localPoint2.x=u*c.col1.x+a*c.col1.y,o.localPoint2.y=u*c.col2.x+a*c.col2.y,o.separation=p-i,o.id.features.referenceEdge=0,o.id.features.flip=0)}},e.Collision.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;return n=e.lowerBound,r=t.upperBound,e=n.y-r.y,i>0||s>0?!1:n.x-r.x>0||e>0?!1:!0},e.ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactListener.prototype,t.__constructor=function(){},t.__varz=function(){},t.Add=function(){},t.Persist=function(){},t.Remove=function(){},t.Result=function(){},e.PairCallback=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.PairCallback.prototype.__constructor=function(){},e.PairCallback.prototype.__varz=function(){},e.PairCallback.prototype.PairAdded=function(){return null},e.PairCallback.prototype.PairRemoved=function(){},e.JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.JointDef.prototype,t.__constructor=function(){this.type=e.Joint.e_unknownJoint,this.body2=this.body1=this.userData=null,this.collideConnected=!1},t.__varz=function(){},t.type=0,t.userData=null,t.body1=null,t.body2=null,t.collideConnected=null,e.Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Proxy.prototype,t.__constructor=function(){},t.__varz=function(){this.lowerBounds=[parseInt(0),parseInt(0)],this.upperBounds=[parseInt(0),parseInt(0)]},t.lowerBounds=[parseInt(0),parseInt(0)],t.upperBounds=[parseInt(0),parseInt(0)],t.overlapCount=0,t.timeStamp=0,t.userData=null,t.GetNext=function(){return this.lowerBounds[0]},t.SetNext=function(e){this.lowerBounds[0]=e%65535},t.IsValid=function(){return this.overlapCount!=e.BroadPhase.invalid},e.Color=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Color.prototype,t.__constructor=function(t,n,r){this._r=parseInt(255*e.Math.Clamp(t,0,1)),this._g=parseInt(255*e.Math.Clamp(n,0,1)),this._b=parseInt(255*e.Math.Clamp(r,0,1))},t.__varz=function(){},t._r=0,t._g=0,t._b=0,t.Set=function(t,n,r){this._r=parseInt(255*e.Math.Clamp(t,0,1)),this._g=parseInt(255*e.Math.Clamp(n,0,1)),this._b=parseInt(255*e.Math.Clamp(r,0,1))},t.set=function(t){this._r=parseInt(255*e.Math.Clamp(t,0,1))},t.set=function(t){this._g=parseInt(255*e.Math.Clamp(t,0,1))},t.set=function(t){this._b=parseInt(255*e.Math.Clamp(t,0,1))},t.get=function(){return this._r|this._g<<8|this._b<<16},e.FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.FilterData.prototype,t.__constructor=function(){},t.__varz=function(){this.categoryBits=1,this.maskBits=65535},t.categoryBits=1,t.maskBits=65535,t.groupIndex=0,t.Copy=function(){var t=new e.FilterData;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},e.PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.PairManager.prototype.__constructor=function(){var t=0;this.m_hashTable=new Array(e.Pair.tableCapacity);for(t=0;t<e.Pair.tableCapacity;++t)this.m_hashTable[t]=e.Pair.nullPair;this.m_pairs=new Array(e.Settings.maxPairs);for(t=0;t<e.Settings.maxPairs;++t)this.m_pairs[t]=new e.Pair;this.m_pairBuffer=new Array(e.Settings.maxPairs);for(t=0;t<e.Settings.maxPairs;++t)this.m_pairBuffer[t]=new e.BufferedPair;for(t=0;t<e.Settings.maxPairs;++t)this.m_pairs[t].proxyId1=e.Pair.nullProxy,this.m_pairs[t].proxyId2=e.Pair.nullProxy,this.m_pairs[t].userData=null,this.m_pairs[t].status=0,this.m_pairs[t].next=t+1;this.m_pairs[parseInt(e.Settings.maxPairs-1)].next=e.Pair.nullPair,this.m_pairBufferCount=this.m_pairCount=0},e.PairManager.prototype.__varz=function(){},e.PairManager.Hash=function(e,t){return e=t<<16&4294901760|e,e=~e+(e<<15&4294934528),e^=e>>12&1048575,e+=e<<2&4294967292,e^=e>>4&268435455,e*=2057,e^=(e>>16)%65535,e},e.PairManager.Equals=function(e,t,n){return e.proxyId1==t&&e.proxyId2==n},e.PairManager.EqualsPair=function(e,t){return e.proxyId1==t.proxyId1&&e.proxyId2==t.proxyId2},t=e.PairManager.prototype,t.m_broadPhase=null,t.m_callback=null,t.m_pairs=null,t.m_freePair=0,t.m_pairCount=0,t.m_pairBuffer=null,t.m_pairBufferCount=0,t.m_hashTable=null,t.AddPair=function(t,n){if(t>n){var r=t;t=n,n=r}r=e.PairManager.Hash(t,n)&e.Pair.tableMask;var i=i=this.FindHash(t,n,r);if(i!=null)return i;var s=this.m_freePair;return i=this.m_pairs[s],this.m_freePair=i.next,i.proxyId1=t,i.proxyId2=n,i.status=0,i.userData=null,i.next=this.m_hashTable[r],this.m_hashTable[r]=s,++this.m_pairCount,i},t.RemovePair=function(t,n){if(t>n){var r=t;t=n,n=r}r=e.PairManager.Hash(t,n)&e.Pair.tableMask;for(var i=this.m_hashTable[r],s=null;i!=e.Pair.nullPair;){if(e.PairManager.Equals(this.m_pairs[i],t,n))return t=i,n=this.m_pairs[i],s?s.next=n.next:this.m_hashTable[r]=n.next,n=this.m_pairs[t],r=n.userData,n.next=this.m_freePair,n.proxyId1=e.Pair.nullProxy,n.proxyId2=e.Pair.nullProxy,n.userData=null,n.status=0,this.m_freePair=t,--this.m_pairCount,r;s=this.m_pairs[i],i=s.next}return null},t.Find=function(t,n){if(t>n){var r=t;t=n,n=r}return r=e.PairManager.Hash(t,n)&e.Pair.tableMask,this.FindHash(t,n,r)},t.FindHash=function(t,n,r){var i=this.m_hashTable[r];for(r=this.m_pairs[i];i!=e.Pair.nullPair&&e.PairManager.Equals(r,t,n)==0;)i=r.next,r=this.m_pairs[i];return i==e.Pair.nullPair?null:r},t.ValidateBuffer=function(){},t.ValidateTable=function(){},t.Initialize=function(e,t){this.m_broadPhase=e,this.m_callback=t},t.AddBufferedPair=function(t,n){n=this.AddPair(t,n),n.IsBuffered()==0&&(n.SetBuffered(),t=this.m_pairBuffer[this.m_pairBufferCount],t.proxyId1=n.proxyId1,t.proxyId2=n.proxyId2,++this.m_pairBufferCount),n.ClearRemoved(),e.BroadPhase.s_validate&&this.ValidateBuffer()},t.RemoveBufferedPair=function(t,n){n=this.Find(t,n),n!=null&&(n.IsBuffered()==0&&(n.SetBuffered(),t=this.m_pairBuffer[this.m_pairBufferCount],t.proxyId1=n.proxyId1,t.proxyId2=n.proxyId2,++this.m_pairBufferCount),n.SetRemoved(),e.BroadPhase.s_validate&&this.ValidateBuffer())},t.Commit=function(){var t,n=0,r=0,i=this.m_broadPhase.m_proxyPool;for(n=0;n<this.m_pairBufferCount;++n){t=this.m_pairBuffer[n];var s=this.Find(t.proxyId1,t.proxyId2);s.ClearBuffered(),t=i[s.proxyId1];var o=i[s.proxyId2];s.IsRemoved()?(s.IsFinal()==1&&this.m_callback.PairRemoved(t.userData,o.userData,s.userData),t=this.m_pairBuffer[r],t.proxyId1=s.proxyId1,t.proxyId2=s.proxyId2,++r):s.IsFinal()==0&&(s.userData=this.m_callback.PairAdded(t.userData,o.userData),s.SetFinal())}for(n=0;n<r;++n)t=this.m_pairBuffer[n],this.RemovePair(t.proxyId1,t.proxyId2);this.m_pairBufferCount=0,e.BroadPhase.s_validate&&this.ValidateTable()},e.ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactSolver.prototype,t.__constructor=function(t,n,r,i){var s;this.m_step.dt=t.dt,this.m_step.inv_dt=t.inv_dt,this.m_step.maxIterations=t.maxIterations,this.m_allocator=i,t=0;var o;for(t=this.m_constraintCount=0;t<r;++t)s=n[t],this.m_constraintCount+=s.m_manifoldCount;for(t=0;t<this.m_constraintCount;t++)this.m_constraints[t]=new e.ContactConstraint;for(t=i=0;t<r;++t){s=n[t];var u=s.m_shape1.m_body,a=s.m_shape2.m_body,f=s.m_manifoldCount,l=s.GetManifolds(),c=s.m_friction;s=s.m_restitution;for(var h=u.m_linearVelocity.x,p=u.m_linearVelocity.y,d=a.m_linearVelocity.x,v=a.m_linearVelocity.y,m=u.m_angularVelocity,g=a.m_angularVelocity,y=0;y<f;++y){var b=l[y],w=b.normal.x,E=b.normal.y,S=this.m_constraints[i];S.body1=u,S.body2=a,S.manifold=b,S.normal.x=w,S.normal.y=E,S.pointCount=b.pointCount,S.friction=c,S.restitution=s;for(var x=0;x<S.pointCount;++x){var T=b.points[x],N=S.points[x];N.normalImpulse=T.normalImpulse,N.tangentImpulse=T.tangentImpulse,N.separation=T.separation,N.positionImpulse=0,N.localAnchor1.SetV(T.localPoint1),N.localAnchor2.SetV(T.localPoint2);var C;o=u.m_xf.R;var k=T.localPoint1.x-u.m_sweep.localCenter.x,L=T.localPoint1.y-u.m_sweep.localCenter.y;C=o.col1.x*k+o.col2.x*L,L=o.col1.y*k+o.col2.y*L,k=C,N.r1.Set(k,L),o=a.m_xf.R;var A=T.localPoint2.x-a.m_sweep.localCenter.x;T=T.localPoint2.y-a.m_sweep.localCenter.y,C=o.col1.x*A+o.col2.x*T,T=o.col1.y*A+o.col2.y*T,A=C,N.r2.Set(A,T),o=k*k+L*L,C=A*A+T*T;var O=k*w+L*E,M=A*w+T*E,_=u.m_invMass+a.m_invMass;_+=u.m_invI*(o-O*O)+a.m_invI*(C-M*M),N.normalMass=1/_,_=u.m_mass*u.m_invMass+a.m_mass*a.m_invMass,_+=u.m_mass*u.m_invI*(o-O*O)+a.m_mass*a.m_invI*(C-M*M),N.equalizedMass=1/_,M=-w,O=k*E+L*M,M=A*E+T*M,_=u.m_invMass+a.m_invMass,_+=u.m_invI*(o-O*O)+a.m_invI*(C-M*M),N.tangentMass=1/_,N.velocityBias=0,N.separation>0&&(N.velocityBias=-60*N.separation),C=d+ -g*T-h- -m*L,k=S.normal.x*C+S.normal.y*(v+g*A-p-m*k),k<-e.Settings.velocityThreshold&&(N.velocityBias+=-S.restitution*k)}++i}}},t.__varz=function(){this.m_step=new e.TimeStep,this.m_constraints=[]},t.m_step=new e.TimeStep,t.m_allocator=null,t.m_constraints=[],t.m_constraintCount=0,t.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.body1,i=n.body2,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=-f,h=0,p=0;if(e.warmStarting){p=n.pointCount;for(h=0;h<p;++h){var d=n.points[h];d.normalImpulse*=e.dtRatio,d.tangentImpulse*=e.dtRatio;var v=d.normalImpulse*f+d.tangentImpulse*l,m=d.normalImpulse*l+d.tangentImpulse*c;r.m_angularVelocity-=o*(d.r1.x*m-d.r1.y*v),r.m_linearVelocity.x-=s*v,r.m_linearVelocity.y-=s*m,i.m_angularVelocity+=a*(d.r2.x*m-d.r2.y*v),i.m_linearVelocity.x+=u*v,i.m_linearVelocity.y+=u*m}}else{p=n.pointCount;for(h=0;h<p;++h)r=n.points[h],r.normalImpulse=0,r.tangentImpulse=0}}},t.SolveVelocityConstraints=function(){for(var t=0,n,r,i,s,o,u,a=0;a<this.m_constraintCount;++a){var f=this.m_constraints[a],l=f.body1,c=f.body2,h=l.m_angularVelocity,p=c.m_angularVelocity,d=l.m_linearVelocity,v=c.m_linearVelocity,m=l.m_invMass,g=l.m_invI,y=c.m_invMass,b=c.m_invI,w=f.normal.x,E=f.normal.y,S=-w,x=f.friction,T=f.pointCount;for(t=0;t<T;++t)n=f.points[t],r=v.x+ -p*n.r2.y-d.x- -h*n.r1.y,i=v.y+p*n.r2.x-d.y-h*n.r1.x,s=r*w+i*E,s=-n.normalMass*(s-n.velocityBias),r=r*E+i*S,i=n.tangentMass*-r,r=e.Math.Max(n.normalImpulse+s,0),s=r-n.normalImpulse,o=x*n.normalImpulse,o=e.Math.Clamp(n.tangentImpulse+i,-o,o),i=o-n.tangentImpulse,u=s*w+i*E,s=s*E+i*S,d.x-=m*u,d.y-=m*s,h-=g*(n.r1.x*s-n.r1.y*u),v.x+=y*u,v.y+=y*s,p+=b*(n.r2.x*s-n.r2.y*u),n.normalImpulse=r,n.tangentImpulse=o;l.m_angularVelocity=h,c.m_angularVelocity=p}},t.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.points[r],s=t.points[r];i.normalImpulse=s.normalImpulse,i.tangentImpulse=s.tangentImpulse}},t.SolvePositionConstraints=function(t){for(var n=0,r,i,s=0;s<this.m_constraintCount;++s)for(var o=this.m_constraints[s],u=o.body1,a=o.body2,f=u.m_sweep.c,l=u.m_sweep.a,c=a.m_sweep.c,h=a.m_sweep.a,p=u.m_mass*u.m_invMass,d=u.m_mass*u.m_invI,v=a.m_mass*a.m_invMass,m=a.m_mass*a.m_invI,g=o.normal.x,y=o.normal.y,b=o.pointCount,w=0;w<b;++w){var E=o.points[w];r=u.m_xf.R,i=u.m_sweep.localCenter;var S=E.localAnchor1.x-i.x,x=E.localAnchor1.y-i.y;N=r.col1.x*S+r.col2.x*x,x=r.col1.y*S+r.col2.y*x,S=N,r=a.m_xf.R,i=a.m_sweep.localCenter;var T=E.localAnchor2.x-i.x;i=E.localAnchor2.y-i.y;var N=r.col1.x*T+r.col2.x*i;i=r.col1.y*T+r.col2.y*i,T=N,r=(c.x+T-(f.x+S))*g+(c.y+i-(f.y+x))*y+E.separation,n=e.Math.Min(n,r),r=t*e.Math.Clamp(r+e.Settings.linearSlop,-e.Settings.maxLinearCorrection,0),r=-E.equalizedMass*r,N=E.positionImpulse,E.positionImpulse=e.Math.Max(N+r,0),r=E.positionImpulse-N,E=r*g,r*=y,f.x-=p*E,f.y-=p*r,l-=d*(S*r-x*E),u.m_sweep.a=l,u.SynchronizeTransform(),c.x+=v*E,c.y+=v*r,h+=m*(T*r-i*E),a.m_sweep.a=h,a.SynchronizeTransform()}return n>=-1.5*e.Settings.linearSlop},e.BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.BoundValues.prototype.__constructor=function(){},e.BoundValues.prototype.__varz=function(){this.lowerValues=[0,0],this.upperValues=[0,0]},e.BoundValues.prototype.lowerValues=[0,0],e.BoundValues.prototype.upperValues=[0,0];var r=function(){this.__varz(),this.__constructor.apply(this,arguments)};r.prototype={referenceEdge:function(){return this._referenceEdge},referenceEdge:function(e){this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255},incidentEdge:function(){return this._incidentEdge},incidentEdge:function(e){this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280},incidentVertex:function(e){this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680},incidentVertex:function(){return this._incidentVertex},flip:function(e){this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080},flip:function(){return this._flip}},t=r.prototype,t.__constructor=function(){},t.__varz=function(){},t._referenceEdge=0,t._incidentEdge=0,t._incidentVertex=0,t._flip=0,t._m_id=null,e.MouseJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.MouseJointDef.prototype,e.JointDef.prototype),t=e.MouseJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7,this.timeStep=1/60},t.__varz=function(){this.target=new e.Vec2},t.target=new e.Vec2,t.maxForce=null,t.frequencyHz=null,t.dampingRatio=null,t.timeStep=null,e.ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactConstraintPoint.prototype,t.__constructor=function(){},t.__varz=function(){this.localAnchor1=new e.Vec2,this.localAnchor2=new e.Vec2,this.r1=new e.Vec2,this.r2=new e.Vec2},t.localAnchor1=new e.Vec2,t.localAnchor2=new e.Vec2,t.r1=new e.Vec2,t.r2=new e.Vec2,t.normalImpulse=null,t.tangentImpulse=null,t.positionImpulse=null,t.normalMass=null,t.tangentMass=null,t.equalizedMass=null,t.separation=null,t.velocityBias=null,e.ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactRegister.prototype,t.__constructor=function(){},t.__varz=function(){},t.createFcn=null,t.destroyFcn=null,t.primary=null,e.DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.DestructionListener.prototype.__constructor=function(){},e.DestructionListener.prototype.__varz=function(){},e.DestructionListener.prototype.SayGoodbyeJoint=function(){},e.DestructionListener.prototype.SayGoodbyeShape=function(){},e.PulleyJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PulleyJointDef.prototype,e.JointDef.prototype),t=e.PulleyJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_pulleyJoint,this.groundAnchor1.Set(-1,1),this.groundAnchor2.Set(1,1),this.localAnchor1.Set(-1,0),this.localAnchor2.Set(1,0),this.maxLength2=this.length2=this.maxLength1=this.length1=0,this.ratio=1,this.collideConnected=!0},t.__varz=function(){this.groundAnchor1=new e.Vec2,this.groundAnchor2=new e.Vec2,this.localAnchor1=new e.Vec2,this.localAnchor2=new e.Vec2},t.groundAnchor1=new e.Vec2,t.groundAnchor2=new e.Vec2,t.localAnchor1=new e.Vec2,t.localAnchor2=new e.Vec2,t.length1=null,t.maxLength1=null,t.length2=null,t.maxLength2=null,t.ratio=null,t.Initialize=function(t,n,r,i,s,o,u){this.body1=t,this.body2=n,this.groundAnchor1.SetV(r),this.groundAnchor2.SetV(i),this.localAnchor1=this.body1.GetLocalPoint(s),this.localAnchor2=this.body2.GetLocalPoint(o),t=s.x-r.x,r=s.y-r.y,this.length1=Math.sqrt(t*t+r*r),r=o.x-i.x,i=o.y-i.y,this.length2=Math.sqrt(r*r+i*i),this.ratio=u,u=this.length1+this.ratio*this.length2,this.maxLength1=u-this.ratio*e.PulleyJoint.minPulleyLength,this.maxLength2=(u-e.PulleyJoint.minPulleyLength)/this.ratio},e.Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Jacobian.prototype,t.__constructor=function(){},t.__varz=function(){this.linear1=new e.Vec2,this.linear2=new e.Vec2},t.linear1=new e.Vec2,t.angular1=null,t.linear2=new e.Vec2,t.angular2=null,t.SetZero=function(){this.linear1.SetZero(),this.angular1=0,this.linear2.SetZero(),this.angular2=0},t.Set=function(e,t,n,r){this.linear1.SetV(e),this.angular1=t,this.linear2.SetV(n),this.angular2=r},t.Compute=function(e,t,n,r){return this.linear1.x*e.x+this.linear1.y*e.y+this.angular1*t+(this.linear2.x*n.x+this.linear2.y*n.y)+this.angular2*r},e.DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},e.DebugDraw.prototype.__varz=function(){},e.DebugDraw.e_shapeBit=1,e.DebugDraw.e_jointBit=2,e.DebugDraw.e_coreShapeBit=4,e.DebugDraw.e_aabbBit=8,e.DebugDraw.e_obbBit=16,e.DebugDraw.e_pairBit=32,e.DebugDraw.e_centerOfMassBit=64,t=e.DebugDraw.prototype,t.m_drawFlags=0,t.m_sprite=null,t.m_drawScale=1,t.m_lineThickness=1,t.m_alpha=1,t.m_fillAlpha=1,t.m_xformScale=1,t.SetFlags=function(e){this.m_drawFlags=e},t.GetFlags=function(){return this.m_drawFlags},t.AppendFlags=function(e){this.m_drawFlags|=e},t.ClearFlags=function(e){this.m_drawFlags&=~e},t.DrawPolygon=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n,this.m_alpha),this.m_sprite.graphics.moveTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale);for(n=1;n<t;n++)this.m_sprite.graphics.lineTo(e[n].x*this.m_drawScale,e[n].y*this.m_drawScale);this.m_sprite.graphics.lineTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale)},t.DrawSolidPolygon=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n,this.m_alpha),this.m_sprite.graphics.moveTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale),this.m_sprite.graphics.beginFill(n,this.m_fillAlpha);for(n=1;n<t;n++)this.m_sprite.graphics.lineTo(e[n].x*this.m_drawScale,e[n].y*this.m_drawScale);this.m_sprite.graphics.lineTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale),this.m_sprite.graphics.endFill()},t.DrawCircle=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n,this.m_alpha),this.m_sprite.graphics.drawCircle(e.x*this.m_drawScale,e.y*this.m_drawScale,t*this.m_drawScale)},t.DrawSolidCircle=function(e,t,n,r){this.m_sprite.graphics.lineStyle(this.m_lineThickness,r,this.m_alpha),this.m_sprite.graphics.moveTo(0,0),this.m_sprite.graphics.beginFill(r,this.m_fillAlpha),this.m_sprite.graphics.drawCircle(e.x*this.m_drawScale,e.y*this.m_drawScale,t*this.m_drawScale),this.m_sprite.graphics.endFill(),this.m_sprite.graphics.moveTo(e.x*this.m_drawScale,e.y*this.m_drawScale),this.m_sprite.graphics.lineTo((e.x+n.x*t)*this.m_drawScale,(e.y+n.y*t)*this.m_drawScale)},t.DrawSegment=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n,this.m_alpha),this.m_sprite.graphics.moveTo(e.x*this.m_drawScale,e.y*this.m_drawScale),this.m_sprite.graphics.lineTo(t.x*this.m_drawScale,t.y*this.m_drawScale)},t.DrawXForm=function(e){this.m_sprite.graphics.lineStyle(this.m_lineThickness,16711680,this.m_alpha),this.m_sprite.graphics.moveTo(e.position.x*this.m_drawScale,e.position.y*this.m_drawScale),this.m_sprite.graphics.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*this.m_drawScale,(e.position.y+this.m_xformScale*e.R.col1.y)*this.m_drawScale),this.m_sprite.graphics.lineStyle(this.m_lineThickness,65280,this.m_alpha),this.m_sprite.graphics.moveTo(e.position.x*this.m_drawScale,e.position.y*this.m_drawScale),this.m_sprite.graphics.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*this.m_drawScale,(e.position.y+this.m_xformScale*e.R.col2.y)*this.m_drawScale)},e.ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactEdge.prototype,t.__constructor=function(){},t.__varz=function(){},t.other=null,t.contact=null,t.prev=null,t.next=null,e.Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.Sweep.prototype,t.__constructor=function(){},t.__varz=function(){this.localCenter=new e.Vec2,this.c0=new e.Vec2,this.c=new e.Vec2},t.localCenter=new e.Vec2,t.c0=new e.Vec2,t.c=new e.Vec2,t.a0=null,t.a=null,t.t0=null,t.GetXForm=function(e,t){1-this.t0>Number.MIN_VALUE?(t=(t-this.t0)/(1-this.t0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a)):(e.position.SetV(this.c),e.R.Set(this.a)),t=e.R,e.position.x-=t.col1.x*this.localCenter.x+t.col2.x*this.localCenter.y,e.position.y-=t.col1.y*this.localCenter.x+t.col2.y*this.localCenter.y},t.Advance=function(e){if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},e.ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactConstraint.prototype,t.__constructor=function(){this.points=new Array(e.Settings.maxManifoldPoints);for(var t=0;t<e.Settings.maxManifoldPoints;t++)this.points[t]=new e.ContactConstraintPoint},t.__varz=function(){this.normal=new e.Vec2},t.points=null,t.normal=new e.Vec2,t.manifold=null,t.body1=null,t.body2=null,t.friction=null,t.restitution=null,t.pointCount=0,e.Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Distance.prototype.__constructor=function(){},e.Distance.prototype.__varz=function(){},e.Distance.g_GJK_Iterations=0,e.Distance.s_p1s=[new e.Vec2,new e.Vec2,new e.Vec2],e.Distance.s_p2s=[new e.Vec2,new e.Vec2,new e.Vec2],e.Distance.s_points=[new e.Vec2,new e.Vec2,new e.Vec2],e.Distance.gPoint=new e.Point,e.Distance.ProcessTwo=function(e,t,n,r,i){var s=i[0];i=i[1];var o=n[0];n=n[1];var u=r[0];r=r[1];var a=-i.x,f=-i.y,l=s.x-i.x,c=s.y-i.y,h=Math.sqrt(l*l+c*c);return l/=h,c/=h,a=a*l+f*c,a<=0||h<Number.MIN_VALUE?(e.SetV(n),t.SetV(r),o.SetV(n),u.SetV(r),s.SetV(i),1):(a/=h,e.x=n.x+a*(o.x-n.x),e.y=n.y+a*(o.y-n.y),t.x=r.x+a*(u.x-r.x),t.y=r.y+a*(u.y-r.y),2)},e.Distance.ProcessThree=function(e,t,n,r,i){var s=i[0],o=i[1],u=i[2];i=n[0];var a=n[1];n=n[2];var f=r[0],l=r[1];r=r[2];var c=s.x,h=s.y,p=o.x,d=o.y,v=u.x,m=u.y,g=p-c,y=d-h,b=v-c,w=m-h,E=v-p,S=m-d,x=-(c*b+h*w),T=v*b+m*w,N=-(p*E+d*S);return E=v*E+m*S,T<=0&&E<=0?(e.SetV(n),t.SetV(r),i.SetV(n),f.SetV(r),s.SetV(u),1):(y=g*w-y*b,g=y*(c*d-h*p),p=y*(p*m-d*v),p<=0&&N>=0&&E>=0&&N+E>0?(x=N/(N+E),e.x=a.x+x*(n.x-a.x),e.y=a.y+x*(n.y-a.y),t.x=l.x+x*(r.x-l.x),t.y=l.y+x*(r.y-l.y),i.SetV(n),f.SetV(r),s.SetV(u),2):(s=y*(v*h-m*c),s<=0&&x>=0&&T>=0&&x+T>0?(x/=x+T,e.x=i.x+x*(n.x-i.x),e.y=i.y+x*(n.y-i.y),t.x=f.x+x*(r.x-f.x),t.y=f.y+x*(r.y-f.y),a.SetV(n),l.SetV(r),o.SetV(u),2):(u=p+s+g,u=1/u,o=p*u,s*=u,u=1-o-s,e.x=o*i.x+s*a.x+u*n.x,e.y=o*i.y+s*a.y+u*n.y,t.x=o*f.x+s*l.x+u*r.x,t.y=o*f.y+s*l.y+u*r.y,3)))},e.Distance.InPoints=function(e,t,n){for(var r=100*Number.MIN_VALUE,i=0;i<n;++i){var s=t[i],o=Math.abs(e.x-s.x),u=Math.abs(e.y-s.y),a=Math.max(Math.abs(e.x),Math.abs(s.x));s=Math.max(Math.abs(e.y),Math.abs(s.y));if(o<r*(a+1)&&u<r*(s+1))return!0}return!1},e.Distance.DistanceGeneric=function(t,n,r,i,s,o){var u,a=e.Distance.s_p1s,f=e.Distance.s_p2s,l=e.Distance.s_points,c=0;t.SetV(r.GetFirstVertex(i)),n.SetV(s.GetFirstVertex(o));for(var h=0,p=0;p<20;++p){u=n.x-t.x;var d=n.y-t.y,v=r.Support(i,u,d),m=s.Support(o,-u,-d);h=u*u+d*d;var g=m.x-v.x,y=m.y-v.y;if(h-(u*g+d*y)<=.01*h)return c==0&&(t.SetV(v),n.SetV(m)),e.Distance.g_GJK_Iterations=p,Math.sqrt(h);switch(c){case 0:u=a[0],u.SetV(v),u=f[0],u.SetV(m),u=l[0],u.x=g,u.y=y,t.SetV(a[0]),n.SetV(f[0]),++c;break;case 1:u=a[1],u.SetV(v),u=f[1],u.SetV(m),u=l[1],u.x=g,u.y=y,c=e.Distance.ProcessTwo(t,n,a,f,l);break;case 2:u=a[2],u.SetV(v),u=f[2],u.SetV(m),u=l[2],u.x=g,u.y=y,c=e.Distance.ProcessThree(t,n,a,f,l)}if(c==3)return e.Distance.g_GJK_Iterations=p,0;v=-Number.MAX_VALUE;for(m=0;m<c;++m)u=l[m],v=e.Math.Max(v,u.x*u.x+u.y*u.y);if(c==3||h<=100*Number.MIN_VALUE*v)return e.Distance.g_GJK_Iterations=p,u=n.x-t.x,d=n.y-t.y,h=u*u+d*d,Math.sqrt(h)}return e.Distance.g_GJK_Iterations=20,Math.sqrt(h)},e.Distance.DistanceCC=function(t,n,r,i,s,o){var u,a;u=i.R,a=r.m_localPosition;var f=i.position.x+(u.col1.x*a.x+u.col2.x*a.y);i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),u=o.R,a=s.m_localPosition;var l=o.position.x+(u.col1.x*a.x+u.col2.x*a.y);o=o.position.y+(u.col1.y*a.x+u.col2.y*a.y),u=l-f,a=o-i;var c=u*u+a*a;r=r.m_radius-e.Settings.toiSlop,s=s.m_radius-e.Settings.toiSlop;var h=r+s;return c>h*h?(c=Math.sqrt(u*u+a*a),u/=c,a/=c,c-=h,t.x=f+r*u,t.y=i+r*a,n.x=l-s*u,n.y=o-s*a,c):c>Number.MIN_VALUE*Number.MIN_VALUE?(c=Math.sqrt(u*u+a*a),u/=c,a/=c,t.x=f+r*u,t.y=i+r*a,n.x=t.x,n.y=t.y,0):(t.x=f,t.y=i,n.x=t.x,n.y=t.y,0)},e.Distance.DistancePC=function(t,n,r,i,s,o){var u,a,f=e.Distance.gPoint;return a=s.m_localPosition,u=o.R,f.p.x=o.position.x+(u.col1.x*a.x+u.col2.x*a.y),f.p.y=o.position.y+(u.col1.y*a.x+u.col2.y*a.y),r=e.Distance.DistanceGeneric(t,n,r,i,f,e.Math.XForm_identity),s=s.m_radius-e.Settings.toiSlop,r>s?(r-=s,i=n.x-t.x,t=n.y-t.y,o=Math.sqrt(i*i+t*t),i/=o,t/=o,n.x-=s*i,n.y-=s*t):(r=0,n.x=t.x,n.y=t.y),r},e.Distance.Distance=function(t,n,r,i,s,o){var u=r.m_type,a=s.m_type;return u==e.Shape.e_circleShape&&a==e.Shape.e_circleShape?e.Distance.DistanceCC(t,n,r,i,s,o):u==e.Shape.e_polygonShape&&a==e.Shape.e_circleShape?e.Distance.DistancePC(t,n,r,i,s,o):u==e.Shape.e_circleShape&&a==e.Shape.e_polygonShape?e.Distance.DistancePC(n,t,s,o,r,i):u==e.Shape.e_polygonShape&&a==e.Shape.e_polygonShape?e.Distance.DistanceGeneric(t,n,r,i,s,o):0},e.Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Shape.prototype.__constructor=function(t){this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_density=t.density,this.m_body=null,this.m_sweepRadius=0,this.m_next=null,this.m_proxyId=e.Pair.nullProxy,this.m_filter=t.filter.Copy(),this.m_isSensor=t.isSensor},e.Shape.prototype.__varz=function(){},e.Shape.e_unknownShape=-1,e.Shape.e_circleShape=0,e.Shape.e_polygonShape=1,e.Shape.e_shapeTypeCount=2,e.Shape.e_hitCollide=1,e.Shape.e_missCollide=0,e.Shape.e_startsInsideCollide=-1,e.Shape.s_proxyAABB=new e.AABB,e.Shape.s_syncAABB=new e.AABB,e.Shape.s_resetAABB=new e.AABB,e.Shape.Create=function(t){switch(t.type){case e.Shape.e_circleShape:return new e.CircleShape(t);case e.Shape.e_polygonShape:return new e.PolygonShape(t);default:return null}},e.Shape.Destroy=function(){},t=e.Shape.prototype,t.m_type=0,t.m_next=null,t.m_body=null,t.m_sweepRadius=null,t.m_density=null,t.m_friction=null,t.m_restitution=null,t.m_proxyId=0,t.m_filter=null,t.m_isSensor=null,t.m_userData=null,t.GetType=function(){return this.m_type},t.IsSensor=function(){return this.m_isSensor},t.SetFilterData=function(e){this.m_filter=e.Copy()},t.GetFilterData=function(){return this.m_filter.Copy()},t.GetBody=function(){return this.m_body},t.GetNext=function(){return this.m_next},t.GetUserData=function(){return this.m_userData},t.SetUserData=function(e){this.m_userData=e},t.TestPoint=function(){return!1},t.TestSegment=function(){return e.Shape.e_missCollide},t.ComputeAABB=function(){},t.ComputeSweptAABB=function(){},t.ComputeMass=function(){},t.GetSweepRadius=function(){return this.m_sweepRadius},t.GetFriction=function(){return this.m_friction},t.GetRestitution=function(){return this.m_restitution},t.CreateProxy=function(t,n){var r=e.Shape.s_proxyAABB;this.ComputeAABB(r,n),this.m_proxyId=t.InRange(r)?t.CreateProxy(r,this):e.Pair.nullProxy},t.DestroyProxy=function(t){this.m_proxyId!=e.Pair.nullProxy&&(t.DestroyProxy(this.m_proxyId),this.m_proxyId=e.Pair.nullProxy)},t.Synchronize=function(t,n,r){if(this.m_proxyId==e.Pair.nullProxy)return!1;var i=e.Shape.s_syncAABB;return this.ComputeSweptAABB(i,n,r),t.InRange(i)?(t.MoveProxy(this.m_proxyId,i),!0):!1},t.RefilterProxy=function(t,n){if(this.m_proxyId!=e.Pair.nullProxy){t.DestroyProxy(this.m_proxyId);var r=e.Shape.s_resetAABB;this.ComputeAABB(r,n),this.m_proxyId=t.InRange(r)?t.CreateProxy(r,this):e.Pair.nullProxy}},t.UpdateSweepRadius=function(){},e.XForm=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.XForm.prototype,t.__constructor=function(e,t){e&&(this.position.SetV(e),this.R.SetM(t))},t.__varz=function(){this.position=new e.Vec2,this.R=new e.Mat22},t.position=new e.Vec2,t.R=new e.Mat22,t.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},t.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},t.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},e.DistanceJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.DistanceJointDef.prototype,e.JointDef.prototype),t=e.DistanceJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},t.__varz=function(){this.localAnchor1=new e.Vec2,this.localAnchor2=new e.Vec2},t.localAnchor1=new e.Vec2,t.localAnchor2=new e.Vec2,t.length=null,t.frequencyHz=null,t.dampingRatio=null,t.Initialize=function(e,t,n,r){this.body1=e,this.body2=t,this.localAnchor1.SetV(this.body1.GetLocalPoint(n)),this.localAnchor2.SetV(this.body2.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},e.OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.OBB.prototype,t.__constructor=function(){},t.__varz=function(){this.R=new e.Mat22,this.center=new e.Vec2,this.extents=new e.Vec2},t.R=new e.Mat22,t.center=new e.Vec2,t.extents=new e.Vec2,e.BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.BodyDef.prototype,t.__constructor=function(){this.massData.center.SetZero(),this.massData.mass=0,this.massData.I=0,this.userData=null,this.position.Set(0,0),this.angularDamping=this.linearDamping=this.angle=0,this.allowSleep=!0,this.isBullet=this.fixedRotation=this.isSleeping=!1},t.__varz=function(){this.massData=new e.MassData,this.position=new e.Vec2},t.massData=new e.MassData,t.userData=null,t.position=new e.Vec2,t.angle=null,t.linearDamping=null,t.angularDamping=null,t.allowSleep=null,t.isSleeping=null,t.fixedRotation=null,t.isBullet=null,e.PrismaticJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PrismaticJointDef.prototype,e.JointDef.prototype),t=e.PrismaticJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_prismaticJoint,this.localAxis1.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},t.__varz=function(){this.localAnchor1=new e.Vec2,this.localAnchor2=new e.Vec2,this.localAxis1=new e.Vec2},t.localAnchor1=new e.Vec2,t.localAnchor2=new e.Vec2,t.localAxis1=new e.Vec2,t.referenceAngle=null,t.enableLimit=null,t.lowerTranslation=null,t.upperTranslation=null,t.enableMotor=null,t.maxMotorForce=null,t.motorSpeed=null,t.Initialize=function(e,t,n,r){this.body1=e,this.body2=t,this.localAnchor1=this.body1.GetLocalPoint(n),this.localAnchor2=this.body2.GetLocalPoint(n),this.localAxis1=this.body1.GetLocalVector(r),this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()},e.ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.ContactID.prototype={key:function(){return this._key},key:function(e){this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}},t=e.ContactID.prototype,t.__constructor=function(){this.features._m_id=this},t.__varz=function(){this.features=new r},t.features=new r,t._key=0,t.Set=function(e){this.key=e._key},t.Copy=function(){var t=new e.ContactID;return t.key=this._key,t},e.RevoluteJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.RevoluteJointDef.prototype,e.JointDef.prototype),t=e.RevoluteJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_revoluteJoint,this.localAnchor1.Set(0,0),this.localAnchor2.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},t.__varz=function(){this.localAnchor1=new e.Vec2,this.localAnchor2=new e.Vec2},t.localAnchor1=new e.Vec2,t.localAnchor2=new e.Vec2,t.referenceAngle=null,t.enableLimit=null,t.lowerAngle=null,t.upperAngle=null,t.enableMotor=null,t.motorSpeed=null,t.maxMotorTorque=null,t.Initialize=function(e,t,n){this.body1=e,this.body2=t,this.localAnchor1=this.body1.GetLocalPoint(n),this.localAnchor2=this.body2.GetLocalPoint(n),this.referenceAngle=this.body2.GetAngle()-this.body1.GetAngle()},e.CircleShape=function(){e.Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.CircleShape.prototype,e.Shape.prototype),t=e.CircleShape.prototype,t._super=function(){e.Shape.prototype.__constructor.apply(this,arguments)},t.__constructor=function(t){this._super(t),this.m_type=e.Shape.e_circleShape,this.m_localPosition.SetV(t.localPosition),this.m_radius=t.radius},t.__varz=function(){this.m_localPosition=new e.Vec2},t.m_localPosition=new e.Vec2,t.m_radius=null,t.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_localPosition.x+n.col2.x*this.m_localPosition.y);return e=e.position.y+(n.col1.y*this.m_localPosition.x+n.col2.y*this.m_localPosition.y),r=t.x-r,e=t.y-e,r*r+e*e<=this.m_radius*this.m_radius},t.TestSegment=function(t,n,r,i,s){var o=t.R,u=i.p1.x-(t.position.x+(o.col1.x*this.m_localPosition.x+o.col2.x*this.m_localPosition.y));t=i.p1.y-(t.position.y+(o.col1.y*this.m_localPosition.x+o.col2.y*this.m_localPosition.y));var a=u*u+t*t-this.m_radius*this.m_radius;if(a<0)return n[0]=0,e.Shape.e_startsInsideCollide;o=i.p2.x-i.p1.x,i=i.p2.y-i.p1.y;var f=u*o+t*i,l=o*o+i*i;return a=f*f-l*a,a<0||l<Number.MIN_VALUE?e.Shape.e_missCollide:(a=-(f+Math.sqrt(a)),0<=a&&a<=s*l?(a/=l,n[0]=a,r.x=u+a*o,r.y=t+a*i,r.Normalize(),e.Shape.e_hitCollide):e.Shape.e_missCollide)},t.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_localPosition.x+n.col2.x*this.m_localPosition.y);t=t.position.y+(n.col1.y*this.m_localPosition.x+n.col2.y*this.m_localPosition.y),e.lowerBound.Set(r-this.m_radius,t-this.m_radius),e.upperBound.Set(r+this.m_radius,t+this.m_radius)},t.ComputeSweptAABB=function(e,t,n){var r;r=t.R;var i=t.position.x+(r.col1.x*this.m_localPosition.x+r.col2.x*this.m_localPosition.y);t=t.position.y+(r.col1.y*this.m_localPosition.x+r.col2.y*this.m_localPosition.y),r=n.R;var s=n.position.x+(r.col1.x*this.m_localPosition.x+r.col2.x*this.m_localPosition.y);n=n.position.y+(r.col1.y*this.m_localPosition.x+r.col2.y*this.m_localPosition.y),e.lowerBound.Set((i<s?i:s)-this.m_radius,(t<n?t:n)-this.m_radius),e.upperBound.Set((i>s?i:s)+this.m_radius,(t>n?t:n)+this.m_radius)},t.ComputeMass=function(t){t.mass=this.m_density*e.Settings.pi*this.m_radius*this.m_radius,t.center.SetV(this.m_localPosition),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_localPosition.x*this.m_localPosition.x+this.m_localPosition.y*this.m_localPosition.y))},t.GetLocalPosition=function(){return this.m_localPosition},t.GetRadius=function(){return this.m_radius},t.UpdateSweepRadius=function(t){var n=this.m_localPosition.x-t.x;t=this.m_localPosition.y-t.y,n=Math.sqrt(n*n+t*t),this.m_sweepRadius=n+this.m_radius-e.Settings.toiSlop},e.Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Joint.prototype.__constructor=function(e){this.m_type=e.type,this.m_next=this.m_prev=null,this.m_body1=e.body1,this.m_body2=e.body2,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},e.Joint.prototype.__varz=function(){this.m_node1=new e.JointEdge,this.m_node2=new e.JointEdge},e.Joint.e_unknownJoint=0,e.Joint.e_revoluteJoint=1,e.Joint.e_prismaticJoint=2,e.Joint.e_distanceJoint=3,e.Joint.e_pulleyJoint=4,e.Joint.e_mouseJoint=5,e.Joint.e_gearJoint=6,e.Joint.e_inactiveLimit=0,e.Joint.e_atLowerLimit=1,e.Joint.e_atUpperLimit=2,e.Joint.e_equalLimits=3,e.Joint.Create=function(t){var n=null;switch(t.type){case e.Joint.e_distanceJoint:n=new e.DistanceJoint(t);break;case e.Joint.e_mouseJoint:n=new e.MouseJoint(t);break;case e.Joint.e_prismaticJoint:n=new e.PrismaticJoint(t);break;case e.Joint.e_revoluteJoint:n=new e.RevoluteJoint(t);break;case e.Joint.e_pulleyJoint:n=new e.PulleyJoint(t);break;case e.Joint.e_gearJoint:n=new e.GearJoint(t);break;default:}return n},e.Joint.Destroy=function(){},t=e.Joint.prototype,t.m_type=0,t.m_prev=null,t.m_next=null,t.m_node1=new e.JointEdge,t.m_node2=new e.JointEdge,t.m_body1=null,t.m_body2=null,t.m_inv_dt=null,t.m_islandFlag=null,t.m_collideConnected=null,t.m_userData=null,t.GetType=function(){return this.m_type},t.GetAnchor1=function(){return null},t.GetAnchor2=function(){return null},t.GetReactionForce=function(){return null},t.GetReactionTorque=function(){return 0},t.GetBody1=function(){return this.m_body1},t.GetBody2=function(){return this.m_body2},t.GetNext=function(){return this.m_next},t.GetUserData=function(){return this.m_userData},t.SetUserData=function(e){this.m_userData=e},t.InitVelocityConstraints=function(){},t.SolveVelocityConstraints=function(){},t.InitPositionConstraints=function(){},t.SolvePositionConstraints=function(){return!1},e.GearJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.GearJoint.prototype,e.Joint.prototype),t=e.GearJoint.prototype,t._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},t.__constructor=function(t){this._super(t);var n=t.joint1.m_type,r=t.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null,this.m_ground1=t.joint1.m_body1,this.m_body1=t.joint1.m_body2,n==e.Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),n=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),n=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.m_body1,this.m_body2=t.joint2.m_body2,r==e.Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),r=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),r=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=n+this.m_ratio*r,this.m_force=0},t.__varz=function(){this.m_groundAnchor1=new e.Vec2,this.m_groundAnchor2=new e.Vec2,this.m_localAnchor1=new e.Vec2,this.m_localAnchor2=new e.Vec2,this.m_J=new e.Jacobian},t.m_ground1=null,t.m_ground2=null,t.m_revolute1=null,t.m_prismatic1=null,t.m_revolute2=null,t.m_prismatic2=null,t.m_groundAnchor1=new e.Vec2,t.m_groundAnchor2=new e.Vec2,t.m_localAnchor1=new e.Vec2,t.m_localAnchor2=new e.Vec2,t.m_J=new e.Jacobian,t.m_constant=null,t.m_ratio=null,t.m_mass=null,t.m_force=null,t.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)},t.GetReactionForce=function(){return new e.Vec2(this.m_force*this.m_J.linear2.x,this.m_force*this.m_J.linear2.y)},t.GetReactionTorque=function(){var e=this.m_body2.m_xf.R,t=this.m_localAnchor1.x-this.m_body2.m_sweep.localCenter.x,n=this.m_localAnchor1.y-this.m_body2.m_sweep.localCenter.y,r=e.col1.x*t+e.col2.x*n;return n=e.col1.y*t+e.col2.y*n,t=r,r=this.m_force*this.m_J.angular2-(t*this.m_force*this.m_J.linear2.y-n*this.m_force*this.m_J.linear2.x)},t.GetRatio=function(){return this.m_ratio},t.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_body1,i=this.m_body2,s,o,u,a,f,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angular1=-1,l+=r.m_invI):(a=t.m_xf.R,s=this.m_prismatic1.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=r.m_xf.R,o=this.m_localAnchor1.x-r.m_sweep.localCenter.x,u=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linear1.Set(-t,-s),this.m_J.angular1=-a,l+=r.m_invMass+r.m_invI*a*a),this.m_revolute2?(this.m_J.angular2=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(a=n.m_xf.R,s=this.m_prismatic2.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=i.m_xf.R,o=this.m_localAnchor2.x-i.m_sweep.localCenter.x,u=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linear2.Set(-this.m_ratio*t,-this.m_ratio*s),this.m_J.angular2=-this.m_ratio*a,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*a*a)),this.m_mass=1/l,e.warmStarting?(e=e.dt*this.m_force,r.m_linearVelocity.x+=r.m_invMass*e*this.m_J.linear1.x,r.m_linearVelocity.y+=r.m_invMass*e*this.m_J.linear1.y,r.m_angularVelocity+=r.m_invI*e*this.m_J.angular1,i.m_linearVelocity.x+=i.m_invMass*e*this.m_J.linear2.x,i.m_linearVelocity.y+=i.m_invMass*e*this.m_J.linear2.y,i.m_angularVelocity+=i.m_invI*e*this.m_J.angular2):this.m_force=0},t.SolveVelocityConstraints=function(e){var t=this.m_body1,n=this.m_body2,r=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity);r=-e.inv_dt*this.m_mass*r,this.m_force+=r,e=e.dt*r,t.m_linearVelocity.x+=t.m_invMass*e*this.m_J.linear1.x,t.m_linearVelocity.y+=t.m_invMass*e*this.m_J.linear1.y,t.m_angularVelocity+=t.m_invI*e*this.m_J.angular1,n.m_linearVelocity.x+=n.m_invMass*e*this.m_J.linear2.x,n.m_linearVelocity.y+=n.m_invMass*e*this.m_J.linear2.y,n.m_angularVelocity+=n.m_invI*e*this.m_J.angular2},t.SolvePositionConstraints=function(){var t=this.m_body1,n=this.m_body2,r,i;return r=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),i=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),r=-this.m_mass*(this.m_constant-(r+this.m_ratio*i)),t.m_sweep.c.x+=t.m_invMass*r*this.m_J.linear1.x,t.m_sweep.c.y+=t.m_invMass*r*this.m_J.linear1.y,t.m_sweep.a+=t.m_invI*r*this.m_J.angular1,n.m_sweep.c.x+=n.m_invMass*r*this.m_J.linear2.x,n.m_sweep.c.y+=n.m_invMass*r*this.m_J.linear2.y,n.m_sweep.a+=n.m_invI*r*this.m_J.angular2,t.SynchronizeTransform(),n.SynchronizeTransform(),0<e.Settings.linearSlop},e.GearJointDef=function(){e.JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.GearJointDef.prototype,e.JointDef.prototype),t=e.GearJointDef.prototype,t._super=function(){e.JointDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},t.__varz=function(){},t.joint1=null,t.joint2=null,t.ratio=null,e.BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.BroadPhase.prototype.__constructor=function(t,n){var r=0;this.m_pairManager.Initialize(this,n),this.m_worldAABB=t;for(r=this.m_proxyCount=0;r<e.Settings.maxProxies;r++)this.m_queryResults[r]=0,this.m_querySortKeys[r]=0;this.m_bounds=new Array(2);for(r=0;r<2;r++){this.m_bounds[r]=new Array(2*e.Settings.maxProxies);for(n=0;n<2*e.Settings.maxProxies;n++)this.m_bounds[r][n]=new e.Bound}r=t.upperBound.y-t.lowerBound.y,this.m_quantizationFactor.x=e.Settings.USHRT_MAX/(t.upperBound.x-t.lowerBound.x),this.m_quantizationFactor.y=e.Settings.USHRT_MAX/r;for(r=0;r<e.Settings.maxProxies-1;++r)t=new e.Proxy,this.m_proxyPool[r]=t,t.SetNext(r+1),t.timeStamp=0,t.overlapCount=e.BroadPhase.invalid,t.userData=null;t=new e.Proxy,this.m_proxyPool[parseInt(e.Settings.maxProxies-1)]=t,t.SetNext(e.Pair.nullProxy),t.timeStamp=0,t.overlapCount=e.BroadPhase.invalid,t.userData=null,this.m_freeProxy=0,this.m_timeStamp=1,this.m_queryResultCount=0},e.BroadPhase.prototype.__varz=function(){this.m_pairManager=new e.PairManager,this.m_proxyPool=new Array(e.Settings.maxPairs),this.m_bounds=new Array(2*e.Settings.maxProxies),this.m_querySortKeys=new Array(e.Settings.maxProxies),this.m_queryResults=new Array(e.Settings.maxProxies),this.m_quantizationFactor=new e.Vec2},e.BroadPhase.s_validate=!1,e.BroadPhase.invalid=e.Settings.USHRT_MAX,e.BroadPhase.nullEdge=e.Settings.USHRT_MAX,e.BroadPhase.BinarySearch=function(e,t,n){var r=0;for(t-=1;r<=t;){var i=Math.round((r+t)/2),s=e[i];if(s.value>n)t=i-1;else{if(!(s.value<n))return parseInt(i);r=i+1}}return parseInt(r)},t=e.BroadPhase.prototype,t.m_pairManager=new e.PairManager,t.m_proxyPool=new Array(e.Settings.maxPairs),t.m_freeProxy=0,t.m_bounds=new Array(2*e.Settings.maxProxies),t.m_querySortKeys=new Array(e.Settings.maxProxies),t.m_queryResults=new Array(e.Settings.maxProxies),t.m_queryResultCount=0,t.m_worldAABB=null,t.m_quantizationFactor=new e.Vec2,t.m_proxyCount=0,t.m_timeStamp=0,t.ComputeBounds=function(t,n,r){var i=r.lowerBound.x,s=r.lowerBound.y;i=e.Math.Min(i,this.m_worldAABB.upperBound.x),s=e.Math.Min(s,this.m_worldAABB.upperBound.y),i=e.Math.Max(i,this.m_worldAABB.lowerBound.x),s=e.Math.Max(s,this.m_worldAABB.lowerBound.y);var o=r.upperBound.x;r=r.upperBound.y,o=e.Math.Min(o,this.m_worldAABB.upperBound.x),r=e.Math.Min(r,this.m_worldAABB.upperBound.y),o=e.Math.Max(o,this.m_worldAABB.lowerBound.x),r=e.Math.Max(r,this.m_worldAABB.lowerBound.y),t[0]=parseInt(this.m_quantizationFactor.x*(i-this.m_worldAABB.lowerBound.x))&e.Settings.USHRT_MAX-1,n[0]=parseInt(this.m_quantizationFactor.x*(o-this.m_worldAABB.lowerBound.x))%65535|1,t[1]=parseInt(this.m_quantizationFactor.y*(s-this.m_worldAABB.lowerBound.y))&e.Settings.USHRT_MAX-1,n[1]=parseInt(this.m_quantizationFactor.y*(r-this.m_worldAABB.lowerBound.y))%65535|1},t.TestOverlapValidate=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[e.lowerBounds[n]],s=r[t.upperBounds[n]];if(i.value>s.value)return!1;i=r[e.upperBounds[n]],s=r[t.lowerBounds[n]];if(i.value<s.value)return!1}return!0},t.Query=function(t,n,r,i,s,o,u){r=e.BroadPhase.BinarySearch(s,o,r),i=e.BroadPhase.BinarySearch(s,o,i);for(var a=r;a<i;++a)o=s[a],o.IsLower()&&this.IncrementOverlapCount(o.proxyId);if(r>0){a=r-1,o=s[a];for(var f=o.stabbingCount;f>0;)o=s[a],o.IsLower()&&r<=this.m_proxyPool[o.proxyId].upperBounds[u]&&(this.IncrementOverlapCount(o.proxyId),--f),--a}t[0]=r,n[0]=i},t.IncrementOverlapCount=function(e){var t=this.m_proxyPool[e];t.timeStamp<this.m_timeStamp?(t.timeStamp=this.m_timeStamp,t.overlapCount=1):(t.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=e,++this.m_queryResultCount)},t.IncrementTimeStamp=function(){if(this.m_timeStamp==e.Settings.USHRT_MAX){for(var t=0;t<e.Settings.maxProxies;++t)this.m_proxyPool[t].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},t.AddProxyResult=function(e,t,n,r){r=r(t.userData);if(!(r<0)){for(t=0;t<this.m_queryResultCount&&this.m_querySortKeys[t]<r;)t++;r=r,e=e,this.m_queryResultCount+=1,this.m_queryResultCount>n&&(this.m_queryResultCount=n);for(;t<this.m_queryResultCount;){n=this.m_querySortKeys[t];var i=this.m_queryResults[t];this.m_querySortKeys[t]=r,this.m_queryResults[t]=e,r=n,e=i,t++}}},t.InRange=function(t){var n,r,i,s;return n=t.lowerBound.x,r=t.lowerBound.y,n-=this.m_worldAABB.upperBound.x,r-=this.m_worldAABB.upperBound.y,i=this.m_worldAABB.lowerBound.x,s=this.m_worldAABB.lowerBound.y,i-=t.upperBound.x,s-=t.upperBound.y,n=e.Math.Max(n,i),r=e.Math.Max(r,s),e.Math.Max(n,r)<0},t.GetProxy=function(t){var n=this.m_proxyPool[t];return t==e.Pair.nullProxy||n.IsValid()==0?null:n},t.CreateProxy=function(t,n){var r=0,i,s=this.m_freeProxy;i=this.m_proxyPool[s],this.m_freeProxy=i.GetNext(),i.overlapCount=0,i.userData=n,n=2*this.m_proxyCount,i=[];var o=[];this.ComputeBounds(i,o,t);for(t=0;t<2;++t){var u=this.m_bounds[t],a=0,f=0;a=[a],f=[f],this.Query(a,f,i[t],o[t],u,n,t),a=a[0],f=f[0];var l=[],c=0,h=n-f,p;for(c=0;c<h;c++)l[c]=new e.Bound,p=l[c],r=u[parseInt(f+c)],p.value=r.value,p.proxyId=r.proxyId,p.stabbingCount=r.stabbingCount;h=l.length;var d=f+2;for(c=0;c<h;c++)r=l[c],p=u[parseInt(d+c)],p.value=r.value,p.proxyId=r.proxyId,p.stabbingCount=r.stabbingCount;l=[],h=f-a;for(c=0;c<h;c++)l[c]=new e.Bound,p=l[c],r=u[parseInt(a+c)],p.value=r.value,p.proxyId=r.proxyId,p.stabbingCount=r.stabbingCount;h=l.length,d=a+1;for(c=0;c<h;c++)r=l[c],p=u[parseInt(d+c)],p.value=r.value,p.proxyId=r.proxyId,p.stabbingCount=r.stabbingCount;++f,p=u[a],r=u[f],p.value=i[t],p.proxyId=s,r.value=o[t],r.proxyId=s,l=u[parseInt(a-1)],p.stabbingCount=a==0?0:l.stabbingCount,l=u[parseInt(f-1)],r.stabbingCount=l.stabbingCount;for(r=a;r<f;++r)l=u[r],l.stabbingCount++;for(r=a;r<n+2;++r)p=u[r],a=this.m_proxyPool[p.proxyId],p.IsLower()?a.lowerBounds[t]=r:a.upperBounds[t]=r}++this.m_proxyCount;for(n=0;n<this.m_queryResultCount;++n)this.m_pairManager.AddBufferedPair(s,this.m_queryResults[n]);return this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),s},t.DestroyProxy=function(t){for(var n,r,i=this.m_proxyPool[t],s=2*this.m_proxyCount,o=0;o<2;++o){var u=this.m_bounds[o],a=i.lowerBounds[o],f=i.upperBounds[o];n=u[a];var l=n.value;r=u[f];var c=r.value,h=[],p=0,d=f-a-1;for(p=0;p<d;p++)h[p]=new e.Bound,n=h[p],r=u[parseInt(a+1+p)],n.value=r.value,n.proxyId=r.proxyId,n.stabbingCount=r.stabbingCount;d=h.length;var v=a;for(p=0;p<d;p++)r=h[p],n=u[parseInt(v+p)],n.value=r.value,n.proxyId=r.proxyId,n.stabbingCount=r.stabbingCount;h=[],d=s-f-1;for(p=0;p<d;p++)h[p]=new e.Bound,n=h[p],r=u[parseInt(f+1+p)],n.value=r.value,n.proxyId=r.proxyId,n.stabbingCount=r.stabbingCount;d=h.length,v=f-1;for(p=0;p<d;p++)r=h[p],n=u[parseInt(v+p)],n.value=r.value,n.proxyId=r.proxyId,n.stabbingCount=r.stabbingCount;d=s-2;for(r=a;r<d;++r)n=u[r],h=this.m_proxyPool[n.proxyId],n.IsLower()?h.lowerBounds[o]=r:h.upperBounds[o]=r;d=f-1;for(a=a;a<d;++a)n=u[a],n.stabbingCount--;this.Query([0],[0],l,c,u,s-2,o)}for(n=0;n<this.m_queryResultCount;++n)this.m_pairManager.RemoveBufferedPair(t,this.m_queryResults[n]);this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),i.userData=null,i.overlapCount=e.BroadPhase.invalid,i.lowerBounds[0]=e.BroadPhase.invalid,i.lowerBounds[1]=e.BroadPhase.invalid,i.upperBounds[0]=e.BroadPhase.invalid,i.upperBounds[1]=e.BroadPhase.invalid,i.SetNext(this.m_freeProxy),this.m_freeProxy=t,--this.m_proxyCount},t.MoveProxy=function(t,n){var r,i,s=0,o=0,u;r=0;if(!(t==e.Pair.nullProxy||e.Settings.maxProxies<=t)&&n.IsValid()!=0){var a=2*this.m_proxyCount,f=this.m_proxyPool[t],l=new e.BoundValues;this.ComputeBounds(l.lowerValues,l.upperValues,n);var c=new e.BoundValues;for(s=0;s<2;++s)n=this.m_bounds[s][f.lowerBounds[s]],c.lowerValues[s]=n.value,n=this.m_bounds[s][f.upperBounds[s]],c.upperValues[s]=n.value;for(s=0;s<2;++s){var h=this.m_bounds[s],p=f.lowerBounds[s],d=f.upperBounds[s],v=l.lowerValues[s],m=l.upperValues[s];n=h[p];var g=v-n.value;n.value=v,n=h[d];var y=m-n.value;n.value=m;if(g<0)for(o=p;o>0&&v<h[parseInt(o-1)].value;)n=h[o],u=h[parseInt(o-1)],r=u.proxyId,i=this.m_proxyPool[u.proxyId],u.stabbingCount++,u.IsUpper()==1?(this.TestOverlap(l,i)&&this.m_pairManager.AddBufferedPair(t,r),r=i.upperBounds,i=r[s],i++,r[s]=i,n.stabbingCount++):(r=i.lowerBounds,i=r[s],i++,r[s]=i,n.stabbingCount--),r=f.lowerBounds,i=r[s],i--,r[s]=i,n.Swap(u),--o;if(y>0)for(o=d;o<a-1&&h[parseInt(o+1)].value<=m;)n=h[o],u=h[parseInt(o+1)],r=u.proxyId,i=this.m_proxyPool[r],u.stabbingCount++,u.IsLower()==1?(this.TestOverlap(l,i)&&this.m_pairManager.AddBufferedPair(t,r),r=i.lowerBounds,i=r[s],i--,r[s]=i,n.stabbingCount++):(r=i.upperBounds,i=r[s],i--,r[s]=i,n.stabbingCount--),r=f.upperBounds,i=r[s],i++,r[s]=i,n.Swap(u),o++;if(g>0)for(o=p;o<a-1&&h[parseInt(o+1)].value<=v;)n=h[o],u=h[parseInt(o+1)],r=u.proxyId,i=this.m_proxyPool[r],u.stabbingCount--,u.IsUpper()?(this.TestOverlap(c,i)&&this.m_pairManager.RemoveBufferedPair(t,r),r=i.upperBounds,i=r[s],i--,r[s]=i,n.stabbingCount--):(r=i.lowerBounds,i=r[s],i--,r[s]=i,n.stabbingCount++),r=f.lowerBounds,i=r[s],i++,r[s]=i,n.Swap(u),o++;if(y<0)for(o=d;o>0&&m<h[parseInt(o-1)].value;)n=h[o],u=h[parseInt(o-1)],r=u.proxyId,i=this.m_proxyPool[r],u.stabbingCount--,u.IsLower()==1?(this.TestOverlap(c,i)&&this.m_pairManager.RemoveBufferedPair(t,r),r=i.lowerBounds,i=r[s],i++,r[s]=i,n.stabbingCount--):(r=i.upperBounds,i=r[s],i++,r[s]=i,n.stabbingCount++),r=f.upperBounds,i=r[s],i--,r[s]=i,n.Swap(u),o--}}},t.Commit=function(){this.m_pairManager.Commit()},t.QueryAABB=function(e,t,n){var r=[],i=[];this.ComputeBounds(r,i,e),e=[0];var s=[0];this.Query(e,s,r[0],i[0],this.m_bounds[0],2*this.m_proxyCount,0),this.Query(e,s,r[1],i[1],this.m_bounds[1],2*this.m_proxyCount,1);for(i=r=0;i<this.m_queryResultCount&&r<n;++i,++r)t[i]=this.m_proxyPool[this.m_queryResults[i]].userData;return this.m_queryResultCount=0,this.IncrementTimeStamp(),r},t.Validate=function(){for(var e=0;e<2;++e)for(var t=this.m_bounds[e],n=2*this.m_proxyCount,r=0,i=0;i<n;++i)t[i].IsLower()==1?r++:r--},t.QuerySegment=function(t,n,r,i){var s=(t.p2.x-t.p1.x)*this.m_quantizationFactor.x,o=(t.p2.y-t.p1.y)*this.m_quantizationFactor.y,u=s<-Number.MIN_VALUE?-1:s>Number.MIN_VALUE?1:0,a=o<-Number.MIN_VALUE?-1:o>Number.MIN_VALUE?1:0,f=this.m_quantizationFactor.x*(t.p1.x-this.m_worldAABB.lowerBound.x);t=this.m_quantizationFactor.y*(t.p1.y-this.m_worldAABB.lowerBound.y);var l=[],c=[];l[0]=parseInt(f)&e.Settings.USHRT_MAX-1,l[1]=parseInt(t)&e.Settings.USHRT_MAX-1,c[0]=l[0]+1,c[1]=l[1]+1;var h=0,p=0,d=0;p=[0],d=[0],this.Query(p,d,l[0],c[0],this.m_bounds[0],2*this.m_proxyCount,0),h=u>=0?d[0]-1:p[0],this.Query(p,d,l[1],c[1],this.m_bounds[1],2*this.m_proxyCount,1),p=a>=0?d[0]-1:p[0];if(i!=null){for(l=0;l<this.m_queryResultCount;l++)this.m_querySortKeys[l]=i(this.m_proxyPool[this.m_queryResults[l]].userData);for(l=0;l<this.m_queryResultCount-1;)c=this.m_querySortKeys[l],d=this.m_querySortKeys[l+1],(c<0?d>=0:c>d&&d>=0)?(this.m_querySortKeys[l+1]=c,this.m_querySortKeys[l]=d,c=this.m_queryResults[l+1],this.m_queryResults[l+1]=this.m_queryResults[l],this.m_queryResults[l]=c,l--,l==-1&&(l=1)):l++;for(;this.m_queryResultCount>0&&this.m_querySortKeys[this.m_queryResultCount-1]<0;)this.m_queryResultCount--}l=!0;var v,m;if(h<0||h>=this.m_proxyCount*2)l=!1;if(p<0||p>=this.m_proxyCount*2)l=!1;l&&(u!=0&&(u>0?(h++,h==this.m_proxyCount*2&&(l=!1)):(h--,h<0&&(l=!1)),v=(this.m_bounds[0][h].value-f)/s),a!=0&&(a>0?(p++,p==this.m_proxyCount*2&&(l=!1)):(p--,p<0&&(l=!1)),m=(this.m_bounds[1][p].value-t)/o));for(;l;)if(a==0||u!=0&&v<m){if(v>1)break;if(u>0?this.m_bounds[0][h].IsLower():this.m_bounds[0][h].IsUpper())d=this.m_bounds[0][h].proxyId,c=this.m_proxyPool[d],a>=0?c.lowerBounds[1]<=p-1&&c.upperBounds[1]>=p&&(i!=null?this.AddProxyResult(d,c,r,i):(this.m_queryResults[this.m_queryResultCount]=d,++this.m_queryResultCount)):c.lowerBounds[1]<=p&&c.upperBounds[1]>=p+1&&(i!=null?this.AddProxyResult(d,c,r,i):(this.m_queryResults[this.m_queryResultCount]=d,++this.m_queryResultCount));if(i!=null&&this.m_queryResultCount==r&&this.m_queryResultCount>0&&v>this.m_querySortKeys[this.m_queryResultCount-1])break;if(u>0){h++;if(h==this.m_proxyCount*2)break}else{h--;if(h<0)break}v=(this.m_bounds[0][h].value-f)/s}else{if(m>1)break;if(a>0?this.m_bounds[1][p].IsLower():this.m_bounds[1][p].IsUpper())d=this.m_bounds[1][p].proxyId,c=this.m_proxyPool[d],u>=0?c.lowerBounds[0]<=h-1&&c.upperBounds[0]>=h&&(i!=null?this.AddProxyResult(d,c,r,i):(this.m_queryResults[this.m_queryResultCount]=d,++this.m_queryResultCount)):c.lowerBounds[0]<=h&&c.upperBounds[0]>=h+1&&(i!=null?this.AddProxyResult(d,c,r,i):(this.m_queryResults[this.m_queryResultCount]=d,++this.m_queryResultCount));if(i!=null&&this.m_queryResultCount==r&&this.m_queryResultCount>0&&m>this.m_querySortKeys[this.m_queryResultCount-1])break;if(a>0){p++;if(p==this.m_proxyCount*2)break}else{p--;if(p<0)break}m=(this.m_bounds[1][p].value-t)/o}for(l=i=0;l<this.m_queryResultCount&&i<r;++l,++i)c=this.m_proxyPool[this.m_queryResults[l]],n[l]=c.userData;return this.m_queryResultCount=0,this.IncrementTimeStamp(),i},t.TestOverlap=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[t.upperBounds[n]];if(e.lowerValues[n]>i.value)return!1;i=r[t.lowerBounds[n]];if(e.upperValues[n]<i.value)return!1}return!0},e.TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.TimeOfImpact.prototype.__constructor=function(){},e.TimeOfImpact.prototype.__varz=function(){},e.TimeOfImpact.s_p1=new e.Vec2,e.TimeOfImpact.s_p2=new e.Vec2,e.TimeOfImpact.s_xf1=new e.XForm,e.TimeOfImpact.s_xf2=new e.XForm,e.TimeOfImpact.TimeOfImpact=function(t,n,r,i){var s,o,u=t.m_sweepRadius,a=r.m_sweepRadius,f=n.t0,l=n.c.x-n.c0.x,c=n.c.y-n.c0.y,h=i.c.x-i.c0.x,p=i.c.y-i.c0.y,d=n.a-n.a0,v=i.a-i.a0,m=0,g=e.TimeOfImpact.s_p1,y=e.TimeOfImpact.s_p2,b=0,w=o=0,E=0;for(s=0;;){E=(1-m)*f+m,o=e.TimeOfImpact.s_xf1,w=e.TimeOfImpact.s_xf2,n.GetXForm(o,E),i.GetXForm(w,E),E=e.Distance.Distance(g,y,t,o,r,w),b==0&&(E>2*e.Settings.toiSlop?s=1.5*e.Settings.toiSlop:(s=.05*e.Settings.toiSlop,o=E-.5*e.Settings.toiSlop,s=s>o?s:o));if(E-s<.05*e.Settings.toiSlop||b==20)break;o=y.x-g.x,w=y.y-g.y;var S=Math.sqrt(o*o+w*w);o/=S,w/=S,o=o*(l-h)+w*(c-p)+(d<0?-d:d)*u+(v<0?-v:v)*a;if(o==0){m=1;break}E=m+(E-s)/o;if(E<0||1<E){m=1;break}if(E<(1+100*Number.MIN_VALUE)*m)break;m=E,++b}return m},e.ShapeDef=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ShapeDef.prototype,t.__constructor=function(){},t.__varz=function(){this.type=e.Shape.e_unknownShape,this.filter=new e.FilterData},t.type=e.Shape.e_unknownShape,t.userData=null,t.friction=.2,t.restitution=0,t.density=0,t.isSensor=!1,t.filter=new e.FilterData,e.PolygonDef=function(){e.ShapeDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PolygonDef.prototype,e.ShapeDef.prototype),e.PolygonDef.prototype._super=function(){e.ShapeDef.prototype.__constructor.apply(this,arguments)},e.PolygonDef.prototype.__constructor=function(){this.type=e.Shape.e_polygonShape;for(var t=this.vertexCount=0;t<e.Settings.maxPolygonVertices;t++)this.vertices[t]=new e.Vec2},e.PolygonDef.prototype.__varz=function(){this.vertices=new Array(e.Settings.maxPolygonVertices)},e.PolygonDef.s_mat=new e.Mat22,e.PolygonDef.prototype.vertices=new Array(e.Settings.maxPolygonVertices),e.PolygonDef.prototype.vertexCount=0,e.PolygonDef.prototype.SetAsBox=function(e,t){this.vertexCount=4,this.vertices[0].Set(-e,-t),this.vertices[1].Set(e,-t),this.vertices[2].Set(e,t),this.vertices[3].Set(-e,t)},e.PolygonDef.prototype.SetAsOrientedBox=function(t,n,r,i){this.vertexCount=4,this.vertices[0].Set(-t,-n),this.vertices[1].Set(t,-n),this.vertices[2].Set(t,n),this.vertices[3].Set(-t,n);if(r){n=r;var s=e.PolygonDef.s_mat;s.Set(i);for(i=0;i<this.vertexCount;++i)r=this.vertices[i],t=n.x+(s.col1.x*r.x+s.col2.x*r.y),r.y=n.y+(s.col1.y*r.x+s.col2.y*r.y),r.x=t}},e.Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Contact.prototype.__constructor=function(t,n){this.m_flags=0;if(!t||!n)this.m_shape2=this.m_shape1=null;else{if(t.IsSensor()||n.IsSensor())this.m_flags|=e.Contact.e_nonSolidFlag;this.m_shape1=t,this.m_shape2=n,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=e.Math.Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_next=this.m_prev=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null}},e.Contact.prototype.__varz=function(){this.m_node1=new e.ContactEdge,this.m_node2=new e.ContactEdge},e.Contact.e_nonSolidFlag=1,e.Contact.e_slowFlag=2,e.Contact.e_islandFlag=4,e.Contact.e_toiFlag=8,e.Contact.s_registers=null,e.Contact.s_initialized=!1,e.Contact.AddType=function(t,n,r,i){e.Contact.s_registers[r][i].createFcn=t,e.Contact.s_registers[r][i].destroyFcn=n,e.Contact.s_registers[r][i].primary=!0,r!=i&&(e.Contact.s_registers[i][r].createFcn=t,e.Contact.s_registers[i][r].destroyFcn=n,e.Contact.s_registers[i][r].primary=!1)},e.Contact.InitializeRegisters=function(){e.Contact.s_registers=new Array(e.Shape.e_shapeTypeCount);for(var t=0;t<e.Shape.e_shapeTypeCount;t++){e.Contact.s_registers[t]=new Array(e.Shape.e_shapeTypeCount);for(var n=0;n<e.Shape.e_shapeTypeCount;n++)e.Contact.s_registers[t][n]=new e.ContactRegister}e.Contact.AddType(e.CircleContact.Create,e.CircleContact.Destroy,e.Shape.e_circleShape,e.Shape.e_circleShape),e.Contact.AddType(e.PolyAndCircleContact.Create,e.PolyAndCircleContact.Destroy,e.Shape.e_polygonShape,e.Shape.e_circleShape),e.Contact.AddType(e.PolygonContact.Create,e.PolygonContact.Destroy,e.Shape.e_polygonShape,e.Shape.e_polygonShape)},e.Contact.Create=function(t,n,r){e.Contact.s_initialized==0&&(e.Contact.InitializeRegisters(),e.Contact.s_initialized=!0);var i=e.Contact.s_registers[t.m_type][n.m_type],s=i.createFcn;if(s!=null){if(i.primary)return s(t,n,r);t=s(n,t,r);for(n=0;n<t.m_manifoldCount;++n)r=t.GetManifolds()[n],r.normal=r.normal.Negative();return t}return null},e.Contact.Destroy=function(t,n){t.m_manifoldCount>0&&(t.m_shape1.m_body.WakeUp(),t.m_shape2.m_body.WakeUp());var r=e.Contact.s_registers[t.m_shape1.m_type][t.m_shape2.m_type].destroyFcn;r(t,n)},t=e.Contact.prototype,t.m_flags=0,t.m_prev=null,t.m_next=null,t.m_node1=new e.ContactEdge,t.m_node2=new e.ContactEdge,t.m_shape1=null,t.m_shape2=null,t.m_manifoldCount=0,t.m_friction=null,t.m_restitution=null,t.m_toi=null,t.GetManifolds=function(){return null},t.GetManifoldCount=function(){return this.m_manifoldCount},t.IsSolid=function(){return(this.m_flags&e.Contact.e_nonSolidFlag)==0},t.GetNext=function(){return this.m_next},t.GetShape1=function(){return this.m_shape1},t.GetShape2=function(){return this.m_shape2},t.Update=function(t){var n=this.m_manifoldCount;this.Evaluate(t),t=this.m_shape1.m_body;var r=this.m_shape2.m_body;this.m_manifoldCount==0&&n>0&&(t.WakeUp(),r.WakeUp()),t.IsStatic()||t.IsBullet()||r.IsStatic()||r.IsBullet()?this.m_flags&=~e.Contact.e_slowFlag:this.m_flags|=e.Contact.e_slowFlag},t.Evaluate=function(){},e.DistanceJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.DistanceJoint.prototype,e.Joint.prototype),t=e.DistanceJoint.prototype,t._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},t.__constructor=function(e){this._super(e),this.m_localAnchor1.SetV(e.localAnchor1),this.m_localAnchor2.SetV(e.localAnchor2),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_inv_dt=this.m_bias=this.m_gamma=this.m_impulse=0},t.__varz=function(){this.m_localAnchor1=new e.Vec2,this.m_localAnchor2=new e.Vec2,this.m_u=new e.Vec2},t.m_localAnchor1=new e.Vec2,t.m_localAnchor2=new e.Vec2,t.m_u=new e.Vec2,t.m_frequencyHz=null,t.m_dampingRatio=null,t.m_gamma=null,t.m_bias=null,t.m_impulse=null,t.m_mass=null,t.m_length=null,t.InitVelocityConstraints=function(t){var n,r;this.m_inv_dt=t.inv_dt;var i=this.m_body1,s=this.m_body2;n=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u,r=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),r>e.Settings.linearSlop?this.m_u.Multiply(1/r):this.m_u.SetZero(),n=o*this.m_u.y-u*this.m_u.x;var l=a*this.m_u.y-f*this.m_u.x;n=i.m_invMass+i.m_invI*n*n+s.m_invMass+s.m_invI*l*l,this.m_mass=1/n;if(this.m_frequencyHz>0){r-=this.m_length,l=2*Math.PI*this.m_frequencyHz;var c=this.m_mass*l*l;this.m_gamma=1/(t.dt*(2*this.m_mass*this.m_dampingRatio*l+t.dt*c)),this.m_bias=r*t.dt*c*this.m_gamma,this.m_mass=1/(n+this.m_gamma)}t.warmStarting?(this.m_impulse*=t.dtRatio,t=this.m_impulse*this.m_u.x,n=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*n,i.m_angularVelocity-=i.m_invI*(o*n-u*t),s.m_linearVelocity.x+=s.m_invMass*t,s.m_linearVelocity.y+=s.m_invMass*n,s.m_angularVelocity+=s.m_invI*(a*n-f*t)):this.m_impulse=0},t.SolveVelocityConstraints=function(){var e,t=this.m_body1,n=this.m_body2;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},t.SolvePositionConstraints=function(){var t;if(this.m_frequencyHz>0)return!0;var n=this.m_body1,r=this.m_body2;t=n.m_xf.R;var i=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y,o=t.col1.x*i+t.col2.x*s;s=t.col1.y*i+t.col2.y*s,i=o,t=r.m_xf.R;var u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,a=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=o,o=r.m_sweep.c.x+u-n.m_sweep.c.x-i;var f=r.m_sweep.c.y+a-n.m_sweep.c.y-s;t=Math.sqrt(o*o+f*f),o/=t,f/=t,t-=this.m_length,t=e.Math.Clamp(t,-e.Settings.maxLinearCorrection,e.Settings.maxLinearCorrection);var l=-this.m_mass*t;return this.m_u.Set(o,f),o=l*this.m_u.x,f=l*this.m_u.y,n.m_sweep.c.x-=n.m_invMass*o,n.m_sweep.c.y-=n.m_invMass*f,n.m_sweep.a-=n.m_invI*(i*f-s*o),r.m_sweep.c.x+=r.m_invMass*o,r.m_sweep.c.y+=r.m_invMass*f,r.m_sweep.a+=r.m_invI*(u*f-a*o),n.SynchronizeTransform(),r.SynchronizeTransform(),e.Math.Abs(t)<e.Settings.linearSlop},t.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)},t.GetReactionForce=function(){var t=new e.Vec2;return t.SetV(this.m_u),t.Multiply(this.m_inv_dt*this.m_impulse),t},t.GetReactionTorque=function(){return 0},e.Body=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Body.prototype.__constructor=function(t,n){this.m_flags=0,t.isBullet&&(this.m_flags|=e.Body.e_bulletFlag),t.fixedRotation&&(this.m_flags|=e.Body.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=e.Body.e_allowSleepFlag),t.isSleeping&&(this.m_flags|=e.Body.e_sleepFlag),this.m_world=n,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep.localCenter.SetV(t.massData.center),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle,n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_next=this.m_prev=this.m_contactList=this.m_jointList=null,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_linearVelocity.SetZero(),this.m_invI=this.m_I=this.m_invMass=this.m_sleepTime=this.m_angularVelocity=0,this.m_mass=t.massData.mass,this.m_mass>0&&(this.m_invMass=1/this.m_mass),(this.m_flags&e.Body.e_fixedRotationFlag)==0&&(this.m_I=t.massData.I),this.m_I>0&&(this.m_invI=1/this.m_I),this.m_type=this.m_invMass==0&&this.m_invI==0?e.Body.e_staticType:e.Body.e_dynamicType,this.m_userData=t.userData,this.m_shapeList=null,this.m_shapeCount=0},e.Body.prototype.__varz=function(){this.m_xf=new e.XForm,this.m_sweep=new e.Sweep,this.m_linearVelocity=new e.Vec2,this.m_force=new e.Vec2},e.Body.e_frozenFlag=2,e.Body.e_islandFlag=4,e.Body.e_sleepFlag=8,e.Body.e_allowSleepFlag=16,e.Body.e_bulletFlag=32,e.Body.e_fixedRotationFlag=64,e.Body.e_staticType=1,e.Body.e_dynamicType=2,e.Body.e_maxTypes=3,e.Body.s_massData=new e.MassData,e.Body.s_xf1=new e.XForm,t=e.Body.prototype,t.m_flags=0,t.m_type=0,t.m_xf=new e.XForm,t.m_sweep=new e.Sweep,t.m_linearVelocity=new e.Vec2,t.m_angularVelocity=null,t.m_force=new e.Vec2,t.m_torque=null,t.m_world=null,t.m_prev=null,t.m_next=null,t.m_shapeList=null,t.m_shapeCount=0,t.m_jointList=null,t.m_contactList=null,t.m_mass=null,t.m_invMass=null,t.m_I=null,t.m_invI=null,t.m_linearDamping=null,t.m_angularDamping=null,t.m_sleepTime=null,t.m_userData=null,t.CreateShape=function(t){return this.m_world.m_lock==1?null:(t=e.Shape.Create(t,this.m_world.m_blockAllocator),t.m_next=this.m_shapeList,this.m_shapeList=t,++this.m_shapeCount,t.m_body=this,t.CreateProxy(this.m_world.m_broadPhase,this.m_xf),t.UpdateSweepRadius(this.m_sweep.localCenter),t)},t.DestroyShape=function(t){if(this.m_world.m_lock!=1){t.DestroyProxy(this.m_world.m_broadPhase);for(var n=this.m_shapeList;n!=null;){if(n==t)break;n=n.m_next}t.m_body=null,t.m_next=null,--this.m_shapeCount,e.Shape.Destroy(t,this.m_world.m_blockAllocator)}},t.SetMass=function(t){if(this.m_world.m_lock!=1){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=t.mass,this.m_mass>0&&(this.m_invMass=1/this.m_mass),(this.m_flags&e.Body.e_fixedRotationFlag)==0&&(this.m_I=t.I),this.m_I>0&&(this.m_invI=1/this.m_I),this.m_sweep.localCenter.SetV(t.center),t=this.m_xf.R;var n=this.m_sweep.localCenter;this.m_sweep.c.x=t.col1.x*n.x+t.col2.x*n.y,this.m_sweep.c.y=t.col1.y*n.x+t.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c);for(t=this.m_shapeList;t;t=t.m_next)t.UpdateSweepRadius(this.m_sweep.localCenter);t=this.m_type,this.m_type=this.m_invMass==0&&this.m_invI==0?e.Body.e_staticType:e.Body.e_dynamicType;if(t!=this.m_type)for(t=this.m_shapeList;t;t=t.m_next)t.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}},t.SetMassFromShapes=function(){var t;if(this.m_world.m_lock!=1){var n=this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,r=0,i=e.Body.s_massData;for(t=this.m_shapeList;t;t=t.m_next)t.ComputeMass(i),this.m_mass+=i.mass,n+=i.mass*i.center.x,r+=i.mass*i.center.y,this.m_I+=i.I;this.m_mass>0&&(this.m_invMass=1/this.m_mass,n*=this.m_invMass,r*=this.m_invMass),this.m_I>0&&(this.m_flags&e.Body.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(n*n+r*r),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,this.m_sweep.localCenter.Set(n,r),t=this.m_xf.R,n=this.m_sweep.localCenter,this.m_sweep.c.x=t.col1.x*n.x+t.col2.x*n.y,this.m_sweep.c.y=t.col1.y*n.x+t.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c);for(t=this.m_shapeList;t;t=t.m_next)t.UpdateSweepRadius(this.m_sweep.localCenter);t=this.m_type,this.m_type=this.m_invMass==0&&this.m_invI==0?e.Body.e_staticType:e.Body.e_dynamicType;if(t!=this.m_type)for(t=this.m_shapeList;t;t=t.m_next)t.RefilterProxy(this.m_world.m_broadPhase,this.m_xf)}},t.SetXForm=function(t,n){if(this.m_world.m_lock==1)return!0;if(this.IsFrozen())return!1;this.m_xf.R.Set(n),this.m_xf.position.SetV(t),t=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=t.col1.x*r.x+t.col2.x*r.y,this.m_sweep.c.y=t.col1.y*r.x+t.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=n,t=!1;for(n=this.m_shapeList;n;n=n.m_next)if(n.Synchronize(this.m_world.m_broadPhase,this.m_xf,this.m_xf)==0){t=!0;break}if(t==1){this.m_flags|=e.Body.e_frozenFlag,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;for(n=this.m_shapeList;n;n=n.m_next)n.DestroyProxy(this.m_world.m_broadPhase);return!1}return this.m_world.m_broadPhase.Commit(),!0},t.GetXForm=function(){return this.m_xf},t.GetPosition=function(){return this.m_xf.position},t.GetAngle=function(){return this.m_sweep.a},t.GetWorldCenter=function(){return this.m_sweep.c},t.GetLocalCenter=function(){return this.m_sweep.localCenter},t.SetLinearVelocity=function(e){this.m_linearVelocity.SetV(e)},t.GetLinearVelocity=function(){return this.m_linearVelocity},t.SetAngularVelocity=function(e){this.m_angularVelocity=e},t.GetAngularVelocity=function(){return this.m_angularVelocity},t.ApplyForce=function(e,t){this.IsSleeping()&&this.WakeUp(),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x},t.ApplyTorque=function(e){this.IsSleeping()&&this.WakeUp(),this.m_torque+=e},t.ApplyImpulse=function(e,t){this.IsSleeping()&&this.WakeUp(),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},t.GetMass=function(){return this.m_mass},t.GetInertia=function(){return this.m_I},t.GetWorldPoint=function(t){var n=this.m_xf.R;return t=new e.Vec2(n.col1.x*t.x+n.col2.x*t.y,n.col1.y*t.x+n.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},t.GetWorldVector=function(t){return e.Math.MulMV(this.m_xf.R,t)},t.GetLocalPoint=function(t){return e.Math.MulXT(this.m_xf,t)},t.GetLocalVector=function(t){return e.Math.MulTMV(this.m_xf.R,t)},t.GetLinearVelocityFromWorldPoint=function(t){return new e.Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(t.x-this.m_sweep.c.x))},t.GetLinearVelocityFromLocalPoint=function(t){var n=this.m_xf.R;return t=new e.Vec2(n.col1.x*t.x+n.col2.x*t.y,n.col1.y*t.x+n.col2.y*t.y),t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,new e.Vec2(this.m_linearVelocity.x+this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.x-this.m_angularVelocity*(t.x-this.m_sweep.c.x))},t.IsBullet=function(){return(this.m_flags&e.Body.e_bulletFlag)==e.Body.e_bulletFlag},t.SetBullet=function(t){t?this.m_flags|=e.Body.e_bulletFlag:this.m_flags&=~e.Body.e_bulletFlag},t.IsStatic=function(){return this.m_type==e.Body.e_staticType},t.IsDynamic=function(){return this.m_type==e.Body.e_dynamicType},t.IsFrozen=function(){return(this.m_flags&e.Body.e_frozenFlag)==e.Body.e_frozenFlag},t.IsSleeping=function(){return(this.m_flags&e.Body.e_sleepFlag)==e.Body.e_sleepFlag},t.AllowSleeping=function(t){t?this.m_flags|=e.Body.e_allowSleepFlag:(this.m_flags&=~e.Body.e_allowSleepFlag,this.WakeUp())},t.WakeUp=function(){this.m_flags&=~e.Body.e_sleepFlag,this.m_sleepTime=0},t.PutToSleep=function(){this.m_flags|=e.Body.e_sleepFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0},t.GetShapeList=function(){return this.m_shapeList},t.GetJointList=function(){return this.m_jointList},t.GetNext=function(){return this.m_next},t.GetUserData=function(){return this.m_userData},t.SetUserData=function(e){this.m_userData=e},t.GetWorld=function(){return this.m_world},t.SynchronizeShapes=function(){var t=e.Body.s_xf1;t.R.Set(this.m_sweep.a0);var n=t.R,r=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(n.col1.x*r.x+n.col2.x*r.y),t.position.y=this.m_sweep.c0.y-(n.col1.y*r.x+n.col2.y*r.y),r=!0;for(n=this.m_shapeList;n;n=n.m_next){r=n.Synchronize(this.m_world.m_broadPhase,t,this.m_xf);if(r==0)break}if(r==0){this.m_flags|=e.Body.e_frozenFlag,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;for(n=this.m_shapeList;n;n=n.m_next)n.DestroyProxy(this.m_world.m_broadPhase);return!1}return!0},t.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},t.IsConnected=function(e){for(var t=this.m_jointList;t;t=t.next)if(t.other==e)return t.joint.m_collideConnected==0;return!1},t.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},e.ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.ContactFilter.prototype.__constructor=function(){},e.ContactFilter.prototype.__varz=function(){},e.ContactFilter.defaultFilter=new e.ContactFilter,e.ContactFilter.prototype.ShouldCollide=function(e,t){return e=e.GetFilterData(),t=t.GetFilterData(),e.groupIndex==t.groupIndex&&e.groupIndex!=0?e.groupIndex>0:(e.maskBits&t.categoryBits)!=0&&(e.categoryBits&t.maskBits)!=0},e.ContactFilter.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e,t):!0},e.PolygonShape=function(){e.Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PolygonShape.prototype,e.Shape.prototype),e.PolygonShape.prototype._super=function(){e.Shape.prototype.__constructor.apply(this,arguments)},e.PolygonShape.prototype.__constructor=function(t){this._super(t),this.m_type=e.Shape.e_polygonShape,this.m_vertexCount=t.vertexCount;var n=0,r=n,i=n;for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=t.vertices[n].Copy();for(n=0;n<this.m_vertexCount;++n){r=n,i=n+1<this.m_vertexCount?n+1:0;var s=this.m_vertices[i].x-this.m_vertices[r].x;r=this.m_vertices[i].y-this.m_vertices[r].y,i=Math.sqrt(s*s+r*r),this.m_normals[n]=new e.Vec2(r/i,-s/i)}this.m_centroid=e.PolygonShape.ComputeCentroid(t.vertices,t.vertexCount),e.PolygonShape.ComputeOBB(this.m_obb,this.m_vertices,this.m_vertexCount);for(n=0;n<this.m_vertexCount;++n){r=n-1>=0?n-1:this.m_vertexCount-1,i=n,t=this.m_normals[r].x,s=this.m_normals[r].y,r=this.m_normals[i].x,i=this.m_normals[i].y;var o=this.m_vertices[n].x-this.m_centroid.x,u=this.m_vertices[n].y-this.m_centroid.y,a=t*o+s*u-e.Settings.toiSlop;o=r*o+i*u-e.Settings.toiSlop,u=1/(t*i-s*r),this.m_coreVertices[n]=new e.Vec2(u*(i*a-s*o)+this.m_centroid.x,u*(t*o-r*a)+this.m_centroid.y)}},e.PolygonShape.prototype.__varz=function(){this.s_supportVec=new e.Vec2,this.m_obb=new e.OBB,this.m_vertices=new Array(e.Settings.maxPolygonVertices),this.m_normals=new Array(e.Settings.maxPolygonVertices),this.m_coreVertices=new Array(e.Settings.maxPolygonVertices)},e.PolygonShape.s_computeMat=new e.Mat22,e.PolygonShape.s_sweptAABB1=new e.AABB,e.PolygonShape.s_sweptAABB2=new e.AABB,e.PolygonShape.ComputeCentroid=function(t,n){for(var r=new e.Vec2,i=0,s=1/3,o=0;o<n;++o){var u=t[o],a=o+1<n?t[parseInt(o+1)]:t[0],f=.5*((u.x-0)*(a.y-0)-(u.y-0)*(a.x-0));i+=f,r.x+=f*s*(0+u.x+a.x),r.y+=f*s*(0+u.y+a.y)}return r.x*=1/i,r.y*=1/i,r},e.PolygonShape.ComputeOBB=function(t,n,r){var i=0,s=new Array(e.Settings.maxPolygonVertices+1);for(i=0;i<r;++i)s[i]=n[i];s[r]=s[0],n=Number.MAX_VALUE;for(i=1;i<=r;++i){var o=s[parseInt(i-1)],u=s[i].x-o.x,a=s[i].y-o.y,f=Math.sqrt(u*u+a*a);u/=f,a/=f;for(var l=-a,c=u,h=f=Number.MAX_VALUE,p=-Number.MAX_VALUE,d=-Number.MAX_VALUE,v=0;v<r;++v){var m=s[v].x-o.x,g=s[v].y-o.y,y=u*m+a*g;m=l*m+c*g,y<f&&(f=y),m<h&&(h=m),y>p&&(p=y),m>d&&(d=m)}v=(p-f)*(d-h),v<.95*n&&(n=v,t.R.col1.x=u,t.R.col1.y=a,t.R.col2.x=l,t.R.col2.y=c,u=.5*(f+p),a=.5*(h+d),l=t.R,t.center.x=o.x+(l.col1.x*u+l.col2.x*a),t.center.y=o.y+(l.col1.y*u+l.col2.y*a),t.extents.x=.5*(p-f),t.extents.y=.5*(d-h))}},t=e.PolygonShape.prototype,t.s_supportVec=new e.Vec2,t.m_centroid=null,t.m_obb=new e.OBB,t.m_vertices=new Array(e.Settings.maxPolygonVertices),t.m_normals=new Array(e.Settings.maxPolygonVertices),t.m_coreVertices=new Array(e.Settings.maxPolygonVertices),t.m_vertexCount=0,t.TestPoint=function(e,t){var n;n=e.R;var r=t.x-e.position.x;e=t.y-e.position.y,t=r*n.col1.x+e*n.col1.y;for(var i=r*n.col2.x+e*n.col2.y,s=0;s<this.m_vertexCount;++s){n=this.m_vertices[s],r=t-n.x,e=i-n.y,n=this.m_normals[s];if(n.x*r+n.y*e>0)return!1}return!0},t.TestSegment=function(t,n,r,i,s){var o=0;s=s;var u,a,f,l;u=i.p1.x-t.position.x,a=i.p1.y-t.position.y,f=t.R;var c=u*f.col1.x+a*f.col1.y,h=u*f.col2.x+a*f.col2.y;u=i.p2.x-t.position.x,a=i.p2.y-t.position.y,f=t.R,i=u*f.col1.x+a*f.col1.y-c,f=u*f.col2.x+a*f.col2.y-h;for(var p=-1,d=0;d<this.m_vertexCount;++d){l=this.m_vertices[d],u=l.x-c,a=l.y-h,l=this.m_normals[d],u=l.x*u+l.y*a,a=l.x*i+l.y*f,a<0&&u<o*a?(o=u/a,p=d):a>0&&u<s*a&&(s=u/a);if(s<o)return e.Shape.e_missCollide}return p>=0?(n[0]=o,f=t.R,l=this.m_normals[p],r.x=f.col1.x*l.x+f.col2.x*l.y,r.y=f.col1.y*l.x+f.col2.y*l.y,e.Shape.e_hitCollide):(n[0]=0,e.Shape.e_startsInsideCollide)},t.ComputeAABB=function(t,n){var r,i,s=e.PolygonShape.s_computeMat;r=n.R,i=this.m_obb.R.col1,s.col1.x=r.col1.x*i.x+r.col2.x*i.y,s.col1.y=r.col1.y*i.x+r.col2.y*i.y,i=this.m_obb.R.col2,s.col2.x=r.col1.x*i.x+r.col2.x*i.y,s.col2.y=r.col1.y*i.x+r.col2.y*i.y,s.Abs(),i=this.m_obb.extents;var o=s.col1.x*i.x+s.col2.x*i.y;s=s.col1.y*i.x+s.col2.y*i.y,r=n.R,i=this.m_obb.center;var u=n.position.x+(r.col1.x*i.x+r.col2.x*i.y);n=n.position.y+(r.col1.y*i.x+r.col2.y*i.y),t.lowerBound.Set(u-o,n-s),t.upperBound.Set(u+o,n+s)},t.ComputeSweptAABB=function(t,n,r){var i=e.PolygonShape.s_sweptAABB1,s=e.PolygonShape.s_sweptAABB2;this.ComputeAABB(i,n),this.ComputeAABB(s,r),t.lowerBound.Set(i.lowerBound.x<s.lowerBound.x?i.lowerBound.x:s.lowerBound.x,i.lowerBound.y<s.lowerBound.y?i.lowerBound.y:s.lowerBound.y),t.upperBound.Set(i.upperBound.x>s.upperBound.x?i.upperBound.x:s.upperBound.x,i.upperBound.y>s.upperBound.y?i.upperBound.y:s.upperBound.y)},t.ComputeMass=function(e){for(var t=0,n=0,r=0,i=0,s=1/3,o=0;o<this.m_vertexCount;++o){var u=this.m_vertices[o],a=o+1<this.m_vertexCount?this.m_vertices[parseInt(o+1)]:this.m_vertices[0],f=u.x-0,l=u.y-0,c=a.x-0,h=a.y-0,p=f*h-l*c,d=.5*p;r+=d,t+=d*s*(0+u.x+a.x),n+=d*s*(0+u.y+a.y),i+=p*(s*(.25*(f*f+c*f+c*c)+(0*f+0*c))+0+(s*(.25*(l*l+h*l+h*h)+(0*l+0*h))+0))}e.mass=this.m_density*r,t*=1/r,n*=1/r,e.center.Set(t,n),e.I=this.m_density*i},t.GetOBB=function(){return this.m_obb},t.GetCentroid=function(){return this.m_centroid},t.GetVertexCount=function(){return this.m_vertexCount},t.GetVertices=function(){return this.m_vertices},t.GetCoreVertices=function(){return this.m_coreVertices},t.GetNormals=function(){return this.m_normals},t.GetFirstVertex=function(t){return e.Math.MulX(t,this.m_coreVertices[0])},t.Centroid=function(t){return e.Math.MulX(t,this.m_centroid)},t.Support=function(e,t,n){var r;r=e.R;var i=t*r.col1.x+n*r.col1.y;r=t*r.col2.x+n*r.col2.y,t=0,n=this.m_coreVertices[0];for(var s=n.x*i+n.y*r,o=1;o<this.m_vertexCount;++o)n=this.m_coreVertices[o],n=n.x*i+n.y*r,n>s&&(t=o,s=n);return r=e.R,n=this.m_coreVertices[t],this.s_supportVec.x=e.position.x+(r.col1.x*n.x+r.col2.x*n.y),this.s_supportVec.y=e.position.y+(r.col1.y*n.x+r.col2.y*n.y),this.s_supportVec},t.UpdateSweepRadius=function(e){var t;for(var n=this.m_sweepRadius=0;n<this.m_vertexCount;++n){t=this.m_coreVertices[n];var r=t.x-e.x;t=t.y-e.y,r=Math.sqrt(r*r+t*t),r>this.m_sweepRadius&&(this.m_sweepRadius=r)}},e.ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactResult.prototype,t.__constructor=function(){},t.__varz=function(){this.position=new e.Vec2,this.normal=new e.Vec2,this.id=new e.ContactID},t.shape1=null,t.shape2=null,t.position=new e.Vec2,t.normal=new e.Vec2,t.normalImpulse=null,t.tangentImpulse=null,t.id=new e.ContactID,e.Island=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Island.prototype.__constructor=function(e,t,n,r,i){var s=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_bodies=new Array(e);for(s=0;s<e;s++)this.m_bodies[s]=null;this.m_contacts=new Array(t);for(s=0;s<t;s++)this.m_contacts[s]=null;this.m_joints=new Array(n);for(s=0;s<n;s++)this.m_joints[s]=null;this.m_positionIterationCount=0},e.Island.prototype.__varz=function(){},e.Island.s_reportCR=new e.ContactResult,t=e.Island.prototype,t.m_allocator=null,t.m_listener=null,t.m_bodies=null,t.m_contacts=null,t.m_joints=null,t.m_bodyCount=0,t.m_jointCount=0,t.m_contactCount=0,t.m_bodyCapacity=0,t.m_contactCapacity=0,t.m_jointCapacity=0,t.m_positionIterationCount=0,t.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},t.Solve=function(t,n,r,i){var s=0,o;for(s=0;s<this.m_bodyCount;++s)o=this.m_bodies[s],o.IsStatic()||(o.m_linearVelocity.x+=t.dt*(n.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=t.dt*(n.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque,o.m_force.SetZero(),o.m_torque=0,o.m_linearVelocity.Multiply(e.Math.Clamp(1-t.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=e.Math.Clamp(1-t.dt*o.m_angularDamping,0,1),o.m_linearVelocity.LengthSquared()>e.Settings.maxLinearVelocitySquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=e.Settings.maxLinearVelocity,o.m_linearVelocity.y*=e.Settings.maxLinearVelocity),o.m_angularVelocity*o.m_angularVelocity>e.Settings.maxAngularVelocitySquared&&(o.m_angularVelocity=o.m_angularVelocity<0?-e.Settings.maxAngularVelocity:e.Settings.maxAngularVelocity));n=new e.ContactSolver(t,this.m_contacts,this.m_contactCount,this.m_allocator),n.InitVelocityConstraints(t);for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o.InitVelocityConstraints(t);for(s=0;s<t.maxIterations;++s){n.SolveVelocityConstraints();for(var u=0;u<this.m_jointCount;++u)o=this.m_joints[u],o.SolveVelocityConstraints(t)}n.FinalizeVelocityConstraints();for(s=0;s<this.m_bodyCount;++s)o=this.m_bodies[s],o.IsStatic()||(o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y,o.m_sweep.a+=t.dt*o.m_angularVelocity,o.SynchronizeTransform());if(r){for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o.InitPositionConstraints();for(this.m_positionIterationCount=0;this.m_positionIterationCount<t.maxIterations;++this.m_positionIterationCount){r=n.SolvePositionConstraints(e.Settings.contactBaumgarte),u=!0;for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o=o.SolvePositionConstraints(),u=u&&o;if(r&&u)break}}this.Report(n.m_constraints);if(i){i=Number.MAX_VALUE,n=e.Settings.linearSleepTolerance*e.Settings.linearSleepTolerance,r=e.Settings.angularSleepTolerance*e.Settings.angularSleepTolerance;for(s=0;s<this.m_bodyCount;++s)o=this.m_bodies[s],o.m_invMass!=0&&((o.m_flags&e.Body.e_allowSleepFlag)==0&&(i=o.m_sleepTime=0),(o.m_flags&e.Body.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>r||e.Math.Dot(o.m_linearVelocity,o.m_linearVelocity)>n?i=o.m_sleepTime=0:(o.m_sleepTime+=t.dt,i=e.Math.Min(i,o.m_sleepTime)));if(i>=e.Settings.timeToSleep)for(s=0;s<this.m_bodyCount;++s)o=this.m_bodies[s],o.m_flags|=e.Body.e_sleepFlag,o.m_linearVelocity.SetZero(),o.m_angularVelocity=0}},t.SolveTOI=function(t){var n=0,r=new e.ContactSolver(t,this.m_contacts,this.m_contactCount,this.m_allocator);for(n=0;n<t.maxIterations;++n)r.SolveVelocityConstraints();for(n=0;n<this.m_bodyCount;++n){var i=this.m_bodies[n];i.IsStatic()||(i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=t.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=t.dt*i.m_linearVelocity.y,i.m_sweep.a+=t.dt*i.m_angularVelocity,i.SynchronizeTransform())}for(n=0;n<t.maxIterations;++n)if(r.SolvePositionConstraints(.75))break;this.Report(r.m_constraints)},t.Report=function(t){if(this.m_listener!=null)for(var n=0;n<this.m_contactCount;++n){var r=this.m_contacts[n],i=t[n],s=e.Island.s_reportCR;s.shape1=r.m_shape1,s.shape2=r.m_shape2;var o=s.shape1.m_body,u=r.m_manifoldCount;r=r.GetManifolds();for(var a=0;a<u;++a){var f=r[a];s.normal.SetV(f.normal);for(var l=0;l<f.pointCount;++l){var c=f.points[l],h=i.points[l];s.position=o.GetWorldPoint(c.localPoint1),s.normalImpulse=h.normalImpulse,s.tangentImpulse=h.tangentImpulse,s.id.key=c.id.key,this.m_listener.Result(s)}}}},t.AddBody=function(e){this.m_bodies[this.m_bodyCount++]=e},t.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},t.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},e.ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ManifoldPoint.prototype,t.__constructor=function(){},t.__varz=function(){this.localPoint1=new e.Vec2,this.localPoint2=new e.Vec2,this.id=new e.ContactID},t.localPoint1=new e.Vec2,t.localPoint2=new e.Vec2,t.separation=null,t.normalImpulse=null,t.tangentImpulse=null,t.id=new e.ContactID,t.Reset=function(){this.localPoint1.SetZero(),this.localPoint2.SetZero(),this.tangentImpulse=this.normalImpulse=this.separation=0,this.id.key=0},t.Set=function(e){this.localPoint1.SetV(e.localPoint1),this.localPoint2.SetV(e.localPoint2),this.separation=e.separation,this.normalImpulse=e.normalImpulse,this.tangentImpulse=e.tangentImpulse,this.id.key=e.id.key},e.Math=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.Math.prototype.__constructor=function(){},e.Math.prototype.__varz=function(){},e.Math.Vec2_zero=new e.Vec2(0,0),e.Math.Mat22_identity=new e.Mat22(0,new e.Vec2(1,0),new e.Vec2(0,1)),e.Math.XForm_identity=new e.XForm(e.Math.Vec2_zero,e.Math.Mat22_identity),e.Math.IsValid=function(e){return isFinite(e)},e.Math.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Math.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},e.Math.CrossVF=function(t,n){return new e.Vec2(n*t.y,-n*t.x)},e.Math.CrossFV=function(t,n){return new e.Vec2(-t*n.y,t*n.x)},e.Math.MulMV=function(t,n){return new e.Vec2(t.col1.x*n.x+t.col2.x*n.y,t.col1.y*n.x+t.col2.y*n.y)},e.Math.MulTMV=function(t,n){return new e.Vec2(e.Math.Dot(n,t.col1),e.Math.Dot(n,t.col2))},e.Math.MulX=function(t,n){return n=e.Math.MulMV(t.R,n),n.x+=t.position.x,n.y+=t.position.y,n},e.Math.MulXT=function(t,n){n=e.Math.SubtractVV(n,t.position);var r=n.x*t.R.col1.x+n.y*t.R.col1.y;return n.y=n.x*t.R.col2.x+n.y*t.R.col2.y,n.x=r,n},e.Math.AddVV=function(t,n){return new e.Vec2(t.x+n.x,t.y+n.y)},e.Math.SubtractVV=function(t,n){return new e.Vec2(t.x-n.x,t.y-n.y)},e.Math.Distance=function(e,t){var n=e.x-t.x;return e=e.y-t.y,Math.sqrt(n*n+e*e)},e.Math.DistanceSquared=function(e,t){var n=e.x-t.x;return e=e.y-t.y,n*n+e*e},e.Math.MulFV=function(t,n){return new e.Vec2(t*n.x,t*n.y)},e.Math.AddMM=function(t,n){return new e.Mat22(0,e.Math.AddVV(t.col1,n.col1),e.Math.AddVV(t.col2,n.col2))},e.Math.MulMM=function(t,n){return new e.Mat22(0,e.Math.MulMV(t,n.col1),e.Math.MulMV(t,n.col2))},e.Math.MulTMM=function(t,n){var r=new e.Vec2(e.Math.Dot(t.col1,n.col1),e.Math.Dot(t.col2,n.col1));return t=new e.Vec2(e.Math.Dot(t.col1,n.col2),e.Math.Dot(t.col2,n.col2)),new e.Mat22(0,r,t)},e.Math.Abs=function(e){return e>0?e:-e},e.Math.AbsV=function(t){return new e.Vec2(e.Math.Abs(t.x),e.Math.Abs(t.y))},e.Math.AbsM=function(t){return new e.Mat22(0,e.Math.AbsV(t.col1),e.Math.AbsV(t.col2))},e.Math.Min=function(e,t){return e<t?e:t},e.Math.MinV=function(t,n){return new e.Vec2(e.Math.Min(t.x,n.x),e.Math.Min(t.y,n.y))},e.Math.Max=function(e,t){return e>t?e:t},e.Math.MaxV=function(t,n){return new e.Vec2(e.Math.Max(t.x,n.x),e.Math.Max(t.y,n.y))},e.Math.Clamp=function(t,n,r){return e.Math.Max(n,e.Math.Min(t,r))},e.Math.ClampV=function(t,n,r){return e.Math.MaxV(n,e.Math.MinV(t,r))},e.Math.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},e.Math.Random=function(){return Math.random()*2-1},e.Math.RandomRange=function(e,t){var n=Math.random();return n=(t-e)*n+e},e.Math.NextPowerOfTwo=function(e){return e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},e.Math.IsPowerOfTwo=function(e){return e>0&&(e&e-1)==0},e.CircleDef=function(){e.ShapeDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.CircleDef.prototype,e.ShapeDef.prototype),t=e.CircleDef.prototype,t._super=function(){e.ShapeDef.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){this.type=e.Shape.e_circleShape,this.radius=1},t.__varz=function(){this.localPosition=new e.Vec2(0,0)},t.localPosition=new e.Vec2(0,0),t.radius=null,e.ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)},t=e.ContactPoint.prototype,t.__constructor=function(){},t.__varz=function(){this.position=new e.Vec2,this.velocity=new e.Vec2,this.normal=new e.Vec2,this.id=new e.ContactID},t.shape1=null,t.shape2=null,t.position=new e.Vec2,t.velocity=new e.Vec2,t.normal=new e.Vec2,t.separation=null,t.friction=null,t.restitution=null,t.id=new e.ContactID,e.PolygonContact=function(){e.Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PolygonContact.prototype,e.Contact.prototype),e.PolygonContact.prototype._super=function(){e.Contact.prototype.__constructor.apply(this,arguments)},e.PolygonContact.prototype.__constructor=function(e,t){this._super(e,t),this.m_manifold=this.m_manifolds[0],this.m_manifold.pointCount=0},e.PolygonContact.prototype.__varz=function(){this.m0=new e.Manifold,this.m_manifolds=[new e.Manifold]},e.PolygonContact.s_evalCP=new e.ContactPoint,e.PolygonContact.Create=function(t,n){return new e.PolygonContact(t,n)},e.PolygonContact.Destroy=function(){},t=e.PolygonContact.prototype,t.m0=new e.Manifold,t.m_manifolds=[new e.Manifold],t.m_manifold=null,t.Evaluate=function(t){var n,r,i,s=this.m_shape1.m_body,o=this.m_shape2.m_body,u,a=0;this.m0.Set(this.m_manifold),e.Collision.CollidePolygons(this.m_manifold,this.m_shape1,s.m_xf,this.m_shape2,o.m_xf);var f=[!1,!1];u=e.PolygonContact.s_evalCP,u.shape1=this.m_shape1,u.shape2=this.m_shape2,u.friction=this.m_friction,u.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(a=0;a<this.m_manifold.pointCount;++a){var l=this.m_manifold.points[a];l.normalImpulse=0,l.tangentImpulse=0;var c=!1,h=l.id._key;for(n=0;n<this.m0.pointCount;++n)if(f[n]!=1){i=this.m0.points[n];if(i.id._key==h){f[n]=!0,l.normalImpulse=i.normalImpulse,l.tangentImpulse=i.tangentImpulse,c=!0,t!=null&&(u.position=s.GetWorldPoint(l.localPoint1),n=s.GetLinearVelocityFromLocalPoint(l.localPoint1),r=o.GetLinearVelocityFromLocalPoint(l.localPoint2),u.velocity.Set(r.x-n.x,r.y-n.y),u.normal.SetV(this.m_manifold.normal),u.separation=l.separation,u.id.key=h,t.Persist(u));break}}c==0&&t!=null&&(u.position=s.GetWorldPoint(l.localPoint1),n=s.GetLinearVelocityFromLocalPoint(l.localPoint1),r=o.GetLinearVelocityFromLocalPoint(l.localPoint2),u.velocity.Set(r.x-n.x,r.y-n.y),u.normal.SetV(this.m_manifold.normal),u.separation=l.separation,u.id.key=h,t.Add(u))}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(t!=null)for(a=0;a<this.m0.pointCount;++a)f[a]||(i=this.m0.points[a],u.position=s.GetWorldPoint(i.localPoint1),n=s.GetLinearVelocityFromLocalPoint(i.localPoint1),r=o.GetLinearVelocityFromLocalPoint(i.localPoint2),u.velocity.Set(r.x-n.x,r.y-n.y),u.normal.SetV(this.m0.normal),u.separation=i.separation,u.id.key=i.id._key,t.Remove(u))},t.GetManifolds=function(){return this.m_manifolds},e.MouseJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.MouseJoint.prototype,e.Joint.prototype),t=e.MouseJoint.prototype,t._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},t.__constructor=function(t){this._super(t),this.m_target.SetV(t.target);var n=this.m_target.x-this.m_body2.m_xf.position.x,r=this.m_target.y-this.m_body2.m_xf.position.y,i=this.m_body2.m_xf.R;this.m_localAnchor.x=n*i.col1.x+r*i.col1.y,this.m_localAnchor.y=n*i.col2.x+r*i.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),r=this.m_body2.m_mass,i=2*e.Settings.pi*t.frequencyHz,n=2*r*t.dampingRatio*i,t=t.timeStep*r*i*i,this.m_gamma=1/(n+t),this.m_beta=t/(n+t)},t.__varz=function(){this.K=new e.Mat22,this.K1=new e.Mat22,this.K2=new e.Mat22,this.m_localAnchor=new e.Vec2,this.m_target=new e.Vec2,this.m_impulse=new e.Vec2,this.m_mass=new e.Mat22,this.m_C=new e.Vec2},t.K=new e.Mat22,t.K1=new e.Mat22,t.K2=new e.Mat22,t.m_localAnchor=new e.Vec2,t.m_target=new e.Vec2,t.m_impulse=new e.Vec2,t.m_mass=new e.Mat22,t.m_C=new e.Vec2,t.m_maxForce=null,t.m_beta=null,t.m_gamma=null,t.GetAnchor1=function(){return this.m_target},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor)},t.GetReactionForce=function(){return this.m_impulse},t.GetReactionTorque=function(){return 0},t.SetTarget=function(e){this.m_body2.IsSleeping()&&this.m_body2.WakeUp(),this.m_target=e},t.InitVelocityConstraints=function(e){var t=this.m_body2,n;n=t.m_xf.R;var r=this.m_localAnchor.x-t.m_sweep.localCenter.x,i=this.m_localAnchor.y-t.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_invMass,s=t.m_invI,this.K1.col1.x=n,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=n,this.K2.col1.x=s*i*i,this.K2.col2.x=-s*r*i,this.K2.col1.y=-s*r*i,this.K2.col2.y=s*r*r,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.Invert(this.m_mass),this.m_C.x=t.m_sweep.c.x+r-this.m_target.x,this.m_C.y=t.m_sweep.c.y+i-this.m_target.y,t.m_angularVelocity*=.98;var o=e.dt*this.m_impulse.x;e=e.dt*this.m_impulse.y,t.m_linearVelocity.x+=n*o,t.m_linearVelocity.y+=n*e,t.m_angularVelocity+=s*(r*e-i*o)},t.SolveVelocityConstraints=function(e){var t=this.m_body2,n,r,i;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*e.inv_dt*this.m_C.x+this.m_gamma*e.dt*this.m_impulse.x,i=u+this.m_beta*e.inv_dt*this.m_C.y+this.m_gamma*e.dt*this.m_impulse.y,u=-e.inv_dt*(n.col1.x*r+n.col2.x*i),n=-e.inv_dt*(n.col1.y*r+n.col2.y*i),r=this.m_impulse.x,i=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=n,u=this.m_impulse.Length(),u>this.m_maxForce&&this.m_impulse.Multiply(this.m_maxForce/u),u=this.m_impulse.x-r,n=this.m_impulse.y-i,u=e.dt*u,e=e.dt*n,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*e,t.m_angularVelocity+=t.m_invI*(s*e-o*u)},t.SolvePositionConstraints=function(){return!0},e.CircleContact=function(){e.Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.CircleContact.prototype,e.Contact.prototype),e.CircleContact.prototype._super=function(){e.Contact.prototype.__constructor.apply(this,arguments)},e.CircleContact.prototype.__constructor=function(e,t){this._super(e,t),this.m_manifold=this.m_manifolds[0],this.m_manifold.pointCount=0,e=this.m_manifold.points[0],e.normalImpulse=0,e.tangentImpulse=0},e.CircleContact.prototype.__varz=function(){this.m_manifolds=[new e.Manifold],this.m0=new e.Manifold},e.CircleContact.s_evalCP=new e.ContactPoint,e.CircleContact.Create=function(t,n){return new e.CircleContact(t,n)},e.CircleContact.Destroy=function(){},t=e.CircleContact.prototype,t.m_manifolds=[new e.Manifold],t.m0=new e.Manifold,t.m_manifold=null,t.Evaluate=function(t){var n,r,i;n=this.m_shape1.m_body,r=this.m_shape2.m_body,this.m0.Set(this.m_manifold),e.Collision.CollideCircles(this.m_manifold,this.m_shape1,n.m_xf,this.m_shape2,r.m_xf);var s=e.CircleContact.s_evalCP;s.shape1=this.m_shape1,s.shape2=this.m_shape2,s.friction=this.m_friction,s.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){this.m_manifoldCount=1;var o=this.m_manifold.points[0];this.m0.pointCount==0?(o.normalImpulse=0,o.tangentImpulse=0,t&&(s.position=n.GetWorldPoint(o.localPoint1),n=n.GetLinearVelocityFromLocalPoint(o.localPoint1),r=r.GetLinearVelocityFromLocalPoint(o.localPoint2),s.velocity.Set(r.x-n.x,r.y-n.y),s.normal.SetV(this.m_manifold.normal),s.separation=o.separation,s.id.key=o.id._key,t.Add(s))):(i=this.m0.points[0],o.normalImpulse=i.normalImpulse,o.tangentImpulse=i.tangentImpulse,t&&(s.position=n.GetWorldPoint(o.localPoint1),n=n.GetLinearVelocityFromLocalPoint(o.localPoint1),r=r.GetLinearVelocityFromLocalPoint(o.localPoint2),s.velocity.Set(r.x-n.x,r.y-n.y),s.normal.SetV(this.m_manifold.normal),s.separation=o.separation,s.id.key=o.id._key,t.Persist(s)))}else this.m_manifoldCount=0,this.m0.pointCount>0&&t&&(i=this.m0.points[0],s.position=n.GetWorldPoint(i.localPoint1),n=n.GetLinearVelocityFromLocalPoint(i.localPoint1),r=r.GetLinearVelocityFromLocalPoint(i.localPoint2),s.velocity.Set(r.x-n.x,r.y-n.y),s.normal.SetV(this.m0.normal),s.separation=i.separation,s.id.key=i.id._key,t.Remove(s))},t.GetManifolds=function(){return this.m_manifolds},e.PulleyJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PulleyJoint.prototype,e.Joint.prototype),e.PulleyJoint.prototype._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},e.PulleyJoint.prototype.__constructor=function(t){this._super(t),this.m_ground=this.m_body1.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchor1.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchor1.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchor2.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchor2.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchor1),this.m_localAnchor2.SetV(t.localAnchor2),this.m_ratio=t.ratio,this.m_constant=t.length1+this.m_ratio*t.length2,this.m_maxLength1=e.Math.Min(t.maxLength1,this.m_constant-this.m_ratio*e.PulleyJoint.minPulleyLength),this.m_maxLength2=e.Math.Min(t.maxLength2,(this.m_constant-e.PulleyJoint.minPulleyLength)/this.m_ratio),this.m_limitForce2=this.m_limitForce1=this.m_force=0},e.PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new e.Vec2,this.m_groundAnchor2=new e.Vec2,this.m_localAnchor1=new e.Vec2,this.m_localAnchor2=new e.Vec2,this.m_u1=new e.Vec2,this.m_u2=new e.Vec2},e.PulleyJoint.minPulleyLength=2,t=e.PulleyJoint.prototype,t.m_ground=null,t.m_groundAnchor1=new e.Vec2,t.m_groundAnchor2=new e.Vec2,t.m_localAnchor1=new e.Vec2,t.m_localAnchor2=new e.Vec2,t.m_u1=new e.Vec2,t.m_u2=new e.Vec2,t.m_constant=null,t.m_ratio=null,t.m_maxLength1=null,t.m_maxLength2=null,t.m_pulleyMass=null,t.m_limitMass1=null,t.m_limitMass2=null,t.m_force=null,t.m_limitForce1=null,t.m_limitForce2=null,t.m_positionImpulse=null,t.m_limitPositionImpulse1=null,t.m_limitPositionImpulse2=null,t.m_state=0,t.m_limitState1=0,t.m_limitState2=0,t.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)},t.GetReactionForce=function(){var e=this.m_u2.Copy();return e.Multiply(this.m_force),e},t.GetReactionTorque=function(){return 0},t.GetGroundAnchor1=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},t.GetGroundAnchor2=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},t.GetLength1=function(){var e=this.m_body1.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},t.GetLength2=function(){var e=this.m_body2.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},t.GetRatio=function(){return this.m_ratio},t.InitVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u,i=r.m_sweep.c.x+a,u=r.m_sweep.c.y+f;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(n.m_sweep.c.x+s-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),n.m_sweep.c.y+o-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(i-l,u-c),i=this.m_u1.Length(),u=this.m_u2.Length(),i>e.Settings.linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),u>e.Settings.linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),this.m_constant-i-this.m_ratio*u>0?(this.m_state=e.Joint.e_inactiveLimit,this.m_force=0):(this.m_state=e.Joint.e_atUpperLimit,this.m_positionImpulse=0),i<this.m_maxLength1?(this.m_limitState1=e.Joint.e_inactiveLimit,this.m_limitForce1=0):(this.m_limitState1=e.Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0),u<this.m_maxLength2?(this.m_limitState2=e.Joint.e_inactiveLimit,this.m_limitForce2=0):(this.m_limitState2=e.Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0),i=s*this.m_u1.y-o*this.m_u1.x,u=a*this.m_u2.y-f*this.m_u2.x,this.m_limitMass1=n.m_invMass+n.m_invI*i*i,this.m_limitMass2=r.m_invMass+r.m_invI*u*u,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(i=t.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.x,u=t.dt*(-this.m_force-this.m_limitForce1)*this.m_u1.y,l=t.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.x,t=t.dt*(-this.m_ratio*this.m_force-this.m_limitForce2)*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*i,n.m_linearVelocity.y+=n.m_invMass*u,n.m_angularVelocity+=n.m_invI*(s*u-o*i),r.m_linearVelocity.x+=r.m_invMass*l,r.m_linearVelocity.y+=r.m_invMass*t,r.m_angularVelocity+=r.m_invI*(a*t-f*l)):this.m_limitForce2=this.m_limitForce1=this.m_force=0},t.SolveVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u;var l,c;this.m_state==e.Joint.e_atUpperLimit&&(i=n.m_linearVelocity.x+ -n.m_angularVelocity*o,u=n.m_linearVelocity.y+n.m_angularVelocity*s,l=r.m_linearVelocity.x+ -r.m_angularVelocity*f,c=r.m_linearVelocity.y+r.m_angularVelocity*a,i=-(this.m_u1.x*i+this.m_u1.y*u)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*c),c=-t.inv_dt*this.m_pulleyMass*i,i=this.m_force,this.m_force=e.Math.Max(0,this.m_force+c),c=this.m_force-i,i=-t.dt*c*this.m_u1.x,u=-t.dt*c*this.m_u1.y,l=-t.dt*this.m_ratio*c*this.m_u2.x,c=-t.dt*this.m_ratio*c*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*i,n.m_linearVelocity.y+=n.m_invMass*u,n.m_angularVelocity+=n.m_invI*(s*u-o*i),r.m_linearVelocity.x+=r.m_invMass*l,r.m_linearVelocity.y+=r.m_invMass*c,r.m_angularVelocity+=r.m_invI*(a*c-f*l)),this.m_limitState1==e.Joint.e_atUpperLimit&&(i=n.m_linearVelocity.x+ -n.m_angularVelocity*o,u=n.m_linearVelocity.y+n.m_angularVelocity*s,i=-(this.m_u1.x*i+this.m_u1.y*u),c=-t.inv_dt*this.m_limitMass1*i,i=this.m_limitForce1,this.m_limitForce1=e.Math.Max(0,this.m_limitForce1+c),c=this.m_limitForce1-i,i=-t.dt*c*this.m_u1.x,u=-t.dt*c*this.m_u1.y,n.m_linearVelocity.x+=n.m_invMass*i,n.m_linearVelocity.y+=n.m_invMass*u,n.m_angularVelocity+=n.m_invI*(s*u-o*i)),this.m_limitState2==e.Joint.e_atUpperLimit&&(l=r.m_linearVelocity.x+ -r.m_angularVelocity*f,c=r.m_linearVelocity.y+r.m_angularVelocity*a,i=-(this.m_u2.x*l+this.m_u2.y*c),c=-t.inv_dt*this.m_limitMass2*i,i=this.m_limitForce2,this.m_limitForce2=e.Math.Max(0,this.m_limitForce2+c),c=this.m_limitForce2-i,l=-t.dt*c*this.m_u2.x,c=-t.dt*c*this.m_u2.y,r.m_linearVelocity.x+=r.m_invMass*l,r.m_linearVelocity.y+=r.m_invMass*c,r.m_angularVelocity+=r.m_invI*(a*c-f*l))},t.SolvePositionConstraints=function(){var t=this.m_body1,n=this.m_body2,r,i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,a,f,l,c,h,p,d,v=0;return this.m_state==e.Joint.e_atUpperLimit&&(r=t.m_xf.R,a=this.m_localAnchor1.x-t.m_sweep.localCenter.x,f=this.m_localAnchor1.y-t.m_sweep.localCenter.y,h=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=h,r=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,h=r.col1.x*l+r.col2.x*c,c=r.col1.y*l+r.col2.y*c,l=h,h=t.m_sweep.c.x+a,p=t.m_sweep.c.y+f,d=n.m_sweep.c.x+l,r=n.m_sweep.c.y+c,this.m_u1.Set(h-i,p-s),this.m_u2.Set(d-o,r-u),r=this.m_u1.Length(),h=this.m_u2.Length(),r>e.Settings.linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),h>e.Settings.linearSlop?this.m_u2.Multiply(1/h):this.m_u2.SetZero(),r=this.m_constant-r-this.m_ratio*h,v=e.Math.Max(v,-r),r=e.Math.Clamp(r+e.Settings.linearSlop,-e.Settings.maxLinearCorrection,0),r=-this.m_pulleyMass*r,h=this.m_positionImpulse,this.m_positionImpulse=e.Math.Max(0,this.m_positionImpulse+r),r=this.m_positionImpulse-h,h=-r*this.m_u1.x,p=-r*this.m_u1.y,d=-this.m_ratio*r*this.m_u2.x,r=-this.m_ratio*r*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(a*p-f*h),n.m_sweep.c.x+=n.m_invMass*d,n.m_sweep.c.y+=n.m_invMass*r,n.m_sweep.a+=n.m_invI*(l*r-c*d),t.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==e.Joint.e_atUpperLimit&&(r=t.m_xf.R,a=this.m_localAnchor1.x-t.m_sweep.localCenter.x,f=this.m_localAnchor1.y-t.m_sweep.localCenter.y,h=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=h,h=t.m_sweep.c.x+a,p=t.m_sweep.c.y+f,this.m_u1.Set(h-i,p-s),r=this.m_u1.Length(),r>e.Settings.linearSlop?(this.m_u1.x*=1/r,this.m_u1.y*=1/r):this.m_u1.SetZero(),r=this.m_maxLength1-r,v=e.Math.Max(v,-r),r=e.Math.Clamp(r+e.Settings.linearSlop,-e.Settings.maxLinearCorrection,0),r=-this.m_limitMass1*r,i=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=e.Math.Max(0,this.m_limitPositionImpulse1+r),r=this.m_limitPositionImpulse1-i,h=-r*this.m_u1.x,p=-r*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(a*p-f*h),t.SynchronizeTransform()),this.m_limitState2==e.Joint.e_atUpperLimit&&(r=n.m_xf.R,l=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,h=r.col1.x*l+r.col2.x*c,c=r.col1.y*l+r.col2.y*c,l=h,d=n.m_sweep.c.x+l,r=n.m_sweep.c.y+c,this.m_u2.Set(d-o,r-u),h=this.m_u2.Length(),h>e.Settings.linearSlop?(this.m_u2.x*=1/h,this.m_u2.y*=1/h):this.m_u2.SetZero(),r=this.m_maxLength2-h,v=e.Math.Max(v,-r),r=e.Math.Clamp(r+e.Settings.linearSlop,-e.Settings.maxLinearCorrection,0),r=-this.m_limitMass2*r,i=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=e.Math.Max(0,this.m_limitPositionImpulse2+r),r=this.m_limitPositionImpulse2-i,d=-r*this.m_u2.x,r=-r*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*d,n.m_sweep.c.y+=n.m_invMass*r,n.m_sweep.a+=n.m_invI*(l*r-c*d),n.SynchronizeTransform()),v<e.Settings.linearSlop},e.RevoluteJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.RevoluteJoint.prototype,e.Joint.prototype),e.RevoluteJoint.prototype._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},e.RevoluteJoint.prototype.__constructor=function(e){this._super(e),this.m_localAnchor1.SetV(e.localAnchor1),this.m_localAnchor2.SetV(e.localAnchor2),this.m_referenceAngle=e.referenceAngle,this.m_pivotForce.Set(0,0),this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor},e.RevoluteJoint.prototype.__varz=function(){this.K=new e.Mat22,this.K1=new e.Mat22,this.K2=new e.Mat22,this.K3=new e.Mat22,this.m_localAnchor1=new e.Vec2,this.m_localAnchor2=new e.Vec2,this.m_pivotForce=new e.Vec2,this.m_pivotMass=new e.Mat22},e.RevoluteJoint.tImpulse=new e.Vec2,t=e.RevoluteJoint.prototype,t.K=new e.Mat22,t.K1=new e.Mat22,t.K2=new e.Mat22,t.K3=new e.Mat22,t.m_localAnchor1=new e.Vec2,t.m_localAnchor2=new e.Vec2,t.m_pivotForce=new e.Vec2,t.m_motorForce=null,t.m_limitForce=null,t.m_limitPositionImpulse=null,t.m_pivotMass=new e.Mat22,t.m_motorMass=null,t.m_enableMotor=null,t.m_maxMotorTorque=null,t.m_motorSpeed=null,t.m_enableLimit=null,t.m_referenceAngle=null,t.m_lowerAngle=null,t.m_upperAngle=null,t.m_limitState=0,t.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)},t.GetReactionForce=function(){return this.m_pivotForce},t.GetReactionTorque=function(){return this.m_limitForce},t.GetJointAngle=function(){return this.m_body2.m_sweep.a-this.m_body1.m_sweep.a-this.m_referenceAngle},t.GetJointSpeed=function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity},t.IsLimitEnabled=function(){return this.m_enableLimit},t.EnableLimit=function(e){this.m_enableLimit=e},t.GetLowerLimit=function(){return this.m_lowerAngle},t.GetUpperLimit=function(){return this.m_upperAngle},t.SetLimits=function(e,t){this.m_lowerAngle=e,this.m_upperAngle=t},t.IsMotorEnabled=function(){return this.m_enableMotor},t.EnableMotor=function(e){this.m_enableMotor=e},t.SetMotorSpeed=function(e){this.m_motorSpeed=e},t.GetMotorSpeed=function(){return this.m_motorSpeed},t.SetMaxMotorTorque=function(e){this.m_maxMotorTorque=e},t.GetMotorTorque=function(){return this.m_motorForce},t.InitVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i,s;i=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y;s=i.col1.x*o+i.col2.x*u,u=i.col1.y*o+i.col2.y*u,o=s,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=s,i=n.m_invMass,s=r.m_invMass;var l=n.m_invI,c=r.m_invI;this.K1.col1.x=i+s,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i+s,this.K2.col1.x=l*u*u,this.K2.col2.x=-l*o*u,this.K2.col1.y=-l*o*u,this.K2.col2.y=l*o*o,this.K3.col1.x=c*f*f,this.K3.col2.x=-c*a*f,this.K3.col1.y=-c*a*f,this.K3.col2.y=c*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Invert(this.m_pivotMass),this.m_motorMass=1/(l+c),this.m_enableMotor==0&&(this.m_motorForce=0);if(this.m_enableLimit){var h=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;e.Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.Settings.angularSlop?this.m_limitState=e.Joint.e_equalLimits:h<=this.m_lowerAngle?(this.m_limitState!=e.Joint.e_atLowerLimit&&(this.m_limitForce=0),this.m_limitState=e.Joint.e_atLowerLimit):h>=this.m_upperAngle?(this.m_limitState!=e.Joint.e_atUpperLimit&&(this.m_limitForce=0),this.m_limitState=e.Joint.e_atUpperLimit):(this.m_limitState=e.Joint.e_inactiveLimit,this.m_limitForce=0)}else this.m_limitForce=0;t.warmStarting?(n.m_linearVelocity.x-=t.dt*i*this.m_pivotForce.x,n.m_linearVelocity.y-=t.dt*i*this.m_pivotForce.y,n.m_angularVelocity-=t.dt*l*(o*this.m_pivotForce.y-u*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce),r.m_linearVelocity.x+=t.dt*s*this.m_pivotForce.x,r.m_linearVelocity.y+=t.dt*s*this.m_pivotForce.y,r.m_angularVelocity+=t.dt*c*(a*this.m_pivotForce.y-f*this.m_pivotForce.x+this.m_motorForce+this.m_limitForce)):(this.m_pivotForce.SetZero(),this.m_limitForce=this.m_motorForce=0),this.m_limitPositionImpulse=0},t.SolveVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i,s;i=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y;s=i.col1.x*o+i.col2.x*u,u=i.col1.y*o+i.col2.y*u,o=s,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=s,s=r.m_linearVelocity.x+ -r.m_angularVelocity*f-n.m_linearVelocity.x- -n.m_angularVelocity*u;var l=r.m_linearVelocity.y+r.m_angularVelocity*a-n.m_linearVelocity.y-n.m_angularVelocity*o;i=-t.inv_dt*(this.m_pivotMass.col1.x*s+this.m_pivotMass.col2.x*l),s=-t.inv_dt*(this.m_pivotMass.col1.y*s+this.m_pivotMass.col2.y*l),this.m_pivotForce.x+=i,this.m_pivotForce.y+=s,i=t.dt*i,s=t.dt*s,n.m_linearVelocity.x-=n.m_invMass*i,n.m_linearVelocity.y-=n.m_invMass*s,n.m_angularVelocity-=n.m_invI*(o*s-u*i),r.m_linearVelocity.x+=r.m_invMass*i,r.m_linearVelocity.y+=r.m_invMass*s,r.m_angularVelocity+=r.m_invI*(a*s-f*i),this.m_enableMotor&&this.m_limitState!=e.Joint.e_equalLimits&&(o=-t.inv_dt*this.m_motorMass*(r.m_angularVelocity-n.m_angularVelocity-this.m_motorSpeed),u=this.m_motorForce,this.m_motorForce=e.Math.Clamp(this.m_motorForce+o,-this.m_maxMotorTorque,this.m_maxMotorTorque),o=this.m_motorForce-u,n.m_angularVelocity-=n.m_invI*t.dt*o,r.m_angularVelocity+=r.m_invI*t.dt*o),this.m_enableLimit&&this.m_limitState!=e.Joint.e_inactiveLimit&&(u=-t.inv_dt*this.m_motorMass*(r.m_angularVelocity-n.m_angularVelocity),this.m_limitState==e.Joint.e_equalLimits?this.m_limitForce+=u:this.m_limitState==e.Joint.e_atLowerLimit?(o=this.m_limitForce,this.m_limitForce=e.Math.Max(this.m_limitForce+u,0),u=this.m_limitForce-o):this.m_limitState==e.Joint.e_atUpperLimit&&(o=this.m_limitForce,this.m_limitForce=e.Math.Min(this.m_limitForce+u,0),u=this.m_limitForce-o),n.m_angularVelocity-=n.m_invI*t.dt*u,r.m_angularVelocity+=r.m_invI*t.dt*u)},t.SolvePositionConstraints=function(){var t,n=this.m_body1,r=this.m_body2,i=0;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R,t=this.m_localAnchor2.x-r.m_sweep.localCenter.x;var a=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*t+i.col2.x*a,a=i.col1.y*t+i.col2.y*a,t=u,u=r.m_sweep.c.x+t-(n.m_sweep.c.x+s);var f=r.m_sweep.c.y+a-(n.m_sweep.c.y+o);i=Math.sqrt(u*u+f*f);var l=n.m_invMass,c=r.m_invMass,h=n.m_invI,p=r.m_invI;return this.K1.col1.x=l+c,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=l+c,this.K2.col1.x=h*o*o,this.K2.col2.x=-h*s*o,this.K2.col1.y=-h*s*o,this.K2.col2.y=h*s*s,this.K3.col1.x=p*a*a,this.K3.col2.x=-p*t*a,this.K3.col1.y=-p*t*a,this.K3.col2.y=p*t*t,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(e.RevoluteJoint.tImpulse,-u,-f),u=e.RevoluteJoint.tImpulse.x,f=e.RevoluteJoint.tImpulse.y,n.m_sweep.c.x-=n.m_invMass*u,n.m_sweep.c.y-=n.m_invMass*f,n.m_sweep.a-=n.m_invI*(s*f-o*u),r.m_sweep.c.x+=r.m_invMass*u,r.m_sweep.c.y+=r.m_invMass*f,r.m_sweep.a+=r.m_invI*(t*f-a*u),n.SynchronizeTransform(),r.SynchronizeTransform(),s=0,this.m_enableLimit&&this.m_limitState!=e.Joint.e_inactiveLimit&&(t=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,o=0,this.m_limitState==e.Joint.e_equalLimits?(t=e.Math.Clamp(t,-e.Settings.maxAngularCorrection,e.Settings.maxAngularCorrection),o=-this.m_motorMass*t,s=e.Math.Abs(t)):this.m_limitState==e.Joint.e_atLowerLimit?(t-=this.m_lowerAngle,s=e.Math.Max(0,-t),t=e.Math.Clamp(t+e.Settings.angularSlop,-e.Settings.maxAngularCorrection,0),o=-this.m_motorMass*t,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=e.Math.Max(this.m_limitPositionImpulse+o,0),o=this.m_limitPositionImpulse-t):this.m_limitState==e.Joint.e_atUpperLimit&&(t-=this.m_upperAngle,s=e.Math.Max(0,t),t=e.Math.Clamp(t-e.Settings.angularSlop,0,e.Settings.maxAngularCorrection),o=-this.m_motorMass*t,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=e.Math.Min(this.m_limitPositionImpulse+o,0),o=this.m_limitPositionImpulse-t),n.m_sweep.a-=n.m_invI*o,r.m_sweep.a+=r.m_invI*o,n.SynchronizeTransform(),r.SynchronizeTransform()),i<=e.Settings.linearSlop&&s<=e.Settings.angularSlop},e.PrismaticJoint=function(){e.Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PrismaticJoint.prototype,e.Joint.prototype),t=e.PrismaticJoint.prototype,t._super=function(){e.Joint.prototype.__constructor.apply(this,arguments)},t.__constructor=function(e){this._super(e),this.m_localAnchor1.SetV(e.localAnchor1),this.m_localAnchor2.SetV(e.localAnchor2),this.m_localXAxis1.SetV(e.localAxis1),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_linearJacobian.SetZero(),this.m_torque=this.m_angularMass=this.m_force=this.m_linearMass=0,this.m_motorJacobian.SetZero(),this.m_limitPositionImpulse=this.m_limitForce=this.m_motorForce=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor},t.__varz=function(){this.m_localAnchor1=new e.Vec2,this.m_localAnchor2=new e.Vec2,this.m_localXAxis1=new e.Vec2,this.m_localYAxis1=new e.Vec2,this.m_linearJacobian=new e.Jacobian,this.m_motorJacobian=new e.Jacobian},t.m_localAnchor1=new e.Vec2,t.m_localAnchor2=new e.Vec2,t.m_localXAxis1=new e.Vec2,t.m_localYAxis1=new e.Vec2,t.m_refAngle=null,t.m_linearJacobian=new e.Jacobian,t.m_linearMass=null,t.m_force=null,t.m_angularMass=null,t.m_torque=null,t.m_motorJacobian=new e.Jacobian,t.m_motorMass=null,t.m_motorForce=null,t.m_limitForce=null,t.m_limitPositionImpulse=null,t.m_lowerTranslation=null,t.m_upperTranslation=null,t.m_maxMotorForce=null,t.m_motorSpeed=null,t.m_enableLimit=null,t.m_enableMotor=null,t.m_limitState=0,t.GetAnchor1=function(){return this.m_body1.GetWorldPoint(this.m_localAnchor1)},t.GetAnchor2=function(){return this.m_body2.GetWorldPoint(this.m_localAnchor2)},t.GetReactionForce=function(){var t=this.m_body1.m_xf.R;return new e.Vec2(this.m_limitForce*this.m_limitForce*(t.col1.x*this.m_localXAxis1.x+t.col2.x*this.m_localXAxis1.y)+this.m_force*this.m_force*(t.col1.x*this.m_localYAxis1.x+t.col2.x*this.m_localYAxis1.y),this.m_limitForce*this.m_limitForce*(t.col1.y*this.m_localXAxis1.x+t.col2.y*this.m_localXAxis1.y)+this.m_force*this.m_force*(t.col1.y*this.m_localYAxis1.x+t.col2.y*this.m_localYAxis1.y))},t.GetReactionTorque=function(){return this.m_torque},t.GetJointTranslation=function(){var e=this.m_body1,t=this.m_body2,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},t.GetJointSpeed=function(){var e=this.m_body1,t=this.m_body2,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},t.IsLimitEnabled=function(){return this.m_enableLimit},t.EnableLimit=function(e){this.m_enableLimit=e},t.GetLowerLimit=function(){return this.m_lowerTranslation},t.GetUpperLimit=function(){return this.m_upperTranslation},t.SetLimits=function(e,t){this.m_lowerTranslation=e,this.m_upperTranslation=t},t.IsMotorEnabled=function(){return this.m_enableMotor},t.EnableMotor=function(e){this.m_enableMotor=e},t.SetMotorSpeed=function(e){this.m_motorSpeed=e},t.GetMotorSpeed=function(){return this.m_motorSpeed},t.SetMaxMotorForce=function(e){this.m_maxMotorForce=e},t.GetMotorForce=function(){return this.m_motorForce},t.InitVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i,s;i=n.m_xf.R;var o=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y;s=i.col1.x*o+i.col2.x*u,u=i.col1.y*o+i.col2.y*u,o=s,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=s,s=n.m_invMass;var l=r.m_invMass,c=n.m_invI,h=r.m_invI;i=n.m_xf.R;var p=i.col1.x*this.m_localYAxis1.x+i.col2.x*this.m_localYAxis1.y;i=i.col1.y*this.m_localYAxis1.x+i.col2.y*this.m_localYAxis1.y;var d=r.m_sweep.c.x+a-n.m_sweep.c.x,v=r.m_sweep.c.y+f-n.m_sweep.c.y;this.m_linearJacobian.linear1.x=-p,this.m_linearJacobian.linear1.y=-i,this.m_linearJacobian.linear2.x=p,this.m_linearJacobian.linear2.y=i,this.m_linearJacobian.angular1=-(d*i-v*p),this.m_linearJacobian.angular2=a*i-f*p,this.m_linearMass=s+c*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+l+h*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2,this.m_linearMass=1/this.m_linearMass,this.m_angularMass=c+h,this.m_angularMass>Number.MIN_VALUE&&(this.m_angularMass=1/this.m_angularMass);if(this.m_enableLimit||this.m_enableMotor)i=n.m_xf.R,p=i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y,i=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y,this.m_motorJacobian.linear1.x=-p,this.m_motorJacobian.linear1.y=-i,this.m_motorJacobian.linear2.x=p,this.m_motorJacobian.linear2.y=i,this.m_motorJacobian.angular1=-(d*i-v*p),this.m_motorJacobian.angular2=a*i-f*p,this.m_motorMass=s+c*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+l+h*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit&&(o=p*(d-o)+i*(v-u),e.Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.Settings.linearSlop?this.m_limitState=e.Joint.e_equalLimits:o<=this.m_lowerTranslation?(this.m_limitState!=e.Joint.e_atLowerLimit&&(this.m_limitForce=0),this.m_limitState=e.Joint.e_atLowerLimit):o>=this.m_upperTranslation?(this.m_limitState!=e.Joint.e_atUpperLimit&&(this.m_limitForce=0),this.m_limitState=e.Joint.e_atUpperLimit):(this.m_limitState=e.Joint.e_inactiveLimit,this.m_limitForce=0));this.m_enableMotor==0&&(this.m_motorForce=0),this.m_enableLimit==0&&(this.m_limitForce=0),t.warmStarting?(o=t.dt*(this.m_force*this.m_linearJacobian.linear1.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.y),u=t.dt*(this.m_force*this.m_linearJacobian.linear2.x+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.x),a=t.dt*(this.m_force*this.m_linearJacobian.linear2.y+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear2.y),f=t.dt*(this.m_force*this.m_linearJacobian.angular1-this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular1),d=t.dt*(this.m_force*this.m_linearJacobian.angular2+this.m_torque+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.angular2),n.m_linearVelocity.x+=s*t.dt*(this.m_force*this.m_linearJacobian.linear1.x+(this.m_motorForce+this.m_limitForce)*this.m_motorJacobian.linear1.x),n.m_linearVelocity.y+=s*o,n.m_angularVelocity+=c*f,r.m_linearVelocity.x+=l*u,r.m_linearVelocity.y+=l*a,r.m_angularVelocity+=h*d):this.m_motorForce=this.m_limitForce=this.m_torque=this.m_force=0,this.m_limitPositionImpulse=0},t.SolveVelocityConstraints=function(t){var n=this.m_body1,r=this.m_body2,i=n.m_invMass,s=r.m_invMass,o=n.m_invI,u=r.m_invI,a;a=this.m_linearJacobian.Compute(n.m_linearVelocity,n.m_angularVelocity,r.m_linearVelocity,r.m_angularVelocity),a=-t.inv_dt*this.m_linearMass*a,this.m_force+=a,a=t.dt*a,n.m_linearVelocity.x+=i*a*this.m_linearJacobian.linear1.x,n.m_linearVelocity.y+=i*a*this.m_linearJacobian.linear1.y,n.m_angularVelocity+=o*a*this.m_linearJacobian.angular1,r.m_linearVelocity.x+=s*a*this.m_linearJacobian.linear2.x,r.m_linearVelocity.y+=s*a*this.m_linearJacobian.linear2.y,r.m_angularVelocity+=u*a*this.m_linearJacobian.angular2,a=-t.inv_dt*this.m_angularMass*(r.m_angularVelocity-n.m_angularVelocity),this.m_torque+=a,a=t.dt*a,n.m_angularVelocity-=o*a,r.m_angularVelocity+=u*a;if(this.m_enableMotor&&this.m_limitState!=e.Joint.e_equalLimits){a=this.m_motorJacobian.Compute(n.m_linearVelocity,n.m_angularVelocity,r.m_linearVelocity,r.m_angularVelocity)-this.m_motorSpeed,a=-t.inv_dt*this.m_motorMass*a;var f=this.m_motorForce;this.m_motorForce=e.Math.Clamp(this.m_motorForce+a,-this.m_maxMotorForce,this.m_maxMotorForce),a=this.m_motorForce-f,a=t.dt*a,n.m_linearVelocity.x+=i*a*this.m_motorJacobian.linear1.x,n.m_linearVelocity.y+=i*a*this.m_motorJacobian.linear1.y,n.m_angularVelocity+=o*a*this.m_motorJacobian.angular1,r.m_linearVelocity.x+=s*a*this.m_motorJacobian.linear2.x,r.m_linearVelocity.y+=s*a*this.m_motorJacobian.linear2.y,r.m_angularVelocity+=u*a*this.m_motorJacobian.angular2}this.m_enableLimit&&this.m_limitState!=e.Joint.e_inactiveLimit&&(a=this.m_motorJacobian.Compute(n.m_linearVelocity,n.m_angularVelocity,r.m_linearVelocity,r.m_angularVelocity),f=-t.inv_dt*this.m_motorMass*a,this.m_limitState==e.Joint.e_equalLimits?this.m_limitForce+=f:this.m_limitState==e.Joint.e_atLowerLimit?(a=this.m_limitForce,this.m_limitForce=e.Math.Max(this.m_limitForce+f,0),f=this.m_limitForce-a):this.m_limitState==e.Joint.e_atUpperLimit&&(a=this.m_limitForce,this.m_limitForce=e.Math.Min(this.m_limitForce+f,0),f=this.m_limitForce-a),a=t.dt*f,n.m_linearVelocity.x+=i*a*this.m_motorJacobian.linear1.x,n.m_linearVelocity.y+=i*a*this.m_motorJacobian.linear1.y,n.m_angularVelocity+=o*a*this.m_motorJacobian.angular1,r.m_linearVelocity.x+=s*a*this.m_motorJacobian.linear2.x,r.m_linearVelocity.y+=s*a*this.m_motorJacobian.linear2.y,r.m_angularVelocity+=u*a*this.m_motorJacobian.angular2)},t.SolvePositionConstraints=function(){var t,n,r=this.m_body1,i=this.m_body2,s=r.m_invMass,o=i.m_invMass,u=r.m_invI,a=i.m_invI,f,l;f=r.m_xf.R;var c=this.m_localAnchor1.x-r.m_sweep.localCenter.x,h=this.m_localAnchor1.y-r.m_sweep.localCenter.y;l=f.col1.x*c+f.col2.x*h,h=f.col1.y*c+f.col2.y*h,c=l,f=i.m_xf.R;var p=this.m_localAnchor2.x-i.m_sweep.localCenter.x;t=this.m_localAnchor2.y-i.m_sweep.localCenter.y,l=f.col1.x*p+f.col2.x*t,t=f.col1.y*p+f.col2.y*t,p=l,f=r.m_sweep.c.x+c,h=r.m_sweep.c.y+h,p=i.m_sweep.c.x+p,t=i.m_sweep.c.y+t,p-=f,t-=h,f=r.m_xf.R;var d=(f.col1.x*this.m_localYAxis1.x+f.col2.x*this.m_localYAxis1.y)*p+(f.col1.y*this.m_localYAxis1.x+f.col2.y*this.m_localYAxis1.y)*t;d=e.Math.Clamp(d,-e.Settings.maxLinearCorrection,e.Settings.maxLinearCorrection),n=-this.m_linearMass*d,r.m_sweep.c.x+=s*n*this.m_linearJacobian.linear1.x,r.m_sweep.c.y+=s*n*this.m_linearJacobian.linear1.y,r.m_sweep.a+=u*n*this.m_linearJacobian.angular1,i.m_sweep.c.x+=o*n*this.m_linearJacobian.linear2.x,i.m_sweep.c.y+=o*n*this.m_linearJacobian.linear2.y,i.m_sweep.a+=a*n*this.m_linearJacobian.angular2,d=e.Math.Abs(d),n=i.m_sweep.a-r.m_sweep.a-this.m_refAngle,n=e.Math.Clamp(n,-e.Settings.maxAngularCorrection,e.Settings.maxAngularCorrection);var v=-this.m_angularMass*n;return r.m_sweep.a-=r.m_invI*v,i.m_sweep.a+=i.m_invI*v,r.SynchronizeTransform(),i.SynchronizeTransform(),v=e.Math.Abs(n),this.m_enableLimit&&this.m_limitState!=e.Joint.e_inactiveLimit&&(f=r.m_xf.R,c=this.m_localAnchor1.x-r.m_sweep.localCenter.x,h=this.m_localAnchor1.y-r.m_sweep.localCenter.y,l=f.col1.x*c+f.col2.x*h,h=f.col1.y*c+f.col2.y*h,c=l,f=i.m_xf.R,p=this.m_localAnchor2.x-i.m_sweep.localCenter.x,t=this.m_localAnchor2.y-i.m_sweep.localCenter.y,l=f.col1.x*p+f.col2.x*t,t=f.col1.y*p+f.col2.y*t,p=l,f=r.m_sweep.c.x+c,h=r.m_sweep.c.y+h,p=i.m_sweep.c.x+p,t=i.m_sweep.c.y+t,p-=f,t-=h,f=r.m_xf.R,f=(f.col1.x*this.m_localXAxis1.x+f.col2.x*this.m_localXAxis1.y)*p+(f.col1.y*this.m_localXAxis1.x+f.col2.y*this.m_localXAxis1.y)*t,t=0,this.m_limitState==e.Joint.e_equalLimits?(t=e.Math.Clamp(f,-e.Settings.maxLinearCorrection,e.Settings.maxLinearCorrection),t=-this.m_motorMass*t,d=e.Math.Max(d,e.Math.Abs(n))):this.m_limitState==e.Joint.e_atLowerLimit?(t=f-this.m_lowerTranslation,d=e.Math.Max(d,-t),t=e.Math.Clamp(t+e.Settings.linearSlop,-e.Settings.maxLinearCorrection,0),t=-this.m_motorMass*t,n=this.m_limitPositionImpulse,this.m_limitPositionImpulse=e.Math.Max(this.m_limitPositionImpulse+t,0),t=this.m_limitPositionImpulse-n):this.m_limitState==e.Joint.e_atUpperLimit&&(t=f-this.m_upperTranslation,d=e.Math.Max(d,t),t=e.Math.Clamp(t-e.Settings.linearSlop,0,e.Settings.maxLinearCorrection),t=-this.m_motorMass*t,n=this.m_limitPositionImpulse,this.m_limitPositionImpulse=e.Math.Min(this.m_limitPositionImpulse+t,0),t=this.m_limitPositionImpulse-n),r.m_sweep.c.x+=s*t*this.m_motorJacobian.linear1.x,r.m_sweep.c.y+=s*t*this.m_motorJacobian.linear1.y,r.m_sweep.a+=u*t*this.m_motorJacobian.angular1,i.m_sweep.c.x+=o*t*this.m_motorJacobian.linear2.x,i.m_sweep.c.y+=o*t*this.m_motorJacobian.linear2.y,i.m_sweep.a+=a*t*this.m_motorJacobian.angular2,r.SynchronizeTransform(),i.SynchronizeTransform()),d<=e.Settings.linearSlop&&v<=e.Settings.angularSlop};var i=function(){this.__varz(),this.__constructor.apply(this,arguments)};i.prototype.__constructor=function(){},i.prototype.__varz=function(){this.v=new e.Vec2,this.id=new e.ContactID},i.prototype.v=new e.Vec2,i.prototype.id=new e.ContactID,e.NullContact=function(){e.Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.NullContact.prototype,e.Contact.prototype),t=e.NullContact.prototype,t._super=function(){e.Contact.prototype.__constructor.apply(this,arguments)},t.__constructor=function(){},t.__varz=function(){},t.Evaluate=function(){},t.GetManifolds=function(){return null},e.PolyAndCircleContact=function(){e.Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.PolyAndCircleContact.prototype,e.Contact.prototype),e.PolyAndCircleContact.prototype._super=function(){e.Contact.prototype.__constructor.apply(this,arguments)},e.PolyAndCircleContact.prototype.__constructor=function(t,n){this._super(t,n),this.m_manifold=this.m_manifolds[0],e.Settings.Assert(this.m_shape1.m_type==e.Shape.e_polygonShape),e.Settings.Assert(this.m_shape2.m_type==e.Shape.e_circleShape),this.m_manifold.pointCount=0,t=this.m_manifold.points[0],t.normalImpulse=0,t.tangentImpulse=0},e.PolyAndCircleContact.prototype.__varz=function(){this.m_manifolds=[new e.Manifold],this.m0=new e.Manifold},e.PolyAndCircleContact.s_evalCP=new e.ContactPoint,e.PolyAndCircleContact.Create=function(t,n){return new e.PolyAndCircleContact(t,n)},e.PolyAndCircleContact.Destroy=function(){},t=e.PolyAndCircleContact.prototype,t.m_manifolds=[new e.Manifold],t.m0=new e.Manifold,t.m_manifold=null,t.Evaluate=function(t){var n=0,r,i,s,o=this.m_shape1.m_body,u=this.m_shape2.m_body;this.m0.Set(this.m_manifold),e.Collision.CollidePolygonAndCircle(this.m_manifold,this.m_shape1,o.m_xf,this.m_shape2,u.m_xf);var a=[!1,!1],f=e.PolyAndCircleContact.s_evalCP;f.shape1=this.m_shape1,f.shape2=this.m_shape2,f.friction=this.m_friction,f.restitution=this.m_restitution;if(this.m_manifold.pointCount>0){for(n=0;n<this.m_manifold.pointCount;++n){var l=this.m_manifold.points[n];l.normalImpulse=0,l.tangentImpulse=0;var c=!1,h=l.id._key;for(r=0;r<this.m0.pointCount;++r)if(a[r]!=1){s=this.m0.points[r];if(s.id._key==h){a[r]=!0,l.normalImpulse=s.normalImpulse,l.tangentImpulse=s.tangentImpulse,c=!0,t!=null&&(f.position=o.GetWorldPoint(l.localPoint1),r=o.GetLinearVelocityFromLocalPoint(l.localPoint1),i=u.GetLinearVelocityFromLocalPoint(l.localPoint2),f.velocity.Set(i.x-r.x,i.y-r.y),f.normal.SetV(this.m_manifold.normal),f.separation=l.separation,f.id.key=h,t.Persist(f));break}}c==0&&t!=null&&(f.position=o.GetWorldPoint(l.localPoint1),r=o.GetLinearVelocityFromLocalPoint(l.localPoint1),i=u.GetLinearVelocityFromLocalPoint(l.localPoint2),f.velocity.Set(i.x-r.x,i.y-r.y),f.normal.SetV(this.m_manifold.normal),f.separation=l.separation,f.id.key=h,t.Add(f))}this.m_manifoldCount=1}else this.m_manifoldCount=0;if(t!=null)for(n=0;n<this.m0.pointCount;++n)a[n]||(s=this.m0.points[n],f.position=o.GetWorldPoint(s.localPoint1),r=o.GetLinearVelocityFromLocalPoint(s.localPoint1),i=u.GetLinearVelocityFromLocalPoint(s.localPoint2),f.velocity.Set(i.x-r.x,i.y-r.y),f.normal.SetV(this.m0.normal),f.separation=s.separation,f.id.key=s.id._key,t.Remove(f))},t.GetManifolds=function(){return this.m_manifolds},e.ContactManager=function(){e.PairCallback.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)},n(e.ContactManager.prototype,e.PairCallback.prototype),e.ContactManager.prototype._super=function(){e.PairCallback.prototype.__constructor.apply(this,arguments)},e.ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_destroyImmediate=!1},e.ContactManager.prototype.__varz=function(){this.m_nullContact=new e.NullContact},e.ContactManager.s_evalCP=new e.ContactPoint,t=e.ContactManager.prototype,t.m_world=null,t.m_nullContact=new e.NullContact,t.m_destroyImmediate=null,t.PairAdded=function(t,n){t=t,n=n;var r=t.m_body,i=n.m_body;if(r.IsStatic()&&i.IsStatic())return this.m_nullContact;if(t.m_body==n.m_body)return this.m_nullContact;if(i.IsConnected(r))return this.m_nullContact;if(this.m_world.m_contactFilter!=null&&this.m_world.m_contactFilter.ShouldCollide(t,n)==0)return this.m_nullContact;var s=e.Contact.Create(t,n,this.m_world.m_blockAllocator);return s==null?this.m_nullContact:(t=s.m_shape1,n=s.m_shape2,r=t.m_body,i=n.m_body,s.m_prev=null,s.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=s),this.m_world.m_contactList=s,s.m_node1.contact=s,s.m_node1.other=i,s.m_node1.prev=null,s.m_node1.next=r.m_contactList,r.m_contactList!=null&&(r.m_contactList.prev=s.m_node1),r.m_contactList=s.m_node1,s.m_node2.contact=s,s.m_node2.other=r,s.m_node2.prev=null,s.m_node2.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=s.m_node2),i.m_contactList=s.m_node2,++this.m_world.m_contactCount,s)},t.PairRemoved=function(e,t,n){n!=null&&n!=this.m_nullContact&&this.Destroy(n)},t.Destroy=function(t){var n=t.m_shape1,r=t.m_shape2,i=t.m_manifoldCount;if(i>0&&this.m_world.m_contactListener){var s=n.m_body,o=r.m_body,u=t.GetManifolds(),a=e.ContactManager.s_evalCP;a.shape1=t.m_shape1,a.shape2=t.m_shape1,a.friction=t.m_friction,a.restitution=t.m_restitution;for(var f=0;f<i;++f){var l=u[f];a.normal.SetV(l.normal);for(var c=0;c<l.pointCount;++c){var h=l.points[c];a.position=s.GetWorldPoint(h.localPoint1);var p=s.GetLinearVelocityFromLocalPoint(h.localPoint1),d=o.GetLinearVelocityFromLocalPoint(h.localPoint2);a.velocity.Set(d.x-p.x,d.y-p.y),a.separation=h.separation,a.id.key=h.id._key,this.m_world.m_contactListener.Remove(a)}}}t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),n=n.m_body,r=r.m_body,t.m_node1.prev&&(t.m_node1.prev.next=t.m_node1.next),t.m_node1.next&&(t.m_node1.next.prev=t.m_node1.prev),t.m_node1==n.m_contactList&&(n.m_contactList=t.m_node1.next),t.m_node2.prev&&(t.m_node2.prev.next=t.m_node2.next),t.m_node2.next&&(t.m_node2.next.prev=t.m_node2.prev),t.m_node2==r.m_contactList&&(r.m_contactList=t.m_node2.next),e.Contact.Destroy(t,this.m_world.m_blockAllocator),--this.m_world.m_contactCount},t.Collide=function(){for(var e=this.m_world.m_contactList;e;e=e.m_next){var t=e.m_shape2.m_body;e.m_shape1.m_body.IsSleeping()&&t.IsSleeping()||e.Update(this.m_world.m_contactListener)}},e.World=function(){this.__varz(),this.__constructor.apply(this,arguments)},e.World.prototype.__constructor=function(t,n,r){this.m_boundaryListener=this.m_destructionListener=null,this.m_contactFilter=e.ContactFilter.defaultFilter,this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_contactListener=null,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,e.World.m_positionCorrection=!0,e.World.m_warmStarting=!0,e.World.m_continuousPhysics=!0,this.m_allowSleep=r,this.m_gravity=n,this.m_lock=!1,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_broadPhase=new e.BroadPhase(t,this.m_contactManager),this.m_groundBody=this.CreateBody(new e.BodyDef)},e.World.prototype.__varz=function(){this.m_raycastNormal=new e.Vec2,this.m_contactManager=new e.ContactManager},e.World.m_positionCorrection=null,e.World.m_warmStarting=null,e.World.m_continuousPhysics=null,e.World.s_jointColor=new e.Color(.5,.8,.8),e.World.s_coreColor=new e.Color(.9,.6,.6),e.World.s_xf=new e.XForm,t=e.World.prototype,t.m_raycastUserData=null,t.m_raycastSegment=null,t.m_raycastNormal=new e.Vec2,t.m_blockAllocator=null,t.m_stackAllocator=null,t.m_lock=null,t.m_broadPhase=null,t.m_contactManager=new e.ContactManager,t.m_bodyList=null,t.m_jointList=null,t.m_contactList=null,t.m_bodyCount=0,t.m_contactCount=0,t.m_jointCount=0,t.m_gravity=null,t.m_allowSleep=null,t.m_groundBody=null,t.m_destructionListener=null,t.m_boundaryListener=null,t.m_contactFilter=null,t.m_contactListener=null,t.m_debugDraw=null,t.m_inv_dt0=null,t.m_positionIterationCount=0,t.SetDestructionListener=function(e){this.m_destructionListener=e},t.SetBoundaryListener=function(e){this.m_boundaryListener=e},t.SetContactFilter=function(e){this.m_contactFilter=e},t.SetContactListener=function(e){this.m_contactListener=e},t.SetDebugDraw=function(e){this.m_debugDraw=e},t.Validate=function(){this.m_broadPhase.Validate()},t.GetProxyCount=function(){return this.m_broadPhase.m_proxyCount},t.GetPairCount=function(){return this.m_broadPhase.m_pairManager.m_pairCount},t.CreateBody=function(t){if(this.m_lock==1)return null;t=new e.Body(t,this),t.m_prev=null;if(t.m_next=this.m_bodyList)this.m_bodyList.m_prev=t;return this.m_bodyList=t,++this.m_bodyCount,t},t.DestroyBody=function(t){if(this.m_lock!=1){for(var n=t.m_jointList;n;){var r=n;n=n.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(r.joint),this.DestroyJoint(r.joint)}for(n=t.m_shapeList;n;)r=n,n=n.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeShape(r),r.DestroyProxy(this.m_broadPhase),e.Shape.Destroy(r,this.m_blockAllocator);t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},t.CreateJoint=function(t){var n=e.Joint.Create(t,this.m_blockAllocator);n.m_prev=null;if(n.m_next=this.m_jointList)this.m_jointList.m_prev=n;this.m_jointList=n,++this.m_jointCount,n.m_node1.joint=n,n.m_node1.other=n.m_body2,n.m_node1.prev=null;if(n.m_node1.next=n.m_body1.m_jointList)n.m_body1.m_jointList.prev=n.m_node1;n.m_body1.m_jointList=n.m_node1,n.m_node2.joint=n,n.m_node2.other=n.m_body1,n.m_node2.prev=null;if(n.m_node2.next=n.m_body2.m_jointList)n.m_body2.m_jointList.prev=n.m_node2;n.m_body2.m_jointList=n.m_node2;if(t.collideConnected==0){t=t.body1.m_shapeCount<t.body2.m_shapeCount?t.body1:t.body2;for(var r=t.m_shapeList;r;r=r.m_next)r.RefilterProxy(this.m_broadPhase,t.m_xf)}return n},t.DestroyJoint=function(t){var n=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var r=t.m_body1,i=t.m_body2;r.WakeUp(),i.WakeUp(),t.m_node1.prev&&(t.m_node1.prev.next=t.m_node1.next),t.m_node1.next&&(t.m_node1.next.prev=t.m_node1.prev),t.m_node1==r.m_jointList&&(r.m_jointList=t.m_node1.next),t.m_node1.prev=null,t.m_node1.next=null,t.m_node2.prev&&(t.m_node2.prev.next=t.m_node2.next),t.m_node2.next&&(t.m_node2.next.prev=t.m_node2.prev),t.m_node2==i.m_jointList&&(i.m_jointList=t.m_node2.next),t.m_node2.prev=null,t.m_node2.next=null,e.Joint.Destroy(t,this.m_blockAllocator),--this.m_jointCount;if(n==0){t=r.m_shapeCount<i.m_shapeCount?r:i;for(n=t.m_shapeList;n;n=n.m_next)n.RefilterProxy(this.m_broadPhase,t.m_xf)}},t.Refilter=function(e){e.RefilterProxy(this.m_broadPhase,e.m_body.m_xf)},t.SetWarmStarting=function(t){e.World.m_warmStarting=t},t.SetPositionCorrection=function(t){e.World.m_positionCorrection=t},t.SetContinuousPhysics=function(t){e.World.m_continuousPhysics=t},t.GetBodyCount=function(){return this.m_bodyCount},t.GetJointCount=function(){return this.m_jointCount},t.GetContactCount=function(){return this.m_contactCount},t.SetGravity=function(e){this.m_gravity=e},t.GetGroundBody=function(){return this.m_groundBody},t.Step=function(t,n){this.m_lock=!0;var r=new e.TimeStep;r.dt=t,r.maxIterations=n,r.inv_dt=t>0?1/t:0,r.dtRatio=this.m_inv_dt0*t,r.positionCorrection=e.World.m_positionCorrection,r.warmStarting=e.World.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),e.World.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),this.DrawDebugData(),this.m_inv_dt0=r.inv_dt,this.m_lock=!1},t.Query=function(e,t,n){var r=new Array(n);e=this.m_broadPhase.QueryAABB(e,r,n);for(n=0;n<e;++n)t[n]=r[n];return e},t.Raycast=function(e,t,n,r,i){var s=new Array(n);this.m_raycastSegment=e,this.m_raycastUserData=i,i=0,i=r?this.m_broadPhase.QuerySegment(e,s,n,this.RaycastSortKey):this.m_broadPhase.QuerySegment(e,s,n,this.RaycastSortKey2);for(e=0;e<i;++e)t[e]=s[e];return i},t.RaycastOne=function(e,t,n,r,i){var s=new Array(1);return r=this.Raycast(e,s,1,r,i),r==0?null:(r>1&&trace(r),s=s[0],r=s.GetBody().GetXForm(),s.TestSegment(r,t,n,e,1),s)},t.GetBodyList=function(){return this.m_bodyList},t.GetJointList=function(){return this.m_jointList},t.Solve=function(t){var n;this.m_positionIterationCount=0;var r=new e.Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator,this.m_contactListener);for(n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~e.Body.e_islandFlag;for(var i=this.m_contactList;i;i=i.m_next)i.m_flags&=~e.Contact.e_islandFlag;for(i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;i=new Array(this.m_bodyCount);for(var s=this.m_bodyList;s;s=s.m_next)if(!(s.m_flags&(e.Body.e_islandFlag|e.Body.e_sleepFlag|e.Body.e_frozenFlag))&&!s.IsStatic()){r.Clear();var o=0;i[o++]=s;for(s.m_flags|=e.Body.e_islandFlag;o>0;){n=i[--o],r.AddBody(n),n.m_flags&=~e.Body.e_sleepFlag;if(!n.IsStatic()){for(var u,a=n.m_contactList;a;a=a.next)a.contact.m_flags&(e.Contact.e_islandFlag|e.Contact.e_nonSolidFlag)||a.contact.m_manifoldCount!=0&&(r.AddContact(a.contact),a.contact.m_flags|=e.Contact.e_islandFlag,u=a.other,u.m_flags&e.Body.e_islandFlag||(i[o++]=u,u.m_flags|=e.Body.e_islandFlag));for(n=n.m_jointList;n;n=n.next)n.joint.m_islandFlag!=1&&(r.AddJoint(n.joint),n.joint.m_islandFlag=!0,u=n.other,u.m_flags&e.Body.e_islandFlag||(i[o++]=u,u.m_flags|=e.Body.e_islandFlag))}}r.Solve(t,this.m_gravity,e.World.m_positionCorrection,this.m_allowSleep),r.m_positionIterationCount>this.m_positionIterationCount&&(this.m_positionIterationCount=r.m_positionIterationCount);for(o=0;o<r.m_bodyCount;++o)n=r.m_bodies[o],n.IsStatic()&&(n.m_flags&=~e.Body.e_islandFlag)}for(n=this.m_bodyList;n;n=n.m_next)n.m_flags&(e.Body.e_sleepFlag|e.Body.e_frozenFlag)||n.IsStatic()||n.SynchronizeShapes()==0&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(n);this.m_broadPhase.Commit()},t.SolveTOI=function(t){var n,r,i,s=new e.Island(this.m_bodyCount,e.Settings.maxTOIContactsPerIsland,0,this.m_stackAllocator,this.m_contactListener),o=new Array(this.m_bodyCount);for(n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~e.Body.e_islandFlag,n.m_sweep.t0=0;var u;for(u=this.m_contactList;u;u=u.m_next)u.m_flags&=~(e.Contact.e_toiFlag|e.Contact.e_islandFlag);for(;;){n=null;var a=1;for(u=this.m_contactList;u;u=u.m_next)if(!(u.m_flags&(e.Contact.e_slowFlag|e.Contact.e_nonSolidFlag))){r=1;if(u.m_flags&e.Contact.e_toiFlag)r=u.m_toi;else{r=u.m_shape1,i=u.m_shape2,r=r.m_body,i=i.m_body;if((r.IsStatic()||r.IsSleeping())&&(i.IsStatic()||i.IsSleeping()))continue;var f=r.m_sweep.t0;r.m_sweep.t0<i.m_sweep.t0?(f=i.m_sweep.t0,r.m_sweep.Advance(f)):i.m_sweep.t0<r.m_sweep.t0&&(f=r.m_sweep.t0,i.m_sweep.Advance(f)),r=e.TimeOfImpact.TimeOfImpact(u.m_shape1,r.m_sweep,u.m_shape2,i.m_sweep),r>0&&r<1&&(r=(1-r)*f+r,r>1&&(r=1)),u.m_toi=r,u.m_flags|=e.Contact.e_toiFlag}Number.MIN_VALUE<r&&r<a&&(n=u,a=r)}if(n==null||1-100*Number.MIN_VALUE<a)break;r=n.m_shape1,i=n.m_shape2,r=r.m_body,i=i.m_body,r.Advance(a),i.Advance(a),n.Update(this.m_contactListener),n.m_flags&=~e.Contact.e_toiFlag;if(n.m_manifoldCount!=0){n=r,n.IsStatic()&&(n=i),s.Clear(),u=0,o[u++]=n;for(n.m_flags|=e.Body.e_islandFlag;u>0;){n=o[--u],s.AddBody(n),n.m_flags&=~e.Body.e_sleepFlag;if(!n.IsStatic())for(n=n.m_contactList;n;n=n.next)s.m_contactCount!=s.m_contactCapacity&&(n.contact.m_flags&(e.Contact.e_islandFlag|e.Contact.e_slowFlag|e.Contact.e_nonSolidFlag)||n.contact.m_manifoldCount!=0&&(s.AddContact(n.contact),n.contact.m_flags|=e.Contact.e_islandFlag,r=n.other,r.m_flags&e.Body.e_islandFlag||(r.IsStatic()==0&&(r.Advance(a),r.WakeUp()),o[u++]=r,r.m_flags|=e.Body.e_islandFlag)))}u=new e.TimeStep,u.dt=(1-a)*t.dt,u.inv_dt=1/u.dt,u.maxIterations=t.maxIterations,s.SolveTOI(u);for(a=a=0;a<s.m_bodyCount;++a){n=s.m_bodies[a],n.m_flags&=~e.Body.e_islandFlag;if(!(n.m_flags&(e.Body.e_sleepFlag|e.Body.e_frozenFlag))&&!n.IsStatic()){n.SynchronizeShapes()==0&&this.m_boundaryListener!=null&&this.m_boundaryListener.Violation(n);for(n=n.m_contactList;n;n=n.next)n.contact.m_flags&=~e.Contact.e_toiFlag}}for(a=0;a<s.m_contactCount;++a)u=s.m_contacts[a],u.m_flags&=~(e.Contact.e_toiFlag|e.Contact.e_islandFlag);this.m_broadPhase.Commit()}}},t.DrawJoint=function(t){var n=t.m_body1,r=t.m_body2,i=n.m_xf.position,s=r.m_xf.position,o=t.GetAnchor1(),u=t.GetAnchor2(),a=e.World.s_jointColor;switch(t.m_type){case e.Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(o,u,a);break;case e.Joint.e_pulleyJoint:n=t.GetGroundAnchor1(),t=t.GetGroundAnchor2(),this.m_debugDraw.DrawSegment(n,o,a),this.m_debugDraw.DrawSegment(t,u,a),this.m_debugDraw.DrawSegment(n,t,a);break;case e.Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(o,u,a);break;default:n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,a),this.m_debugDraw.DrawSegment(o,u,a),r!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,u,a)}},t.DrawShape=function(t,n,r,i){var s=e.World.s_coreColor;switch(t.m_type){case e.Shape.e_circleShape:var o=e.Math.MulX(n,t.m_localPosition);t=t.m_radius,this.m_debugDraw.DrawSolidCircle(o,t,n.R.col1,r),i&&this.m_debugDraw.DrawCircle(o,t-e.Settings.toiSlop,s);break;case e.Shape.e_polygonShape:o=0;var u=t.GetVertexCount(),a=t.GetVertices(),f=new Array(e.Settings.maxPolygonVertices);for(o=0;o<u;++o)f[o]=e.Math.MulX(n,a[o]);this.m_debugDraw.DrawSolidPolygon(f,u,r);if(i){r=t.GetCoreVertices();for(o=0;o<u;++o)f[o]=e.Math.MulX(n,r[o]);this.m_debugDraw.DrawPolygon(f,u,s)}}},t.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var t=this.m_debugDraw.GetFlags(),n=0,r,i,s=new e.Vec2,o=new e.Vec2,u=new e.Vec2,a=new e.Color(0,0,0),f,l=new e.AABB,c=new e.AABB,h=[new e.Vec2,new e.Vec2,new e.Vec2,new e.Vec2];if(t&e.DebugDraw.e_shapeBit){n=(t&e.DebugDraw.e_coreShapeBit)==e.DebugDraw.e_coreShapeBit;for(r=this.m_bodyList;r;r=r.m_next){f=r.m_xf;for(i=r.GetShapeList();i;i=i.m_next)r.IsStatic()?this.DrawShape(i,f,new e.Color(.5,.9,.5),n):r.IsSleeping()?this.DrawShape(i,f,new e.Color(.5,.5,.9),n):this.DrawShape(i,f,new e.Color(.9,.9,.9),n)}}if(t&e.DebugDraw.e_jointBit)for(n=this.m_jointList;n;n=n.m_next)this.DrawJoint(n);if(t&e.DebugDraw.e_pairBit){r=this.m_broadPhase,s.Set(1/r.m_quantizationFactor.x,1/r.m_quantizationFactor.y),a.Set(.9,.9,.3);for(n=0;n<e.Pair.tableCapacity;++n)for(i=r.m_pairManager.m_hashTable[n];i!=e.Pair.nullPair;){i=r.m_pairManager.m_pairs[i],f=r.m_proxyPool[i.proxyId1];var p=r.m_proxyPool[i.proxyId2];l.lowerBound.x=r.m_worldAABB.lowerBound.x+s.x*r.m_bounds[0][f.lowerBounds[0]].value,l.lowerBound.y=r.m_worldAABB.lowerBound.y+s.y*r.m_bounds[1][f.lowerBounds[1]].value,l.upperBound.x=r.m_worldAABB.lowerBound.x+s.x*r.m_bounds[0][f.upperBounds[0]].value,l.upperBound.y=r.m_worldAABB.lowerBound.y+s.y*r.m_bounds[1][f.upperBounds[1]].value,c.lowerBound.x=r.m_worldAABB.lowerBound.x+s.x*r.m_bounds[0][p.lowerBounds[0]].value,c.lowerBound.y=r.m_worldAABB.lowerBound.y+s.y*r.m_bounds[1][p.lowerBounds[1]].value,c.upperBound.x=r.m_worldAABB.lowerBound.x+s.x*r.m_bounds[0][p.upperBounds[0]].value,c.upperBound.y=r.m_worldAABB.lowerBound.y+s.y*r.m_bounds[1][p.upperBounds[1]].value,o.x=.5*(l.lowerBound.x+l.upperBound.x),o.y=.5*(l.lowerBound.y+l.upperBound.y),u.x=.5*(c.lowerBound.x+c.upperBound.x),u.y=.5*(c.lowerBound.y+c.upperBound.y),this.m_debugDraw.DrawSegment(o,u,a),i=i.next}}if(t&e.DebugDraw.e_aabbBit){r=this.m_broadPhase,o=r.m_worldAABB.lowerBound,u=r.m_worldAABB.upperBound,s.Set(1/r.m_quantizationFactor.x,1/r.m_quantizationFactor.y),a.Set(.9,.3,.9);for(n=0;n<e.Settings.maxProxies;++n)c=r.m_proxyPool[n],c.IsValid()!=0&&(l.lowerBound.x=o.x+s.x*r.m_bounds[0][c.lowerBounds[0]].value,l.lowerBound.y=o.y+s.y*r.m_bounds[1][c.lowerBounds[1]].value,l.upperBound.x=o.x+s.x*r.m_bounds[0][c.upperBounds[0]].value,l.upperBound.y=o.y+s.y*r.m_bounds[1][c.upperBounds[1]].value,h[0].Set(l.lowerBound.x,l.lowerBound.y),h[1].Set(l.upperBound.x,l.lowerBound.y),h[2].Set(l.upperBound.x,l.upperBound.y),h[3].Set(l.lowerBound.x,l.upperBound.y),this.m_debugDraw.DrawPolygon(h,4,a));h[0].Set(o.x,o.y),h[1].Set(u.x,o.y),h[2].Set(u.x,u.y),h[3].Set(o.x,u.y),this.m_debugDraw.DrawPolygon(h,4,new e.Color(.3,.9,.9))}if(t&e.DebugDraw.e_obbBit){a.Set(.5,.3,.5);for(r=this.m_bodyList;r;r=r.m_next){f=r.m_xf;for(i=r.GetShapeList();i;i=i.m_next)if(i.m_type==e.Shape.e_polygonShape){s=i.GetOBB(),n=s.extents,h[0].Set(-n.x,-n.y),h[1].Set(n.x,-n.y),h[2].Set(n.x,n.y),h[3].Set(-n.x,n.y);for(n=0;n<4;++n)l=s.R,o=h[n],u=s.center.x+(l.col1.x*o.x+l.col2.x*o.y),h[n].y=s.center.y+(l.col1.y*o.x+l.col2.y*o.y),h[n].x=u,l=f.R,u=f.position.x+(l.col1.x*o.x+l.col2.x*o.y),h[n].y=f.position.y+(l.col1.y*o.x+l.col2.y*o.y),h[n].x=u;this.m_debugDraw.DrawPolygon(h,4,a)}}}if(t&e.DebugDraw.e_centerOfMassBit)for(r=this.m_bodyList;r;r=r.m_next)f=e.World.s_xf,f.R=r.m_xf.R,f.position=r.GetWorldCenter(),this.m_debugDraw.DrawXForm(f)}},t.RaycastSortKey=function(t){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,t))return-1;var n=t.GetBody().GetXForm(),r=[0];return t.TestSegment(n,r,this.m_raycastNormal,this.m_raycastSegment,1)==e.Shape.e_missCollide?-1:r[0]},t.RaycastSortKey2=function(t){if(this.m_contactFilter&&!this.m_contactFilter.RayCollide(this.m_raycastUserData,t))return-1;var n=t.GetBody().GetXForm(),r=[0];return t.TestSegment(n,r,this.m_raycastNormal,this.m_raycastSegment,1)!=e.Shape.e_hitCollide?-1:r[0]},ig.global.b2=e}),ig.baked=!0,ig.module("plugins.box2d.game").requires("plugins.box2d.lib","impact.game").defines(function(){ig.Box2DGame=ig.Game.extend({collisionRects:[],debugCollisionRects:!1,loadLevel:function(e){for(var t=0;t<e.layer.length;t++){var n=e.layer[t];if(n.name=="collision"){ig.world=this.createWorldFromMap(n.data,n.width,n.height,n.tilesize);break}}this.parent(e)},createWorldFromMap:function(e,t,n,r){var i=new b2.AABB;i.lowerBound.Set(0,0),i.upperBound.Set((t+2)*r*b2.SCALE,(n+2)*r*b2.SCALE);var s=new b2.Vec2(0,this.gravity*b2.SCALE),o=new b2.World(i,s,!0),u=ig.copy(e);this.collisionRects=[];for(var a=0;a<n;a++)for(var f=0;f<t;f++)if(u[a][f]){var l=this._extractRectFromMap(u,t,n,f,a);this.collisionRects.push(l)}for(var c=0;c<this.collisionRects.length;c++){var h=this.collisionRects[c],p=new b2.BodyDef;p.position.Set(h.x*r*b2.SCALE+h.width*r/2*b2.SCALE,h.y*r*b2.SCALE+h.height*r/2*b2.SCALE);var d=o.CreateBody(p),v=new b2.PolygonDef;v.SetAsBox(h.width*r/2*b2.SCALE,h.height*r/2*b2.SCALE),d.CreateShape(v)}return o},_extractRectFromMap:function(e,t,n,r,i){var s={x:r,y:i,width:1,height:1};for(var o=r+1;o<t&&e[i][o];o++)s.width++,e[i][o]=0;for(var u=i+1;u<n;u++){var a=0;for(o=r;o<r+s.width&&e[u][o];o++)a++;if(a!=s.width)return s;s.height++;for(o=r;o<r+s.width;o++)e[u][o]=0}return s},update:function(){ig.world.Step(ig.system.tick,5);for(var e=0;e<this._deferredKill.length;e++)ig.world.DestroyBody(this._deferredKill[e].body);this.parent()},draw:function(){this.parent();if(this.debugCollisionRects){var e=this.collisionMap.tilesize;for(var t=0;t<this.collisionRects.length;t++){var n=this.collisionRects[t];ig.system.context.strokeStyle="#00ff00",ig.system.context.strokeRect(ig.system.getDrawPos(n.x*e-this.screen.x),ig.system.getDrawPos(n.y*e-this.screen.y),ig.system.getDrawPos(n.width*e),ig.system.getDrawPos(n.height*e))}}}})}),ig.baked=!0,ig.module("plugins.box2d.entity").requires("impact.entity","plugins.box2d.game").defines(function(){ig.Box2DEntity=ig.Entity.extend({body:null,angle:0,init:function(e,t,n){this.parent(e,t,n),ig.global.wm||this.createBody()},createBody:function(){var e=new b2.BodyDef;e.position.Set((this.pos.x+this.size.x/2)*b2.SCALE,(this.pos.y+this.size.y/2)*b2.SCALE),this.body=ig.world.CreateBody(e);var t=new b2.PolygonDef;t.SetAsBox(this.size.x/2*b2.SCALE,this.size.y/2*b2.SCALE),t.density=1,this.body.CreateShape(t),this.body.SetMassFromShapes()},update:function(){var e=this.body.GetPosition();this.pos={x:e.x/b2.SCALE-this.size.x/2,y:e.y/b2.SCALE-this.size.y/2},this.angle=this.body.GetAngle().round(2),this.currentAnim&&(this.currentAnim.update(),this.currentAnim.angle=this.angle)},kill:function(){ig.world.DestroyBody(this.body),this.parent()}})}),ig.baked=!0,ig.module("plugins.box2d.collisions").requires("plugins.box2d.entity","plugins.box2d.game").defines(function(){ig.Box2DEntity.inject({init:function(e,t,n){this.parent(e,t,n),ig.global.wm||(this.body.entity=this)}}),ig.Box2DGame.inject({checkEntities:function(){}})}),ig.baked=!0,ig.module("game.entities.neutron").requires("impact.entity","plugins.box2d.entity").defines(function(){EntityNeutron=ig.Box2DEntity.extend({particleType:"neutron",size:{x:12,y:12,increment:[12,16,20,23,26,28,30]},mass:[3,3.5,4,4.5,5,5.5,6],resizing:!1,targetSize:{x:12,y:12},level:0,targetColour:[],colourSteps:[],flashed:!1,flashing:!1,electronBlasting:!1,electronBlastAvailable:!1,rotationStep:0,motion:{multiplier:[.3,.4,.5,.6,.7,.8,.8]},collides:ig.Entity.COLLIDES.NEVER,flip:!1,sounds:{death:new ig.Sound("media/sounds/death.ogg"),absorb:new ig.Sound("media/sounds/absorb.ogg"),decay:new ig.Sound("media/sounds/decay.ogg"),electronBlast:new ig.Sound("media/sounds/electron-blast.ogg")},alpha:1,init:function(e,t,n){var r=this;this.originalColour=[n.colour[0],n.colour[1],n.colour[2]];for(var i in this.sounds)this.sounds.hasOwnProperty(i)&&(this.sounds[i].volume=.4);this.parent(e,t,n)},createBody:function(e){var t=new b2.MassData;this.body=ig.world.CreateBody(this.getBody(e)),this.body.CreateShape(this.getShape()),this.body.CreateShape(this.getShape(!0)),t.mass=this.mass[this.level],this.body.SetMass(t),this.body.entity=this},getBody:function(e){var t=new b2.BodyDef;return t.linearDamping=.4,t.angularDamping=.2,t.type=b2.Body.b2_dynamicBody,typeof e!="undefined"?t.position.Set(e.x,e.y):t.position.Set((this.pos.x+this.size.x)*b2.SCALE,(this.pos.y+this.size.y)*b2.SCALE),t},getShape:function(e){var t=new b2.CircleDef;return e===!0?(t.radius=100*b2.SCALE,t.isSensor=!0,t.filter.categoryBits=1,t.filter.maskBits=2,t.userData={name:"electronBlastRadius"}):(t.radius=this.size.x*b2.SCALE,t.restitution=1,t.filter.categoryBits=2,t.filter.maskBits=1,t.filter.groupIndex=1,t.userData={name:"neutron"}),t},update:function(){var e=this.body.GetPosition(),t,n,r;this.body!==undefined&&this.motion.gamma!==undefined&&this.motion.beta!==undefined&&this.body.ApplyForce(new b2.Vec2(this.motion.beta*this.motion.multiplier[this.level],-this.motion.gamma*this.motion.multiplier[this.level]),e),this.resizing===!0&&this.resize(),this.flashing===!0&&this.flash();if(this.electronBlasting===!0){r=new b2.Vec2(0,0);for(t=this.body.m_contactList;t!==null;t=t.next)n=t.other.GetPosition(),r.x=n.x-e.x,r.y=n.y-e.y,ig.game.normaliseVector(r,50),t.other.ApplyImpulse(r,n);this.electronBlasting=!1}this.parent()},draw:function(){var e=ig.system.context,t=this.body.GetPosition(),n={x:t.x/b2.SCALE-ig.game.screen.x,y:t.y/b2.SCALE-ig.game.screen.y};e.beginPath(),e.arc(n.x,n.y,this.size.x,0,Math.PI*2,!0),e.fillStyle=this.getColour(),e.closePath(),e.fill(),this.electronBlastAvailable===!0&&(e.save(),e.translate(n.x,n.y),e.rotate(Math.PI*2/100*this.rotationStep++),e.beginPath(),e.arc(-this.size.x-8,0,4,0,Math.PI*2,!0),e.fillStyle="#fff",e.fill(),e.closePath(),e.restore(),this.rotationStep>100&&(this.rotationStep=0)),this.parent()},getColour:function(){return"rgba("+this.colour.join(",")+", "+this.alpha+")"},move:function(e){this.motion.gamma=e.gamma,this.motion.beta=e.beta},startFlash:function(){var e=10;this.flashing=!0,this.flashed=!1,this.targetColour=[255,255,255],this.colourSteps=[(this.targetColour[0]-this.colour[0])/e,(this.targetColour[1]-this.colour[1])/e,(this.targetColour[2]-this.colour[2])/e]},stopFlash:function(){var e=50;this.targetColour=this.originalColour,this.colourSteps=[(this.targetColour[0]-this.colour[0])/e,(this.targetColour[1]-this.colour[1])/e,(this.targetColour[2]-this.colour[2])/e]},flash:function(){var e,t;for(e=0,t=this.colourSteps.length;e<t;e++)this.colour[e]*=10,this.colour[e]+=this.colourSteps[e]*10,this.colour[e]/=10,this.flashed===!0?(this.colour[e]=Math.floor(this.colour[e]),this.colour[e]<this.targetColour[e]&&(this.colour[e]=this.targetColour[e])):(this.colour[e]=Math.ceil(this.colour[e]),this.colour[e]>this.targetColour[e]&&(this.colour[e]=this.targetColour[e]));this.colour[0]===this.targetColour[0]&&(this.flashed===!1?(this.flashed=!0,this.stopFlash()):this.flashing=!1)},absorb:function(){this.level<6&&(this.level++,$("#"+this.id).find(".value").text(this.level+1),this.targetSize={x:this.size.increment[this.level],y:this.size.increment[this.level],increment:.2},this.sounds.absorb.play(),this.resizing=!0,this.level===6&&(console.log("ELECTRON BLAST AVAILABLE!"),manager.electronBlastStatus(this.id,!0),this.electronBlastAvailable=!0))},decay:function(){this.level>0&&(this.level--,$("#"+this.id).find(".value").text(this.level+1),this.targetSize={x:this.size.increment[this.level],y:this.size.increment[this.level],increment:.2},this.sounds.decay.play(),this.resizing=!0,this.level<6&&this.electronBlastAvailable===!0&&(console.log("ELECTRON BLAST LOST!"),manager.electronBlastStatus(this.id,!1),this.electronBlastAvailable=!1))},resize:function(){var e=this.body.GetLinearVelocity(),t=this.body.GetPosition();this.size.x<this.targetSize.x?(this.size.x*=10,this.size.x+=this.targetSize.increment*10,this.size.x/=10,this.size.y*=10,this.size.y+=this.targetSize.increment*10,this.size.y/=10):(this.size.x*=10,this.size.x-=this.targetSize.increment*10,this.size.x/=10,this.size.y*=10,this.size.y-=this.targetSize.increment*10,this.size.y/=10),ig.world.DestroyBody(this.body),this.createBody(t),this.body.SetLinearVelocity(e),this.size.x===this.targetSize.x&&(this.size.x=parseInt(this.size.x,10),this.size.y=parseInt(this.size.y,10),this.resizing=!1)},electronBlast:function(){this.electronBlastAvailable===!0&&(console.log("ELECTRON BLASTED!"),this.sounds.electronBlast.play(),this.level=0,this.targetSize={x:this.size.increment[this.level],y:this.size.increment[this.level],increment:.5},this.resizing=!0,this.electronBlasting=!0,this.electronBlastAvailable=!1,manager.electronBlastStatus(this.id,!1),manager.stats.electrons++)}})}),ig.baked=!0,ig.module("game.entities.particle").requires("impact.entity","plugins.box2d.entity").defines(function(){EntityParticle=ig.Box2DEntity.extend({size:{x:6,y:6},force:{min:25,max:50},collides:ig.Entity.COLLIDES.NEVER,flip:!1,sounds:{collision:new ig.Sound("media/sounds/collision.ogg")},colour:[],fadeOut:!1,maxAlpha:1,alpha:0,alphaIncrement:.06,threshold:4,blackholePull:!1,blackholePullApplied:!1,init:function(e,t,n){this.sounds.collision.volume=.1,this.parent(e,t,n)},createBody:function(){var e=new b2.BodyDef,t=new b2.CircleDef,n=new b2.MassData;e.linearDamping=.4,e.angularDamping=.2,e.position.Set((this.pos.x+this.size.x)*b2.SCALE,(this.pos.y+this.size.y)*b2.SCALE),this.body=ig.world.CreateBody(e),t.radius=this.size.x*b2.SCALE,n.mass=2,t.restitution=1,t.filter.categoryBits=2,t.filter.maskBits=1,t.filter.groupIndex=1,this.body.CreateShape(t),this.body.SetMass(n)},update:function(){this.body.ApplyForce(ig.game.getRandomVectorMinMax(this.force.min,this.force.max),this.body.GetPosition()),this.fadeOut===!0?this.alpha>this.alphaIncrement?this.alpha-=this.alphaIncrement:(this.alpha=0,this.removeParticle()):this.alpha<this.maxAlpha?this.alpha+=this.alphaIncrement:this.alpha=this.maxAlpha,this.parent()},draw:function(){var e=ig.system.context,t=ig.game.screen;e.beginPath(),e.arc(this.pos.x-t.x+this.size.x/2,this.pos.y-t.y+this.size.y/2,this.size.x,0,Math.PI*2,!1),e.fillStyle=this.getColour(),e.closePath(),e.fill(),this.parent()},collideWith:function(e,t){var n=this;e.particleType==="neutron"&&t.m_userData.name==="neutron"&&n.fadeOut===!1&&(e.startFlash(),n.processCollision(e,t)),this.parent()},processCollision:function(e,t){this.fadeOut=!0},getColour:function(){return"rgba("+this.colour.join(",")+", "+this.alpha+")"},removeParticle:function(){ig.game[this.particleType+"s"].remove(this.id)},isInBounds:function(){return this.pos.x>this.size.x*2&&this.pos.y>this.size.y*2&&this.pos.x<ig.system.canvas.width&&this.pos.y<ig.system.canvas.height?!0:!1}})}),ig.baked=!0,ig.module("game.entities.positron").requires("game.entities.particle").defines(function(){EntityPositron=EntityParticle.extend({particleType:"positron",colour:[0,220,180],processCollision:function(e,t){e.particleType==="neutron"&&t.m_userData.name==="neutron"&&(e.absorb(),manager.stats.positrons++),this.parent()}})}),ig.baked=!0,ig.module("game.entities.negatron").requires("game.entities.particle").defines(function(){EntityNegatron=EntityParticle.extend({particleType:"negatron",colour:[240,80,60],size:{x:4,y:4},processCollision:function(e,t){e.particleType==="neutron"&&t.m_userData.name==="neutron"&&(e.decay(),manager.stats.negatrons++),this.parent()}})}),ig.baked=!0,ig.module("game.entities.dust").requires("game.entities.particle").defines(function(){EntityDust=EntityParticle.extend({particleType:"dust",colour:[255,255,255],maxAlpha:undefined,size:{x:1,y:1},force:{min:15,max:30},createBody:function(){var e=new b2.BodyDef,t=new b2.CircleDef,n=new b2.MassData;e.linearDamping=.4,e.angularDamping=.2,e.position.Set((this.pos.x+this.size.x)*b2.SCALE,(this.pos.y+this.size.y)*b2.SCALE),this.body=ig.world.CreateBody(e),t.radius=this.size.x*b2.SCALE,n.mass=2,t.restitution=1,t.filter.categoryBits=3,t.filter.maskBits=1,this.body.CreateShape(t),this.body.SetMass(n)}})}),ig.baked=!0,ig.module("game.entities.blackhole").requires("impact.entity","plugins.box2d.entity").defines(function(){EntityBlackhole=ig.Box2DEntity.extend({particleType:"blackhole",size:{x:4,y:4,max:60,increment:.02},debugSwitch:!1,collides:ig.Entity.COLLIDES.NEVER,flip:!1,color:[0,0,0],alpha:1,init:function(e,t,n){this.parent(e,t,n)},categoryBits:1,maskBits:2,createBody:function(){var e=new b2.BodyDef,t=new b2.CircleDef,n=new b2.CircleDef;e.position.Set((this.pos.x+this.size.x)*b2.SCALE,(this.pos.y+this.size.y)*b2.SCALE),this.body=ig.world.CreateBody(e),t.radius=this.size.x*b2.SCALE,t.isSensor=!0,t.userData={name:"blackhole"},t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,this.body.CreateShape(t),n.radius=this.size.x*4*b2.SCALE,n.isSensor=!0,n.userData={name:"eventHorizon"},n.categoryBits=this.categoryBits,n.maskBits=this.maskBits,this.body.CreateShape(n),this.body.SetMassFromShapes()},resize:function(){var e=new b2.CircleDef,t=new b2.CircleDef,n,r=this.body.m_shapeCount,i=[];for(n=0;n<r;n++)n===1?i.push(this.body.GetShapeList()):i.push(this.body.GetShapeList().m_next);for(n=0;n<r;n++)this.body.DestroyShape(i[n]);e.radius=this.size.x*b2.SCALE,e.isSensor=!0,e.userData={name:"blackhole"},e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,this.body.CreateShape(e),t.radius=this.size.x*2*b2.SCALE,t.isSensor=!0,t.userData={name:"eventHorizon"},t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,this.body.CreateShape(t)},update:function(){var e=this.body.GetPosition(),t=new b2.Vec2(0,0),n,r;this.size.x<this.size.max&&(this.size.x=this.size.y+=this.size.increment,this.resize());for(n=this.body.m_contactList;n!==null;n=n.next)r=n.other.GetPosition(),t.x=e.x-r.x,t.y=e.y-r.y,ig.game.normaliseVector(t,5),n.other.ApplyForce(t,r);this.parent()},draw:function(){var e=ig.system.context,t=this.body.GetPosition(),n={x:t.x/b2.SCALE-ig.game.screen.x,y:t.y/b2.SCALE-ig.game.screen.y},r;e.beginPath(),e.arc(n.x,n.y,this.size.x*4,0,Math.PI*2,!1),r=e.createRadialGradient(n.x,n.y,this.size.x,n.x,n.y,this.size.x*4),r.addColorStop(0,"rgba(255, 255, 255, 0.04)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=r,e.fill(),e.closePath(),e.beginPath(),e.arc(n.x,n.y,this.size.x,0,Math.PI*2,!1),e.fillStyle=this.getColour(),e.closePath(),e.fill(),e.closePath(),this.parent()},collideWith:function(e,t,n){n.m_userData.name==="blackhole"&&(manager.stats.consumed++,e.particleType==="neutron"?ig.game[e.particleType+"s"].kill(e.id):ig.game[e.particleType+"s"].remove(e.id)),this.parent()},stopCollideWith:function(e,t,n){},getColour:function(){return"rgba("+this.color.join(",")+", "+this.alpha+")"}})}),ig.baked=!0,ig.module("game.levels.main").requires("impact.image").defines(function(){LevelMain={entities:[],layer:[{name:"collision",width:34,height:26,linkWithCollision:!1,visible:1,tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:20,foreground:!1,data:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]}]}}),ig.baked=!0,ig.module("plugins.box2d.debug").requires("plugins.box2d.lib").defines(function(){ig.Box2DDebug=ig.Class.extend({drawer:null,world:null,alpha:1,init:function(e,t,n){this.world=e,this.drawer=new b2.DebugDraw,this.drawer.m_sprite={graphics:this},this.drawer.m_drawScale=1/b2.SCALE*ig.system.scale,this.drawer.m_fillAlpha=t||.3,this.drawer.m_lineThickness=n||1,this.drawer.m_drawFlags=b2.DebugDraw.e_shapeBit|b2.DebugDraw.e_jointBit},draw:function(){ig.system.context.save(),ig.system.context.translate(-ig.game.screen.x*ig.system.scale,-ig.game.screen.y*ig.system.scale),this.world.SetDebugDraw(this.drawer),this.world.DrawDebugData(),this.world.SetDebugDraw(null),ig.system.context.restore()},clear:function(){},lineStyle:function(e,t,n){ig.system.context.strokeStyle="rgb("+t._r+","+t._g+","+t._b+")",ig.system.context.lineWidth=e},moveTo:function(e,t){ig.system.context.beginPath(),ig.system.context.moveTo(e,t)},lineTo:function(e,t){ig.system.context.lineTo(e,t),ig.system.context.stroke()},beginFill:function(e,t){this.alpha=t,ig.system.context.fillStyle="rgb("+e._r+","+e._g+","+e._b+")",ig.system.context.beginPath()},endFill:function(){ig.system.context.globalAlpha=this.alpha,ig.system.context.fill(),ig.system.context.globalAlpha=1},drawCircle:function(e,t,n){ig.system.context.beginPath(),ig.system.context.arc(e,t,n,0,Math.PI*2,!0),ig.system.context.stroke()}})}),ig.baked=!0,ig.module("game.main").requires("impact.game","plugins.box2d.game","plugins.box2d.collisions","game.entities.neutron","game.entities.positron","game.entities.negatron","game.entities.dust","game.entities.blackhole","game.levels.main","plugins.box2d.debug").defines(function(){Prototype=ig.Box2DGame.extend({clearColor:"#222222",map:[],neutrons:{count:0,add:function(e){var t=ig.game,n=this.getStartPosition();this[e.id]=t.spawnEntity(EntityNeutron,n.x+t.screen.x,n.y+t.screen.y,e),this.count++},addMultiple:function(e){for(var t in e)e.hasOwnProperty(t)&&ig.game.neutrons.add(e[t])},kill:function(e){manager.killPlayer(e),this[e].kill(),this.count--},remove:function(e){this[e.id].kill(),this.count--},getStartPosition:function(){var e=ig.game.blackhole,t={x:ig.game.getRandomNumber(0,ig.system.width-24),y:ig.game.getRandomNumber(0,ig.system.height-24)};while(t.x>e.body.GetPosition().x/b2.SCALE-120-24&&t.x<e.body.GetPosition().x/b2.SCALE+120&&t.y>e.body.GetPosition().y/b2.SCALE-120-24&&t.y<e.body.GetPosition().y/b2.SCALE+120)t={x:ig.game.getRandomNumber(0,ig.system.width-24),y:ig.game.getRandomNumber(0,ig.system.height-24)};return t}},negatrons:{total:10,count:0,counter:0,add:function(){var e=ig.game,t={id:"negatron_"+this.counter},n=ig.game.getRandomPosition();this[t.id]=e.spawnEntity(EntityNegatron,n.x,n.y,t),this.count++,this.counter++},remove:function(e){this[e].kill(),this.count--},check:function(){while(this.count<this.total)this.add();ig.game.sortEntitiesDeferred()}},positrons:{total:10,count:0,counter:0,add:function(){var e=ig.game,t={id:"positron_"+this.counter},n=ig.game.getRandomPosition();this[t.id]=e.spawnEntity(EntityPositron,n.x,n.y,t),this.count++,this.counter++},remove:function(e){this[e].kill(),this.count--},check:function(){while(this.count<this.total)this.add();ig.game.sortEntitiesDeferred()}},dusts:{total:450,count:0,counter:0,add:function(){var e=ig.game,t={id:"dust_"+this.counter,maxAlpha:ig.game.getRandomNumber(.2,1)},n=ig.game.getRandomPosition();this[t.id]=e.spawnEntity(EntityDust,n.x,n.y,t),this[t.id].zIndex=-1,this.count++,this.counter++},remove:function(e){this[e].kill(),this.count--},check:function(){while(this.count<this.total)this.add();ig.game.sortEntitiesDeferred()}},calculateParticleCount:function(){var e=250,t=ig.system.width*ig.system.height,n=Math.round(t/(e*e));this.negatrons.total=this.positrons.total=n},getRandomPosition:function(){var e=20,t={min:e,max:ig.system.width-e},n={min:e,max:ig.system.height-e};return{x:Math.random()*(t.max-t.min)+t.min,y:Math.random()*(n.max-n.min)+n.min}},getRandomNumber:function(e,t){return Math.random()*(t-e)+e},getRandomVector:function(e){return new b2.Vec2(this.getRandomNumber(0,e)*this.getRandomScale(),this.getRandomNumber(0,e)*this.getRandomScale())},getRandomVectorMinMax:function(e,t){return new b2.Vec2(this.getRandomNumber(e,t)*this.getRandomScale(),this.getRandomNumber(e,t)*this.getRandomScale())},getRandomScale:function(){return Math.random()<.5?1:-1},normaliseVector:function(e,t){var n,r;t=t||50,Math.abs(e.x)>Math.abs(e.y)?(n=e.x/e.y,r=e.x>0?1:-1,e.x=t*r,e.y=e.x/n):(n=e.y/e.x,r=e.y>0?1:-1,e.y=t*r,e.x=e.y/n)},generateMap:function(e,t,n){var r,i,s,o;e=e/n+2,t=t/n+2,r={entities:[],layer:[{name:"collision",width:e,height:t,linkWithCollision:!1,visible:1,tilesetName:"",repeat:!1,preRender:!1,distance:1,tilesize:n,foreground:!1,data:[]}]};for(i=0;i<t;i++){s=[];for(o=0;o<e;o++)i===0||i===t-1||o===0||o===e-1?s.push(1):s.push(0);r.layer[0].data.push(s)}return r},generateBoundingBox:function(e,t,n){var r=new b2.AABB,i=new b2.Vec2(0,this.gravity*b2.SCALE);r.lowerBound.Set(0,0),r.upperBound.Set((e+100+n*2)*b2.SCALE,(t+100+n*2)*b2.SCALE),ig.world=new b2.World(r,i,!0);var s=[{width:e,height:n,x:n,y:0},{width:n,height:t,x:e+n,y:n},{width:e,height:n,x:n,y:t+n},{width:n,height:t,x:0,y:n}],o,u;for(o=0,u=s.length;o<u;o++){var a=new b2.BodyDef,f,l;a.position.Set((s[o].x+s[o].width/2)*b2.SCALE,(s[o].y+s[o].height/2)*b2.SCALE),f=ig.world.CreateBody(a),l=new b2.PolygonDef,l.SetAsBox(s[o].width/2*b2.SCALE,s[o].height/2*b2.SCALE),f.CreateShape(l)}},init:function(){var e=10,t;this.generateBoundingBox(ig.system.width,ig.system.height,e),this.screen.x=this.screen.y=e,this.centre={x:ig.system.width/2+this.screen.x*2,y:ig.system.height/2+this.screen.y*2},ig.music.add("media/sounds/blackhole.ogg"),ig.music.volume=.2,ig.music.play(),t={x:this.getRandomNumber(122,ig.system.width-2-120),y:this.getRandomNumber(122,ig.system.height-2-120)},this.blackhole=this.spawnEntity(EntityBlackhole,t.x+this.screen.x,t.y+this.screen.y),this.neutrons.addMultiple(manager.players);var n=[[1]];this.bg=new ig.BackgroundMap(100,n,"media/images/scaler.png"),this.bg.repeat=!0,this.bg.foreground=!0,this.setupListeners()},setupListeners:function(){var e=new b2.ContactListener;e.Add=function(e){var t=e.shape1,n=e.shape2,r=t.GetBody().entity,i=n.GetBody().entity;if(!r||!i)return;r.collideWith(i,n,t),i.collideWith(r,t,n)},ig.world.SetContactListener(e)},update:function(){this.positrons.check(),this.negatrons.check(),this.dusts.check(),this.parent()},draw:function(){this.parent(),this.bg.draw()}})}),ig.baked=!0,ig.module("game.connections").defines(function(){connections={init:function(){this.connectSocket(),this.bindSocketEvents(),this.registerLab(),console.log("Connections initialised: ",this)},connectSocket:function(){this.socket=io.connect("//"+location.hostname+":"+location.port)},registerLab:function(){this.socket.emit("registration",{type:"lab",lab:{id:config.labId}})},bindSocketEvents:function(){var e=this,t,n,r;e.socket.on("message",function(e){console.log("Message: ",e.message,e);switch(e.type){case"registration":e.data.successful?(manager.setPlayers(e.data.players),manager.loadLobby()):manager.loadView("error",{message:e.message});break;case"playerJoined":r=e.data,manager.addPlayer(r);break;case"playerReady":r=e.data,manager.playerReady(r);break;case"playerCancelled":r=e.data,manager.playerCancelled(r);break;case"playerLeft":r=e.data,manager.removePlayer(r);break;case"playerResurrect":r=e.data,manager.resurrectPlayer(r)}}),e.socket.on("motion",function(e){ig.game!==undefined&&ig.game.neutrons[e.player.id]!==undefined&&ig.game.neutrons[e.player.id].move(e.motion)}),e.socket.on("electronBlast",function(e){ig.game!==undefined&&ig.game.neutrons[e.player.id]!==undefined&&ig.game.neutrons[e.player.id].electronBlast()})},updateStatus:function(e){this.socket.emit("status",{data:{state:e,labId:config.labId}})},alertWinner:function(e){console.log("Alerting winner: ",e),this.socket.emit("winner",{player:e})},killPlayer:function(e){this.socket.emit("killed",{player:e})},emit:function(e,t){this.socket.emit(e,t)}}}),ig.baked=!0,ig.module("plugins.handlebars-runtime").defines(function(){Handlebars={},function(e,t){e.VERSION="1.0.0",e.COMPILER_REVISION=4,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},e.helpers={},e.partials={};var n=Object.prototype.toString,r="[object Function]",i="[object Object]";e.registerHelper=function(t,r,s){if(n.call(t)===i){if(s||r)throw new e.Exception("Arg not supported with multiple helpers");e.Utils.extend(this.helpers,t)}else s&&(r.not=s),this.helpers[t]=r},e.registerPartial=function(t,r){n.call(t)===i?e.Utils.extend(this.partials,t):this.partials[t]=r},e.registerHelper("helperMissing",function(e){if(arguments.length===2)return t;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,i){var s=i.inverse||function(){},o=i.fn,u=n.call(t);return u===r&&(t=t.call(this)),t===!0?o(this):t===!1||t==null?s(this):u==="[object Array]"?t.length>0?e.helpers.each(t,i):s(this):o(t)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var n=new e.K;return e.K.prototype=null,n},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(t,n){if(e.logger.level<=t){var r=e.logger.methodMap[t];typeof console!="undefined"&&console[r]&&console[r].call(console,n)}}},e.log=function(t,n){e.logger.log(t,n)},e.registerHelper("each",function(t,i){var s=i.fn,o=i.inverse,u=0,a="",f,l=n.call(t);l===r&&(t=t.call(this)),i.data&&(f=e.createFrame(i.data));if(t&&typeof t=="object")if(t instanceof Array)for(var c=t.length;u<c;u++)f&&(f.index=u),a+=s(t[u],{data:f});else for(var h in t)t.hasOwnProperty(h)&&(f&&(f.key=h),a+=s(t[h],{data:f}),u++);return u===0&&(a=o(this)),a}),e.registerHelper("if",function(t,i){var s=n.call(t);return s===r&&(t=t.call(this)),!t||e.Utils.isEmpty(t)?i.inverse(this):i.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn})}),e.registerHelper("with",function(t,i){var s=n.call(t);s===r&&(t=t.call(this));if(!e.Utils.isEmpty(t))return i.fn(t)}),e.registerHelper("log",function(t,n){var r=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;e.log(r,t)});var s=["description","fileName","lineNumber","message","name","number","stack"];e.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<s.length;n++)this[s[n]]=t[s[n]]},e.Exception.prototype=new Error,e.SafeString=function(e){this.string=e},e.SafeString.prototype.toString=function(){return this.string.toString()};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,a=/[&<>"'`]/,f=function(e){return o[e]||"&amp;"};e.Utils={extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},escapeExpression:function(t){return t instanceof e.SafeString?t.toString():t==null||t===!1?"":(t=t.toString(),a.test(t)?t.replace(u,f):t)},isEmpty:function(e){return!e&&e!==0?!0:n.call(e)==="[object Array]"&&e.length===0?!0:!1}},e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,r){var i=this.programs[t];return r?i=e.VM.program(t,n,r):i||(i=this.programs[t]=e.VM.program(t,n)),i},merge:function(t,n){var r=t||n;return t&&n&&(r={},e.Utils.extend(r,n),e.Utils.extend(r,t)),r},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(r,i){i=i||{};var s=t.call(n,e,r,i.helpers,i.partials,i.data),o=n.compilerInfo||[],u=o[0]||1,a=e.COMPILER_REVISION;if(u!==a){if(u<a){var f=e.REVISION_CHANGES[a],l=e.REVISION_CHANGES[u];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+f+") or downgrade your runtime to an older version ("+l+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+")."}return s}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i},program:function(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r},noop:function(){return""},invokePartial:function(n,r,i,s,o,u){var a={helpers:s,partials:o,data:u};if(n===t)throw new e.Exception("The partial "+r+" could not be found");if(n instanceof Function)return n(i,a);if(!e.compile)throw new e.Exception("The partial "+r+" could not be compiled when running in runtime-only mode");return o[r]=e.compile(n,{data:u!==t}),o[r](i,a)}},e.template=e.VM.template}(Handlebars)}),ig.baked=!0,ig.module("plugins.templates").requires("plugins.handlebars-runtime").defines(function(){this.templates=this.templates||{},this.templates.error=Handlebars.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<h1 class="error-message">',(o=n.message)?o=o.call(t,{hash:{},data:i}):(o=t.message,o=typeof o===u?o.apply(t):o),s+=a(o)+"</h1>",s}),this.templates.game=Handlebars.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<header class="header">\n    <h1 class="banner" role="banner">Gyroscopes &amp; Isotopes</h1>\n</header>\n\n<section class="main" role="main">\n    <div class="warning">\n        <canvas id="canvas"></canvas>\n    </div>\n</section>'}),this.templates.gameover=Handlebars.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<header class="header">\n    <h1 class="banner" role="banner">Gyroscopes &amp; Isotopes</h1>\n</header>\n\n<section class="main" role="main">\n    <p class="player" style="background: rgb('+a((o=(o=t.winner,o==null||o===!1?o:o.colour),typeof o===u?o.apply(t):o))+');"><span class="player-name">'+a((o=(o=t.winner,o==null||o===!1?o:o.name),typeof o===u?o.apply(t):o))+" survived!</span></p>\n    <p><strong>"+a((o=(o=t.stats,o==null||o===!1?o:o.consumed),typeof o===u?o.apply(t):o))+"</strong> particles were consumed by the black hole.</p>\n    <p><strong>"+a((o=(o=t.stats,o==null||o===!1?o:o.positrons),typeof o===u?o.apply(t):o))+"</strong> positrons were absorbed by participants' neutrons.</p>\n    <p><strong>"+a((o=(o=t.stats,o==null||o===!1?o:o.negatrons),typeof o===u?o.apply(t):o))+"</strong> negatrons caused neutron decay.</p>\n    <p><strong>"+a((o=(o=t.stats,o==null||o===!1?o:o.electrons),typeof o===u?o.apply(t):o))+"</strong> electrons were blasted into raw energy.</p>\n    <p>This experiment lasted <strong>"+a((o=(o=t.stats,o==null||o===!1?o:o.duration),typeof o===u?o.apply(t):o))+'</strong> seconds.</p>\n    <a href="/gyroscopes-and-isotopes/lab/'+a((o=(o=t.winner,o==null||o===!1?o:o.labId),typeof o===u?o.apply(t):o))+'" title="Click to play again" class="link-button rerun">Rerun the experiment</a>\n</section>',s}),this.templates.lobby=Handlebars.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n            <li id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="player" style="background: rgb(',(i=n.colour)?i=i.call(e,{hash:{},data:t}):(i=e.colour,i=typeof i===u?i.apply(e):i),r+=a(i)+');"><span class="player-name">',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===u?i.apply(e):i),r+=a(i)+"</span></li>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<header class="header">\n    <h1 class="banner" role="banner">Gyroscopes &amp; Isotopes</h1>\n</header>\n\n<section class="main" role="main">\n    <p class="instructions">Scan the QR code or navigate to the URL below on a mobile device to join the experiment:-</p>\n    <p><span id="qrcode" data-href="',(o=n.controllerUrl)?o=o.call(t,{hash:{},data:i}):(o=t.controllerUrl,o=typeof o===u?o.apply(t):o),s+=a(o)+'"></span><span id="or" class="or">Or</span><span id="countdown" class="or hidden"><span class="seconds">5</span></span><span class="shortUrl">',(o=n.shortControllerUrl)?o=o.call(t,{hash:{},data:i}):(o=t.shortControllerUrl,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span></p>\n    <ul id="players">\n        <li class="player-slot">1</li>\n        <li class="player-slot">2</li>\n        <li class="player-slot">3</li>\n        <li class="player-slot">4</li>\n        ',o=n.each.call(t,t.players,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n    </ul>\n    <button id="start-experiment" data-icon="&#x3e;"></button>\n</section>',s}),this.templates["lobby.player"]=Handlebars.template(function(e,t,n,r,i){function l(e,t){return" ready"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<li id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===u?o.apply(t):o),s+=a(o)+'" class="player',o=n["if"].call(t,t.ready,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='" style="background: rgb(',(o=n.colour)?o=o.call(t,{hash:{},data:i}):(o=t.colour,o=typeof o===u?o.apply(t):o),s+=a(o)+');"><span class="player-name">',(o=n.name)?o=o.call(t,{hash:{},data:i}):(o=t.name,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span></li>",s}),Handlebars.templates=this.templates}),ig.baked=!0,ig.module("plugins.jquery-qrcode").defines(function(){(function(e){var t=function(e,t,n){var r=o(e,t);return r.addData(n),r.make(),r},n=function(e){for(var n=2;n<=40;n+=1)try{return t(n,"L",e)}catch(r){}return null},r=function(t){var r=n(t.text),i=e("<canvas/>").attr("width",t.width).attr("height",t.height),s=i[0].getContext("2d");t.bgColor&&(s.fillStyle=t.bgColor,s.fillRect(0,0,t.width,t.height));if(r){var o=r.getModuleCount(),u=t.width/o,a=t.height/o,f,l;s.beginPath();for(f=0;f<o;f+=1)for(l=0;l<o;l+=1)r.isDark(f,l)&&s.rect(l*u,f*a,u,a);s.fillStyle=t.color,s.fill()}return i},i=function(t){var r=n(t.text),i=e("<div/>").css({position:"relative",left:0,top:0,padding:0,margin:0,width:t.width,height:t.height});t.bgColor&&i.css("background-color",t.bgColor);if(r){var s=r.getModuleCount(),o=Math.floor(t.width/s),u=Math.floor(t.height/s),a=Math.floor(.5*(t.width-o*s)),f=Math.floor(.5*(t.height-u*s)),l,c;for(l=0;l<s;l+=1)for(c=0;c<s;c+=1)r.isDark(l,c)&&e("<div/>").css({left:a+c*o,top:f+l*u}).appendTo(i);i.children().css({position:"absolute",padding:0,margin:0,width:o,height:u,"background-color":t.color})}return i},s={render:"canvas",width:256,height:256,color:"#000",bgColor:null,text:"no text"};e.fn.qrcode=function(t){var n=e.extend({},s,t);return this.each(function(){e(this).append(n.render==="canvas"?r(n):i(n))})};var o=function(){function o(e,t){if(typeof e.length=="undefined")throw new Error(e.length+"/"+t);var n=function(){var n=0;while(n<e.length&&e[n]==0)n+=1;var r=new Array(e.length-n+t);for(var i=0;i<e.length-n;i+=1)r[i]=e[i+n];return r}(),r={};return r.get=function(e){return n[e]},r.getLength=function(){return n.length},r.multiply=function(e){var t=new Array(r.getLength()+e.getLength()-1);for(var n=0;n<r.getLength();n+=1)for(var i=0;i<e.getLength();i+=1)t[n+i]^=s.gexp(s.glog(r.get(n))+s.glog(e.get(i)));return o(t,0)},r.mod=function(e){if(r.getLength()-e.getLength()<0)return r;var t=s.glog(r.get(0))-s.glog(e.get(0)),n=new Array(r.getLength());for(var i=0;i<r.getLength();i+=1)n[i]=r.get(i);for(var i=0;i<e.getLength();i+=1)n[i]^=s.gexp(s.glog(e.get(i))+t);return o(n,0).mod(e)},r}var e=function(e,t){var r=236,s=17,l=e,c=n[t],h=null,p=0,v=null,m=new Array,g={},y=function(e,t){p=l*4+17,h=function(e){var t=new Array(e);for(var n=0;n<e;n+=1){t[n]=new Array(e);for(var r=0;r<e;r+=1)t[n][r]=null}return t}(p),b(0,0),b(p-7,0),b(0,p-7),S(),E(),T(e,t),l>=7&&x(e),v==null&&(v=k(l,c,m)),N(v,t)},b=function(e,t){for(var n=-1;n<=7;n+=1){if(e+n<=-1||p<=e+n)continue;for(var r=-1;r<=7;r+=1){if(t+r<=-1||p<=t+r)continue;0<=n&&n<=6&&(r==0||r==6)||0<=r&&r<=6&&(n==0||n==6)||2<=n&&n<=4&&2<=r&&r<=4?h[e+n][t+r]=!0:h[e+n][t+r]=!1}}},w=function(){var e=0,t=0;for(var n=0;n<8;n+=1){y(!0,n);var r=i.getLostPoint(g);if(n==0||e>r)e=r,t=n}return t},E=function(){for(var e=8;e<p-8;e+=1){if(h[e][6]!=null)continue;h[e][6]=e%2==0}for(var t=8;t<p-8;t+=1){if(h[6][t]!=null)continue;h[6][t]=t%2==0}},S=function(){var e=i.getPatternPosition(l);for(var t=0;t<e.length;t+=1)for(var n=0;n<e.length;n+=1){var r=e[t],s=e[n];if(h[r][s]!=null)continue;for(var o=-2;o<=2;o+=1)for(var u=-2;u<=2;u+=1)o==-2||o==2||u==-2||u==2||o==0&&u==0?h[r+o][s+u]=!0:h[r+o][s+u]=!1}},x=function(e){var t=i.getBCHTypeNumber(l);for(var n=0;n<18;n+=1){var r=!e&&(t>>n&1)==1;h[Math.floor(n/3)][n%3+p-8-3]=r}for(var n=0;n<18;n+=1){var r=!e&&(t>>n&1)==1;h[n%3+p-8-3][Math.floor(n/3)]=r}},T=function(e,t){var n=c<<3|t,r=i.getBCHTypeInfo(n);for(var s=0;s<15;s+=1){var o=!e&&(r>>s&1)==1;s<6?h[s][8]=o:s<8?h[s+1][8]=o:h[p-15+s][8]=o}for(var s=0;s<15;s+=1){var o=!e&&(r>>s&1)==1;s<8?h[8][p-s-1]=o:s<9?h[8][15-s-1+1]=o:h[8][15-s-1]=o}h[p-8][8]=!e},N=function(e,t){var n=-1,r=p-1,s=7,o=0,u=i.getMaskFunction(t);for(var a=p-1;a>0;a-=2){a==6&&(a-=1);for(;;){for(var f=0;f<2;f+=1)if(h[r][a-f]==null){var l=!1;o<e.length&&(l=(e[o]>>>s&1)==1);var c=u(r,a-f);c&&(l=!l),h[r][a-f]=l,s-=1,s==-1&&(o+=1,s=7)}r+=n;if(r<0||p<=r){r-=n,n=-n;break}}}},C=function(e,t){var n=0,r=0,s=0,u=new Array(t.length),a=new Array(t.length);for(var f=0;f<t.length;f+=1){var l=t[f].dataCount,c=t[f].totalCount-l;r=Math.max(r,l),s=Math.max(s,c),u[f]=new Array(l);for(var h=0;h<u[f].length;h+=1)u[f][h]=255&e.getBuffer()[h+n];n+=l;var p=i.getErrorCorrectPolynomial(c),d=o(u[f],p.getLength()-1),v=d.mod(p);a[f]=new Array(p.getLength()-1);for(var h=0;h<a[f].length;h+=1){var m=h+v.getLength()-a[f].length;a[f][h]=m>=0?v.get(m):0}}var g=0;for(var h=0;h<t.length;h+=1)g+=t[h].totalCount;var y=new Array(g),b=0;for(var h=0;h<r;h+=1)for(var f=0;f<t.length;f+=1)h<u[f].length&&(y[b]=u[f][h],b+=1);for(var h=0;h<s;h+=1)for(var f=0;f<t.length;f+=1)h<a[f].length&&(y[b]=a[f][h],b+=1);return y},k=function(e,t,n){var o=u.getRSBlocks(e,t),f=a();for(var l=0;l<n.length;l+=1){var c=n[l];f.put(c.getMode(),4),f.put(c.getLength(),i.getLengthInBits(c.getMode(),e)),c.write(f)}var h=0;for(var l=0;l<o.length;l+=1)h+=o[l].dataCount;if(f.getLengthInBits()>h*8)throw new Error("code length overflow. ("+f.getLengthInBits()+">"+h*8+")");f.getLengthInBits()+4<=h*8&&f.put(0,4);while(f.getLengthInBits()%8!=0)f.putBit(!1);for(;;){if(f.getLengthInBits()>=h*8)break;f.put(r,8);if(f.getLengthInBits()>=h*8)break;f.put(s,8)}return C(f,o)};return g.addData=function(e){var t=f(e);m.push(t),v=null},g.isDark=function(e,t){if(e<0||p<=e||t<0||p<=t)throw new Error(e+","+t);return h[e][t]},g.getModuleCount=function(){return p},g.make=function(){y(!1,w())},g.createTableTag=function(e,t){e=e||2,t=typeof t=="undefined"?e*4:t;var n="";n+='<table style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: "+t+"px;",n+='">',n+="<tbody>";for(var r=0;r<g.getModuleCount();r+=1){n+="<tr>";for(var i=0;i<g.getModuleCount();i+=1)n+='<td style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: 0px;",n+=" width: "+e+"px;",n+=" height: "+e+"px;",n+=" background-color: ",n+=g.isDark(r,i)?"#000000":"#ffffff",n+=";",n+='"/>';n+="</tr>"}return n+="</tbody>",n+="</table>",n},g.createImgTag=function(e,t){e=e||2,t=typeof t=="undefined"?e*4:t;var n=g.getModuleCount()*e+t*2,r=t,i=n-t;return d(n,n,function(t,n){if(r<=t&&t<i&&r<=n&&n<i){var s=Math.floor((t-r)/e),o=Math.floor((n-r)/e);return g.isDark(o,s)?0:1}return 1})},g};e.stringToBytes=function(e){var t=new Array;for(var n=0;n<e.length;n+=1){var r=e.charCodeAt(n);t.push(r&255)}return t},e.createStringToBytes=function(e,t){var n=function(){var n=h(e),r=function(){var e=n.read();if(e==-1)throw new Error;return e},i=0,s={};for(;;){var o=n.read();if(o==-1)break;var u=r(),a=r(),f=r(),l=String.fromCharCode(o<<8|u),c=a<<8|f;s[l]=c,i+=1}if(i!=t)throw new Error(i+" != "+t);return s}(),r="?".charCodeAt(0);return function(e){var t=new Array;for(var i=0;i<e.length;i+=1){var s=e.charCodeAt(i);if(s<128)t.push(s);else{var o=n[e.charAt(i)];typeof o=="number"?(o&255)==o?t.push(o):(t.push(o>>>8),t.push(o&255)):t.push(r)}}return t}};var t={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},r={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i=function(){var e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=1335,i=7973,u=21522,a={},f=function(e){var t=0;while(e!=0)t+=1,e>>>=1;return t};return a.getBCHTypeInfo=function(e){var t=e<<10;while(f(t)-f(n)>=0)t^=n<<f(t)-f(n);return(e<<10|t)^u},a.getBCHTypeNumber=function(e){var t=e<<12;while(f(t)-f(i)>=0)t^=i<<f(t)-f(i);return e<<12|t},a.getPatternPosition=function(t){return e[t-1]},a.getMaskFunction=function(e){switch(e){case r.PATTERN000:return function(e,t){return(e+t)%2==0};case r.PATTERN001:return function(e,t){return e%2==0};case r.PATTERN010:return function(e,t){return t%3==0};case r.PATTERN011:return function(e,t){return(e+t)%3==0};case r.PATTERN100:return function(e,t){return(Math.floor(e/2)+Math.floor(t/3))%2==0};case r.PATTERN101:return function(e,t){return e*t%2+e*t%3==0};case r.PATTERN110:return function(e,t){return(e*t%2+e*t%3)%2==0};case r.PATTERN111:return function(e,t){return(e*t%3+(e+t)%2)%2==0};default:throw new Error("bad maskPattern:"+e)}},a.getErrorCorrectPolynomial=function(e){var t=o([1],0);for(var n=0;n<e;n+=1)t=t.multiply(o([1,s.gexp(n)],0));return t},a.getLengthInBits=function(e,n){if(1<=n&&n<10)switch(e){case t.MODE_NUMBER:return 10;case t.MODE_ALPHA_NUM:return 9;case t.MODE_8BIT_BYTE:return 8;case t.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(n<27)switch(e){case t.MODE_NUMBER:return 12;case t.MODE_ALPHA_NUM:return 11;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(n<41))throw new Error("type:"+n);switch(e){case t.MODE_NUMBER:return 14;case t.MODE_ALPHA_NUM:return 13;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},a.getLostPoint=function(e){var t=e.getModuleCount(),n=0;for(var r=0;r<t;r+=1)for(var i=0;i<t;i+=1){var s=0,o=e.isDark(r,i);for(var u=-1;u<=1;u+=1){if(r+u<0||t<=r+u)continue;for(var a=-1;a<=1;a+=1){if(i+a<0||t<=i+a)continue;if(u==0&&a==0)continue;o==e.isDark(r+u,i+a)&&(s+=1)}}s>5&&(n+=3+s-5)}for(var r=0;r<t-1;r+=1)for(var i=0;i<t-1;i+=1){var f=0;e.isDark(r,i)&&(f+=1),e.isDark(r+1,i)&&(f+=1),e.isDark(r,i+1)&&(f+=1),e.isDark(r+1,i+1)&&(f+=1);if(f==0||f==4)n+=3}for(var r=0;r<t;r+=1)for(var i=0;i<t-6;i+=1)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(var i=0;i<t;i+=1)for(var r=0;r<t-6;r+=1)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);var l=0;for(var i=0;i<t;i+=1)for(var r=0;r<t;r+=1)e.isDark(r,i)&&(l+=1);var c=Math.abs(100*l/t/t-50)/5;return n+=c*10,n},a}(),s=function(){var e=new Array(256),t=new Array(256);for(var n=0;n<8;n+=1)e[n]=1<<n;for(var n=8;n<256;n+=1)e[n]=e[n-4]^e[n-5]^e[n-6]^e[n-8];for(var n=0;n<255;n+=1)t[e[n]]=n;var r={};return r.glog=function(e){if(e<1)throw new Error("glog("+e+")");return t[e]},r.gexp=function(t){while(t<0)t+=255;while(t>=256)t-=255;return e[t]},r}(),u=function(){var e=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=function(e,t){var n={};return n.totalCount=e,n.dataCount=t,n},r={},i=function(t,r){switch(r){case n.L:return e[(t-1)*4+0];case n.M:return e[(t-1)*4+1];case n.Q:return e[(t-1)*4+2];case n.H:return e[(t-1)*4+3];default:return undefined}};return r.getRSBlocks=function(e,n){var r=i(e,n);if(typeof r=="undefined")throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+n);var s=r.length/3,o=new Array;for(var u=0;u<s;u+=1){var a=r[u*3+0],f=r[u*3+1],l=r[u*3+2];for(var c=0;c<a;c+=1)o.push(t(f,l))}return o},r}(),a=function(){var e=new Array,t=0,n={};return n.getBuffer=function(){return e},n.get=function(t){var n=Math.floor(t/8);return(e[n]>>>7-t%8&1)==1},n.put=function(e,t){for(var r=0;r<t;r+=1)n.putBit((e>>>t-r-1&1)==1)},n.getLengthInBits=function(){return t},n.putBit=function(n){var r=Math.floor(t/8);e.length<=r&&e.push(0),n&&(e[r]|=128>>>t%8),t+=1},n},f=function(n){var r=t.MODE_8BIT_BYTE,i=n,s=e.stringToBytes(n),o={};return o.getMode=function(){return r},o.getLength=function(e){return s.length},o.write=function(e){for(var t=0;t<s.length;t+=1)e.put(s[t],8)},o},l=function(){var e=new Array,t={};return t.writeByte=function(t){e.push(t&255)},t.writeShort=function(e){t.writeByte(e),t.writeByte(e>>>8)},t.writeBytes=function(e,n,r){n=n||0,r=r||e.length;for(var i=0;i<r;i+=1)t.writeByte(e[i+n])},t.writeString=function(e){for(var n=0;n<e.length;n+=1)t.writeByte(e.charCodeAt(n))},t.toByteArray=function(){return e},t.toString=function(){var t="";t+="[";for(var n=0;n<e.length;n+=1)n>0&&(t+=","),t+=e[n];return t+="]",t},t},c=function(){var e=0,t=0,n=0,r="",i={},s=function(e){r+=String.fromCharCode(o(e&63))},o=function(e){if(!(e<0)){if(e<26)return 65+e;if(e<52)return 97+(e-26);if(e<62)return 48+(e-52);if(e==62)return 43;if(e==63)return 47}throw new Error("n:"+e)};return i.writeByte=function(r){e=e<<8|r&255,t+=8,n+=1;while(t>=6)s(e>>>t-6),t-=6},i.flush=function(){t>0&&(s(e<<6-t),e=0,t=0);if(n%3!=0){var i=3-n%3;for(var o=0;o<i;o+=1)r+="="}},i.toString=function(){return r},i},h=function(e){var t=e,n=0,r=0,i=0,s={};s.read=function(){while(i<8){if(n>=t.length){if(i==0)return-1;throw new Error("unexpected end of file./"+i)}var e=t.charAt(n);n+=1;if(e=="=")return i=0,-1;if(e.match(/^\s$/))continue;r=r<<6|o(e.charCodeAt(0)),i+=6}var s=r>>>i-8&255;return i-=8,s};var o=function(e){if(65<=e&&e<=90)return e-65;if(97<=e&&e<=122)return e-97+26;if(48<=e&&e<=57)return e-48+52;if(e==43)return 62;if(e==47)return 63;throw new Error("c:"+e)};return s},p=function(e,t){var n=e,r=t,i=new Array(e*t),s={};s.setPixel=function(e,t,r){i[t*n+e]=r},s.write=function(e){e.writeString("GIF87a"),e.writeShort(n),e.writeShort(r),e.writeByte(128),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(255),e.writeByte(255),e.writeByte(255),e.writeString(","),e.writeShort(0),e.writeShort(0),e.writeShort(n),e.writeShort(r),e.writeByte(0);var t=2,i=u(t);e.writeByte(t);var s=0;while(i.length-s>255)e.writeByte(255),e.writeBytes(i,s,255),s+=255;e.writeByte(i.length-s),e.writeBytes(i,s,i.length-s),e.writeByte(0),e.writeString(";")};var o=function(e){var t=e,n=0,r=0,i={};return i.write=function(e,i){if(e>>>i!=0)throw new Error("length over");while(n+i>=8)t.writeByte(255&(e<<n|r)),i-=8-n,e>>>=8-n,r=0,n=0;r=e<<n|r,n+=i},i.flush=function(){n>0&&t.writeByte(r)},i},u=function(e){var t=1<<e,n=(1<<e)+1,r=e+1,s=a();for(var u=0;u<t;u+=1)s.add(String.fromCharCode(u));s.add(String.fromCharCode(t)),s.add(String.fromCharCode(n));var f=l(),c=o(f);c.write(t,r);var h=0,p=String.fromCharCode(i[h]);h+=1;while(h<i.length){var d=String.fromCharCode(i[h]);h+=1,s.contains(p+d)?p+=d:(c.write(s.indexOf(p),r),s.size()<4095&&(s.size()==1<<r&&(r+=1),s.add(p+d)),p=d)}return c.write(s.indexOf(p),r),c.write(n,r),c.flush(),f.toByteArray()},a=function(){var e={},t=0,n={};return n.add=function(r){if(n.contains(r))throw new Error("dup key:"+r);e[r]=t,t+=1},n.size=function(){return t},n.indexOf=function(t){return e[t]},n.contains=function(t){return typeof e[t]!="undefined"},n};return s},d=function(e,t,n,r){var i=p(e,t);for(var s=0;s<t;s+=1)for(var o=0;o<e;o+=1)i.setPixel(o,s,n(o,s));var u=l();i.write(u);var a=c(),f=u.toByteArray();for(var h=0;h<f.length;h+=1)a.writeByte(f[h]);a.flush();var d="";return d+="<img",d+=' src="',d+="data:image/gif;base64,",d+=a,d+='"',d+=' width="',d+=e,d+='"',d+=' height="',d+=t,d+='"',r&&(d+=' alt="',d+=r,d+='"'),d+="/>",d};return e}()})(jQuery)}),ig.baked=!0,ig.module("plugins.jquery-countdown").defines(function(){(function(e){e.fn.countdown=function(t){var n={radix:10,interval:1e3,stopTimeout:!1,init:function(e,t){console.log("INITIATED"),this.$seconds=e.find(".seconds"),this.seconds=parseInt(this.$seconds.text(),this.radix),this.callback=t,this.original=this.seconds,e.data("countdown",this),this.run()},run:function(){var e=this;this.timeout=setTimeout(function(){if(e.stopTimeout===!0)return e.stopTimeout=!1,!1;e.seconds===0?e.callback():(e.seconds>0&&(e.seconds--,e.$seconds.text(e.seconds)),e.run())},this.interval)},stop:function(){console.log("countdown stop"),this.stopTimeout=!0},restart:function(){console.log("countdown restart"),this.run()},reset:function(){console.log("countdown reset"),this.stop(),this.seconds=this.original,this.$seconds.text(this.seconds)}};return this.each(function(){n.init(e(this),t)})}})(jQuery)}),ig.baked=!0,ig.module("game.manager").requires("game.main","game.connections","plugins.templates","plugins.jquery-qrcode","plugins.jquery-countdown").defines(function(){manager={players:{},dimensions:{width:$(window).width(),height:$(window).height()},stats:{consumed:0,negatrons:0,positrons:0,electrons:0,start:0,end:0,duration:0},view:"connecting",init:function(){connections.init(),console.log("Manager initialised: ",config)},bindViewEvents:function(e){var t=this;switch(e){case"lobby":$("#start-experiment").on("click",function(e){return e.preventDefault(),t.countdown.stop(),t.loadGame(),!1})}},startGame:function(){ig.main("#canvas",Prototype,60,800,600,1),this.stats.start=Date.now()},resetPlayers:function(){for(var e in this.players)this.players.hasOwnProperty(e)&&(this.players[e].alive=!0,this.players[e].ready=!1)},countPlayers:function(){return Object.keys(this.players).length},generateControllerQrCode:function(){var e=$("#qrcode"),t=window.devicePixelRatio||1,n=140,r,i;r=i=n*t,e.qrcode({width:r,height:i,text:e.data("href")}),e.find("canvas").css({width:n,height:n}),console.log("Generated controller QR Code: ",e.data("href"))},countdown:{started:!1,start:function(){$("#or").addClass("hidden"),this.started===!0?$("#countdown").removeClass("hidden").data("countdown").restart():(this.started=!0,$("#countdown").removeClass("hidden").countdown(function(){manager.loadGame()}),$("#or").addClass("hidden"))},stop:function(){this.started===!0&&($("#countdown").addClass("hidden").data("countdown").stop(),$("#or").removeClass("hidden"))},reset:function(){this.started===!0&&($("#countdown").addClass("hidden").data("countdown").reset(),$("#or").removeClass("hidden"))}},setPlayers:function(e){this.players=e},loadLobby:function(){var e=this,t;this.resetPlayers(),t={players:this.players},$.extend(t,config),this.loadView("lobby",t,function(){e.generateControllerQrCode()}),console.log("Loading lobby.")},loadError:function(e){this.loadView("error",{message:e})},loadGame:function(){var e=this,t={players:e.players,labId:config.labId};this.loadView("game",t,function(){e.startGame()}),console.log("Loading game.")},loadView:function(e,t,n){var r=Handlebars.templates[e](t);console.log("Handlebars templates: ",Handlebars.templates),$("#container").removeClass().addClass(e).html(r),this.bindViewEvents(e),this.view=e,e!=="error"&&e!=="gameover"&&connections.updateStatus(e),typeof n=="function"&&n(),console.log("View loaded: ",e,t)},addPlayer:function(e){var t=Handlebars.templates[this.view+".player"](e);$("#players").append(t),this.view==="game"&&ig.game.neutrons.add(e),this.players[e.id]=e},removePlayer:function(e){delete this.players[e.id],this.view==="game"?(ig.game.neutrons.remove(e),this.checkGameFinished()):this.view==="lobby"&&($("#"+e.id).remove(),this.countdown.reset())},killPlayer:function(e){var t=this.players[e];t.alive=!1,connections.killPlayer(t),this.checkGameFinished(),console.log("Player killed: ",t)},playerReady:function(e){this.view==="lobby"&&($("#"+e.id).addClass("ready"),this.players[e.id].ready=!0,this.playersReady()&&this.countdown.start())},playersReady:function(){if(this.countPlayers()>1){var e=!0;for(var t in this.players)if(this.players[t].ready===!1){e=!1;break}return e}return!1},playerCancelled:function(e){this.view==="lobby"&&($("#"+e.id).removeClass("ready"),this.players[e.id].ready=!1,this.countdown.reset())},checkGameFinished:function(){var e=this.countPlayers(),t=this.countAlivePlayers();(e<2||t<2)&&this.endGame()},getWinner:function(){console.log("Players: ",this.players);for(var e in this.players)if(this.players.hasOwnProperty(e)&&this.players[e].alive===!0)return this.players[e]},endGame:function(){var e=this,t=this.getWinner(),n;ig.system.stopRunLoop(),ig.music.stop(),this.stats.end=Date.now(),this.stats.duration=(this.stats.end-this.stats.start)/1e3,console.log("Game ended: ",t),typeof t=="undefined"?window.location.reload():(connections.alertWinner(t),n={winner:t,stats:this.stats},console.log("Final screen data: ",n),this.loadView("gameover",n),setTimeout(function(){window.location.reload()},15e3))},countAlivePlayers:function(){var e=0;for(var t in this.players)this.players.hasOwnProperty(t)&&this.players[t].alive===!0&&e++;return e},electronBlastStatus:function(e,t){var n=this.players[e];connections.emit("electronBlastStatus",{player:n,data:t})},resetStats:function(){var e;for(e in this.stats)this.stats.hasOwnProperty(e)&&(this.stats[e]=0)}},manager.init()}),define("manager",["jquery","io"],function(){}),define("utilities/log",[],function(){(!window.console||!console.log||config.debug===!1)&&function(){var e=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","markTimeline","table","time","timeEnd","timeStamp","trace","warn"],n=t.length,r=window.console={};while(n--)r[t[n]]=e}()}),requirejs.config({paths:{jquery:"components/jquery/jquery",sketch:"plugins/sketch",ga:"//google-analytics.com/ga",io:"plugins/socket.io",manager:"../lab/manager.min"},shim:{manager:{deps:["jquery","io"]},sketch:{exports:"Sketch",deps:["jquery"]},"plugins/jquery.retinafy":{deps:["jquery"]},ga:{exports:"_gaq"}}}),requirejs(["jquery","modules/dust","modules/retinafy","modules/analytics","modules/retinafy","manager","utilities/log"],function(e,t,n,r){var i={Modules:{dust:t,analytics:n,retinafy:r},Events:e({}),init:function(){var e;for(e in this.Modules)this.Modules[e].init(this.Events)}};e(document).ready(function(){i.init()})}),define("lab",function(){});